{"version":"1.12.0","metadata":{"app":"mastodon","language":{"name":"ruby","engine":"ruby","version":"3.2.2"},"client":{"name":"appmap","url":"https://github.com/applandinc/appmap-ruby","version":"0.102.1"},"frameworks":[{"name":"rails","version":"7.1.1"},{"name":"rspec","version":"3.12.2"}],"git":{"repository":"https://github.com/sgrigson/mastodon.git","branch":"appmap-config","commit":"743782bd299fd54e12a4a5829872efc505132ab3","status":["M .husky/pre-commit","?? sql_warning.txt"],"git_last_annotated_tag":"0.1.2-14597-g743782bd299fd54e12a4a5829872efc505132ab3","git_last_tag":"v4.2.0","git_commits_since_last_annotated_tag":0,"git_commits_since_last_tag":0},"name":"DomainBlockWorker perform calls domain block service for relevant domain block","source_location":"spec/workers/domain_block_worker_spec.rb","recorder":{"name":"rspec","type":"tests"},"test_status":"succeeded"},"classMap":[{"name":"activesupport","type":"package","children":[{"name":"ActiveSupport","type":"class","children":[{"name":"Callbacks","type":"class","children":[{"name":"CallbackSequence","type":"class","children":[{"name":"invoke_before","type":"function","location":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb:597","static":false,"labels":["mvc.before_action"]},{"name":"invoke_after","type":"function","location":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb:601","static":false,"labels":["mvc.after_action"]}]}]}]}]},{"name":"app","type":"package","children":[{"name":"lib","type":"package","children":[{"name":"TagManager","type":"class","children":[{"name":"normalize_domain","type":"function","location":"app/lib/tag_manager.rb:17","static":false}]},{"name":"RedisConfiguration","type":"class","children":[{"name":"with","type":"function","location":"app/lib/redis_configuration.rb:10","static":true},{"name":"pool","type":"function","location":"app/lib/redis_configuration.rb:12","static":true}]}]},{"name":"validators","type":"package","children":[{"name":"DomainValidator","type":"class","children":[{"name":"validate_each","type":"function","location":"app/validators/domain_validator.rb:4","static":false}]}]},{"name":"models","type":"package","children":[{"name":"concerns","type":"package","children":[{"name":"DomainMaterializable","type":"class","children":[{"name":"refresh_instances_view","type":"function","location":"app/models/concerns/domain_materializable.rb:12","static":false},{"name":"count_unique_subdomains!","type":"function","location":"app/models/concerns/domain_materializable.rb:19","static":false}]},{"name":"Redisable","type":"class","children":[{"name":"with_redis","type":"function","location":"app/models/concerns/redisable.rb:8","static":false}]}]},{"name":"Instance","type":"class","children":[{"name":"refresh","type":"function","location":"app/models/instance.rb:28","static":true}]}]},{"name":"workers","type":"package","children":[{"name":"DomainBlockWorker","type":"class","children":[{"name":"perform","type":"function","location":"app/workers/domain_block_worker.rb:6","static":false}]}]}]}],"events":[{"id":1278110,"event":"call","thread_id":9160,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_before","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":597,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":7063160,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":2859840,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fdc075163b0>"}},{"id":1278111,"event":"call","thread_id":9160,"defined_class":"TagManager","method_id":"normalize_domain","path":"app/lib/tag_manager.rb","lineno":17,"static":false,"parameters":[{"name":"domain","class":"String","object_id":7063180,"value":"1rolfson.test","kind":"req"}],"receiver":{"class":"TagManager","object_id":831360,"value":"#<TagManager:0x00007fdc08786ea0>"}},{"id":1278112,"event":"return","thread_id":9160,"parent_id":1278111,"elapsed":0.00036732800072059035,"elapsed_instrumentation":0.0001469090348109603,"return_value":{"class":"String","value":"1rolfson.test","object_id":7063200}},{"id":1278113,"event":"return","thread_id":9160,"parent_id":1278110,"elapsed":0.0006157369934953749,"elapsed_instrumentation":0.00025587197160348296,"return_value":{"class":"Array","value":"[#<Proc:0x00007fdc0a9527f0 /workspaces/mastodon/vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib, #<Proc:0x00007fdc0a952a20 /workspaces/mastodon/vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib]","object_id":2859900,"size":2}},{"id":1278114,"event":"call","thread_id":9160,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_before","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":597,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":7063220,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":2859940,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fdc07516310>"}},{"id":1278115,"event":"call","thread_id":9160,"sql_query":{"sql":"SAVEPOINT active_record_1","database_type":"postgres"}},{"id":1278116,"event":"return","thread_id":9160,"parent_id":1278115,"elapsed":0.000634043,"elapsed_instrumentation":0.00016744399908930063},{"id":1278117,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT 1 AS one FROM \"domain_blocks\" WHERE \"domain_blocks\".\"domain\" = $1 LIMIT $2","database_type":"postgres"}},{"id":1278118,"event":"return","thread_id":9160,"parent_id":1278117,"elapsed":0.002165095,"elapsed_instrumentation":9.968600352294743e-05},{"id":1278119,"event":"call","thread_id":9160,"defined_class":"DomainValidator","method_id":"validate_each","path":"app/validators/domain_validator.rb","lineno":4,"static":false,"parameters":[{"name":"record","class":"DomainBlock","object_id":7063240,"value":"#<DomainBlock:0x00007fdc06022080>","kind":"req"},{"name":"attribute","class":"Symbol","object_id":1241948,"value":":domain","kind":"req"},{"name":"value","class":"String","object_id":7063260,"value":"1rolfson.test","kind":"req"}],"receiver":{"class":"DomainValidator","object_id":2860000,"value":"#<DomainValidator:0x00007fdc0fbd9488>"}},{"id":1278120,"event":"return","thread_id":9160,"parent_id":1278119,"elapsed":6.540800677612424e-05,"elapsed_instrumentation":0.00028283303254283965},{"id":1278121,"event":"return","thread_id":9160,"parent_id":1278114,"elapsed":0.003963635012041777,"elapsed_instrumentation":0.00020498197409324348,"return_value":{"class":"Array","value":"[#<Proc:0x00007fdc0a96f7d8 /workspaces/mastodon/vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib, #<Proc:0x00007fdc0a96fee0 /workspaces/mastodon/vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib, #<Proc:0x00007fdc0a9501d0 /workspaces/mastodon/vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib, #<Proc:0x00007fdc0a9503d8 /workspaces/mastodon/vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib, #<Proc:0x00007fdc0a950630 /workspaces/mastodon/vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib]","object_id":2860020,"size":5}},{"id":1278122,"event":"call","thread_id":9160,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_after","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":601,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":7063220,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":2859940,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fdc07516310>"}},{"id":1278123,"event":"return","thread_id":9160,"parent_id":1278122,"elapsed":3.1170202419161797e-06,"elapsed_instrumentation":0.0001025209785439074,"return_value":{"class":"Array","value":"[]","object_id":2860040,"size":0}},{"id":1278124,"event":"call","thread_id":9160,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_after","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":601,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":7063160,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":2859840,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fdc075163b0>"}},{"id":1278125,"event":"return","thread_id":9160,"parent_id":1278124,"elapsed":1.6309990314766765e-05,"elapsed_instrumentation":0.0003360550035722554,"return_value":{"class":"Array","value":"[#<Proc:0x00007fdc0a952520 /workspaces/mastodon/vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib]","object_id":2860060,"size":1}},{"id":1278126,"event":"call","thread_id":9160,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_before","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":597,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":7063280,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":2860100,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fdc07515d20>"}},{"id":1278127,"event":"return","thread_id":9160,"parent_id":1278126,"elapsed":3.496010322123766e-06,"elapsed_instrumentation":0.00014431998715735972,"return_value":{"class":"Array","value":"[]","object_id":2860120,"size":0}},{"id":1278128,"event":"call","thread_id":9160,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_before","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":597,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":7063280,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":2860140,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fdc07515d70>"}},{"id":1278129,"event":"return","thread_id":9160,"parent_id":1278128,"elapsed":2.8469949029386044e-06,"elapsed_instrumentation":8.432197500951588e-05,"return_value":{"class":"Array","value":"[]","object_id":2860160,"size":0}},{"id":1278130,"event":"call","thread_id":9160,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_before","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":597,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":7063300,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":2860200,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fdc07515c30>"}},{"id":1278131,"event":"return","thread_id":9160,"parent_id":1278130,"elapsed":3.28800524584949e-06,"elapsed_instrumentation":0.00013633299386128783,"return_value":{"class":"Array","value":"[]","object_id":2860220,"size":0}},{"id":1278132,"event":"call","thread_id":9160,"sql_query":{"sql":"INSERT INTO \"domain_blocks\" (\"domain\", \"created_at\", \"updated_at\", \"severity\", \"reject_media\", \"reject_reports\", \"private_comment\", \"public_comment\", \"obfuscate\") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING \"id\"","database_type":"postgres"}},{"id":1278133,"event":"return","thread_id":9160,"parent_id":1278132,"elapsed":0.001239482,"elapsed_instrumentation":0.0002799119974952191},{"id":1278134,"event":"call","thread_id":9160,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_after","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":601,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":7063300,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":2860200,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fdc07515c30>"}},{"id":1278135,"event":"return","thread_id":9160,"parent_id":1278134,"elapsed":3.944800118915737e-05,"elapsed_instrumentation":0.0005209539958741516,"return_value":{"class":"Array","value":"[#<Proc:0x00007fdc0a960878 /workspaces/mastodon/vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib]","object_id":2860240,"size":1}},{"id":1278136,"event":"call","thread_id":9160,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_after","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":601,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":7063280,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":2860140,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fdc07515d70>"}},{"id":1278137,"event":"return","thread_id":9160,"parent_id":1278136,"elapsed":4.4470070861279964e-06,"elapsed_instrumentation":0.00020470097661018372,"return_value":{"class":"Array","value":"[]","object_id":2860260,"size":0}},{"id":1278138,"event":"call","thread_id":9160,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_after","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":601,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":7063280,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":2860100,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fdc07515d20>"}},{"id":1278139,"event":"return","thread_id":9160,"parent_id":1278138,"elapsed":2.7460046112537384e-06,"elapsed_instrumentation":9.014899842441082e-05,"return_value":{"class":"Array","value":"[]","object_id":2860280,"size":0}},{"id":1278140,"event":"call","thread_id":9160,"sql_query":{"sql":"RELEASE SAVEPOINT active_record_1","database_type":"postgres"}},{"id":1278141,"event":"return","thread_id":9160,"parent_id":1278140,"elapsed":0.000559364,"elapsed_instrumentation":9.93790163192898e-05},{"id":1278142,"event":"call","thread_id":9160,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_before","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":597,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":7063320,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":2860320,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fdc07515320>"}},{"id":1278143,"event":"return","thread_id":9160,"parent_id":1278142,"elapsed":3.789988113567233e-06,"elapsed_instrumentation":0.00016454901196993887,"return_value":{"class":"Array","value":"[]","object_id":2860340,"size":0}},{"id":1278144,"event":"call","thread_id":9160,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_after","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":601,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":7063320,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":2860320,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fdc07515320>"}},{"id":1278145,"event":"call","thread_id":9160,"defined_class":"DomainMaterializable","method_id":"refresh_instances_view","path":"app/models/concerns/domain_materializable.rb","lineno":12,"static":false,"parameters":[],"receiver":{"class":"DomainBlock","object_id":7063240,"value":"#<DomainBlock:0x00007fdc06022080>"}},{"id":1278146,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT 1 AS one FROM \"instances\" WHERE \"instances\".\"domain\" = $1 LIMIT $2","database_type":"postgres"}},{"id":1278147,"event":"return","thread_id":9160,"parent_id":1278146,"elapsed":0.001811667,"elapsed_instrumentation":0.00010290599311701953},{"id":1278148,"event":"call","thread_id":9160,"defined_class":"Instance","method_id":"refresh","path":"app/models/instance.rb","lineno":28,"static":true,"parameters":[],"receiver":{"class":"Class","object_id":52400,"value":"Instance"}},{"id":1278149,"event":"call","thread_id":9160,"sql_query":{"sql":"REFRESH MATERIALIZED VIEW CONCURRENTLY \"instances\";","database_type":"postgres"}},{"id":1278150,"event":"return","thread_id":9160,"parent_id":1278149,"elapsed":0.023057449,"elapsed_instrumentation":0.00013580298400484025},{"id":1278151,"event":"return","thread_id":9160,"parent_id":1278148,"elapsed":0.023989403009181842,"elapsed_instrumentation":0.00034127599792554975,"return_value":{"class":"PG::Result","value":"#<PG::Result:0x00007fdc0a3043d0>","object_id":7063340}},{"id":1278152,"event":"call","thread_id":9160,"defined_class":"DomainMaterializable","method_id":"count_unique_subdomains!","path":"app/models/concerns/domain_materializable.rb","lineno":19,"static":false,"parameters":[],"receiver":{"class":"DomainBlock","object_id":7063240,"value":"#<DomainBlock:0x00007fdc06022080>"}},{"id":1278153,"event":"call","thread_id":9160,"defined_class":"Redisable","method_id":"with_redis","path":"app/models/concerns/redisable.rb","lineno":8,"static":false,"parameters":[{"name":"block","class":"NilClass","object_id":4,"value":null,"kind":"block"}],"receiver":{"class":"DomainBlock","object_id":7063240,"value":"#<DomainBlock:0x00007fdc06022080>"}},{"id":1278154,"event":"call","thread_id":9160,"defined_class":"RedisConfiguration","method_id":"with","path":"app/lib/redis_configuration.rb","lineno":10,"static":true,"parameters":[{"name":"*","class":"Array","object_id":7063360,"value":"[]","kind":"rest","size":0},{"name":"**","class":"Hash","object_id":7063380,"value":"{}","kind":"keyrest","size":0},{"name":"&","class":"NilClass","object_id":4,"value":null,"kind":"block"}],"receiver":{"class":"Class","object_id":32420,"value":"RedisConfiguration"}},{"id":1278155,"event":"call","thread_id":9160,"defined_class":"RedisConfiguration","method_id":"pool","path":"app/lib/redis_configuration.rb","lineno":12,"static":true,"parameters":[],"receiver":{"class":"Class","object_id":32420,"value":"RedisConfiguration"}},{"id":1278156,"event":"return","thread_id":9160,"parent_id":1278155,"elapsed":3.6339915823191404e-06,"elapsed_instrumentation":0.00019642201368696988,"return_value":{"class":"ConnectionPool","value":"#<ConnectionPool:0x00007fdc0a6c8020>","object_id":404600}},{"id":1278157,"event":"return","thread_id":9160,"parent_id":1278154,"elapsed":0.0013550389849115163,"elapsed_instrumentation":0.00023396400501951575,"return_value":{"class":"TrueClass","value":"true","object_id":20}},{"id":1278158,"event":"return","thread_id":9160,"parent_id":1278153,"elapsed":0.0016622050025034696,"elapsed_instrumentation":8.901002001948655e-05,"return_value":{"class":"TrueClass","value":"true","object_id":20}},{"id":1278159,"event":"return","thread_id":9160,"parent_id":1278152,"elapsed":0.0019090620044153184,"elapsed_instrumentation":0.00011743299546651542,"return_value":{"class":"TrueClass","value":"true","object_id":20}},{"id":1278160,"event":"return","thread_id":9160,"parent_id":1278145,"elapsed":0.029954245022963732,"elapsed_instrumentation":8.625697228126228e-05,"return_value":{"class":"TrueClass","value":"true","object_id":20}},{"id":1278161,"event":"return","thread_id":9160,"parent_id":1278144,"elapsed":0.03008080497966148,"elapsed_instrumentation":0.00030203600181266665,"return_value":{"class":"Array","value":"[#<Proc:0x00007fdc0a99b7e8 /workspaces/mastodon/vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib]","object_id":2860420,"size":1}},{"id":1278162,"event":"call","thread_id":9160,"defined_class":"DomainBlockWorker","method_id":"perform","path":"app/workers/domain_block_worker.rb","lineno":6,"static":false,"parameters":[{"name":"domain_block_id","class":"Integer","object_id":19,"value":"9","kind":"req"},{"name":"update","class":"NilClass","object_id":4,"value":null,"kind":"opt"}],"receiver":{"class":"DomainBlockWorker","object_id":7063400,"value":"#<DomainBlockWorker:0x00007fdc0a3f7cb0>"}},{"id":1278163,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT \"domain_blocks\".* FROM \"domain_blocks\" WHERE \"domain_blocks\".\"id\" = $1 LIMIT $2","database_type":"postgres"}},{"id":1278164,"event":"return","thread_id":9160,"parent_id":1278163,"elapsed":0.000837466,"elapsed_instrumentation":9.233399759978056e-05},{"id":1278165,"event":"return","thread_id":9160,"parent_id":1278162,"elapsed":0.002542900008847937,"elapsed_instrumentation":0.00012493101530708373}]}