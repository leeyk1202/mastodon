{"version":"1.12.0","metadata":{"app":"mastodon","language":{"name":"ruby","engine":"ruby","version":"3.2.2"},"client":{"name":"appmap","url":"https://github.com/applandinc/appmap-ruby","version":"0.102.1"},"frameworks":[{"name":"rails","version":"7.1.1"},{"name":"rspec","version":"3.12.2"}],"git":{"repository":"https://github.com/sgrigson/mastodon.git","branch":"appmap-config","commit":"743782bd299fd54e12a4a5829872efc505132ab3","status":["M .husky/pre-commit","?? sql_warning.txt"],"git_last_annotated_tag":"0.1.2-14597-g743782bd299fd54e12a4a5829872efc505132ab3","git_last_tag":"v4.2.0","git_commits_since_last_annotated_tag":0,"git_commits_since_last_tag":0},"name":"Mastodon::CLI::Cache #recount with the `statuses` argument re-calculates account records in the cache","source_location":"spec/lib/mastodon/cli/cache_spec.rb","recorder":{"name":"rspec","type":"tests"},"test_status":"succeeded"},"classMap":[{"name":"lib","type":"package","children":[{"name":"mastodon/cli","type":"package","children":[{"name":"Mastodon","type":"class","children":[{"name":"CLI","type":"class","children":[{"name":"Cache","type":"class","children":[{"name":"recount","type":"function","location":"lib/mastodon/cli/cache.rb:23","static":false}]},{"name":"ProgressHelper","type":"class","children":[{"name":"parallelize_with_progress","type":"function","location":"lib/mastodon/cli/progress_helper.rb:27","static":false},{"name":"create_progress_bar","type":"function","location":"lib/mastodon/cli/progress_helper.rb:18","static":false}]}]}]}]},{"name":"chewy/strategy","type":"package","children":[{"name":"Chewy","type":"class","children":[{"name":"Strategy","type":"class","children":[{"name":"Mastodon","type":"class","children":[{"name":"leave","type":"function","location":"lib/chewy/strategy/mastodon.rb:16","static":false}]}]}]}]}]},{"name":"app","type":"package","children":[{"name":"models","type":"package","children":[{"name":"Status","type":"class","children":[{"name":"status_stat","type":"function","location":"app/models/status.rb:388","static":false}]},{"name":"StatusStat","type":"class","children":[{"name":"replies_count","type":"function","location":"app/models/status_stat.rb:19","static":false}]}]},{"name":"lib","type":"package","children":[{"name":"RedisConfiguration","type":"class","children":[{"name":"with","type":"function","location":"app/lib/redis_configuration.rb:10","static":true},{"name":"pool","type":"function","location":"app/lib/redis_configuration.rb:12","static":true},{"name":"connection","type":"function","location":"app/lib/redis_configuration.rb:25","static":false},{"name":"namespace?","type":"function","location":"app/lib/redis_configuration.rb:33","static":false},{"name":"namespace","type":"function","location":"app/lib/redis_configuration.rb:37","static":false},{"name":"url","type":"function","location":"app/lib/redis_configuration.rb:41","static":false}]}]}]},{"name":"activesupport","type":"package","children":[{"name":"ActiveSupport","type":"class","children":[{"name":"Callbacks","type":"class","children":[{"name":"CallbackSequence","type":"class","children":[{"name":"invoke_before","type":"function","location":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb:597","static":false,"labels":["mvc.before_action"]},{"name":"invoke_after","type":"function","location":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb:601","static":false,"labels":["mvc.after_action"]}]}]}]}]},{"name":"ruby","type":"package","children":[{"name":"String","type":"class","children":[{"name":"unpack1","type":"function","location":"<internal:pack>:28","static":false,"labels":["string.unpack"]}]}]}],"events":[{"id":1343930,"event":"call","thread_id":9160,"defined_class":"Mastodon::CLI::Cache","method_id":"recount","path":"lib/mastodon/cli/cache.rb","lineno":23,"static":false,"parameters":[{"name":"type","class":"String","object_id":367320,"value":"statuses","kind":"req"}],"receiver":{"class":"Mastodon::CLI::Cache","object_id":7327840,"value":"#<Mastodon::CLI::Cache:0x00007fdc096edf88>"}},{"id":1343931,"event":"call","thread_id":9160,"defined_class":"Mastodon::CLI::ProgressHelper","method_id":"parallelize_with_progress","path":"lib/mastodon/cli/progress_helper.rb","lineno":27,"static":false,"parameters":[{"name":"scope","class":"ActiveRecord::Relation","object_id":7327860,"value":"#<Status::ActiveRecord_Relation:0x00007fdc07819580>","kind":"req"}],"receiver":{"class":"Mastodon::CLI::Cache","object_id":7327840,"value":"#<Mastodon::CLI::Cache:0x00007fdc096edf88>"}},{"id":1343932,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT COUNT(*) FROM \"statuses\" WHERE \"statuses\".\"deleted_at\" IS NULL","database_type":"postgres"}},{"id":1343933,"event":"return","thread_id":9160,"parent_id":1343932,"elapsed":0.001011535,"elapsed_instrumentation":9.561399929225445e-05},{"id":1343934,"event":"call","thread_id":9160,"defined_class":"Mastodon::CLI::ProgressHelper","method_id":"create_progress_bar","path":"lib/mastodon/cli/progress_helper.rb","lineno":18,"static":false,"parameters":[{"name":"total","class":"Integer","object_id":3,"value":"1","kind":"opt"}],"receiver":{"class":"Mastodon::CLI::Cache","object_id":7327840,"value":"#<Mastodon::CLI::Cache:0x00007fdc096edf88>"}},{"id":1343935,"event":"return","thread_id":9160,"parent_id":1343934,"elapsed":0.0002614080149214715,"elapsed_instrumentation":0.00028124096570536494,"return_value":{"class":"ProgressBar::Base","value":"","object_id":7327880}},{"id":1343936,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT \"statuses\".* FROM \"statuses\" WHERE \"statuses\".\"deleted_at\" IS NULL ORDER BY \"statuses\".\"id\" ASC LIMIT $1","database_type":"postgres"}},{"id":1343937,"event":"return","thread_id":9160,"parent_id":1343936,"elapsed":0.000814742,"elapsed_instrumentation":9.637800394557416e-05},{"id":1343938,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT \"status_stats\".* FROM \"status_stats\" WHERE \"status_stats\".\"status_id\" = $1","database_type":"postgres"}},{"id":1343939,"event":"return","thread_id":9160,"parent_id":1343938,"elapsed":0.000945396,"elapsed_instrumentation":9.073200635612011e-05},{"id":1343940,"event":"call","thread_id":7327900,"defined_class":"Status","method_id":"status_stat","path":"app/models/status.rb","lineno":388,"static":false,"parameters":[],"receiver":{"class":"Status","object_id":7327920,"value":"#<Status:0x00007fdc05f70448>"}},{"id":1343941,"event":"return","thread_id":7327900,"parent_id":1343940,"elapsed":2.1063984604552388e-05,"elapsed_instrumentation":0.0001758539874572307,"return_value":{"class":"StatusStat","value":"#<StatusStat:0x00007fdc06b18980>","object_id":7327940}},{"id":1343942,"event":"call","thread_id":7327900,"sql_query":{"sql":"SELECT COUNT(*) FROM \"statuses\" WHERE \"statuses\".\"deleted_at\" IS NULL AND \"statuses\".\"in_reply_to_id\" = $1 AND \"statuses\".\"visibility\" != $2","database_type":"postgres"}},{"id":1343943,"event":"return","thread_id":7327900,"parent_id":1343942,"elapsed":0.001122771,"elapsed_instrumentation":9.602602222003043e-05},{"id":1343944,"event":"call","thread_id":7327900,"sql_query":{"sql":"SELECT COUNT(*) FROM \"statuses\" WHERE \"statuses\".\"deleted_at\" IS NULL AND \"statuses\".\"reblog_of_id\" = $1","database_type":"postgres"}},{"id":1343945,"event":"return","thread_id":7327900,"parent_id":1343944,"elapsed":0.001291932,"elapsed_instrumentation":0.00011322600767016411},{"id":1343946,"event":"call","thread_id":7327900,"sql_query":{"sql":"SELECT COUNT(*) FROM \"favourites\" WHERE \"favourites\".\"status_id\" = $1","database_type":"postgres"}},{"id":1343947,"event":"return","thread_id":7327900,"parent_id":1343946,"elapsed":0.000896602,"elapsed_instrumentation":0.00010339898290112615},{"id":1343948,"event":"call","thread_id":7327900,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_before","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":597,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":7327960,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":218200,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fdc0e23d088>"}},{"id":1343949,"event":"return","thread_id":7327900,"parent_id":1343948,"elapsed":2.0067993318662047e-05,"elapsed_instrumentation":0.0002086260064970702,"return_value":{"class":"Array","value":"[#<Proc:0x00007fdc0a1a2168 /workspaces/mastodon/vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib]","object_id":218220,"size":1}},{"id":1343950,"event":"call","thread_id":7327900,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_before","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":597,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":7327980,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":1594520,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fdc09a040c8>"}},{"id":1343951,"event":"return","thread_id":7327900,"parent_id":1343950,"elapsed":8.457197691313922e-05,"elapsed_instrumentation":0.00012103500193916261,"return_value":{"class":"Array","value":"[#<Proc:0x00007fdc0618d2f8 /workspaces/mastodon/vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib, #<Proc:0x00007fdc0618d4b0 /workspaces/mastodon/vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib]","object_id":1594540,"size":2}},{"id":1343952,"event":"call","thread_id":7327900,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_after","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":601,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":7327980,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":1594520,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fdc09a040c8>"}},{"id":1343953,"event":"return","thread_id":7327900,"parent_id":1343952,"elapsed":2.8059876058250666e-06,"elapsed_instrumentation":8.208700455725193e-05,"return_value":{"class":"Array","value":"[]","object_id":1594560,"size":0}},{"id":1343954,"event":"call","thread_id":7327900,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_after","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":601,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":7327960,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":218200,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fdc0e23d088>"}},{"id":1343955,"event":"return","thread_id":7327900,"parent_id":1343954,"elapsed":2.515997039154172e-06,"elapsed_instrumentation":7.25810241419822e-05,"return_value":{"class":"Array","value":"[]","object_id":218320,"size":0}},{"id":1343956,"event":"call","thread_id":7327900,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_before","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":597,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":7328000,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":1594600,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fdc09a03fd8>"}},{"id":1343957,"event":"return","thread_id":7327900,"parent_id":1343956,"elapsed":3.6644021747633815e-05,"elapsed_instrumentation":0.0002945220039691776,"return_value":{"class":"Array","value":"[#<Proc:0x00007fdc0618c1a0 /workspaces/mastodon/vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib]","object_id":1594620,"size":1}},{"id":1343958,"event":"call","thread_id":7327900,"sql_query":{"sql":"SAVEPOINT active_record_1","database_type":"postgres"}},{"id":1343959,"event":"return","thread_id":7327900,"parent_id":1343958,"elapsed":0.000654127,"elapsed_instrumentation":0.00024939002469182014},{"id":1343960,"event":"call","thread_id":7327900,"defined_class":"String","method_id":"unpack1","path":"<internal:pack>","lineno":28,"static":false,"parameters":[{"name":"fmt","class":"String","object_id":210800,"value":"H*","kind":"req"},{"name":"offset","class":"NilClass","object_id":4,"value":null,"kind":"key"}],"receiver":{"class":"String","object_id":7328020,"value":"__\u0017_Fn@v_\u0007"}},{"id":1343961,"event":"return","thread_id":7327900,"parent_id":1343960,"elapsed":5.283014615997672e-06,"elapsed_instrumentation":0.00015186198288574815,"return_value":{"class":"String","value":"c8a717c8466e40769907","object_id":7328040}},{"id":1343962,"event":"call","thread_id":7327900,"sql_query":{"sql":"UPDATE \"status_stats\" SET \"replies_count\" = $1, \"reblogs_count\" = $2, \"favourites_count\" = $3, \"updated_at\" = $4 WHERE \"status_stats\".\"id\" = $5","database_type":"postgres"}},{"id":1343963,"event":"return","thread_id":7327900,"parent_id":1343962,"elapsed":0.002448468,"elapsed_instrumentation":0.00013287502224557102},{"id":1343964,"event":"call","thread_id":7327900,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_after","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":601,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":7328000,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":1594600,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fdc09a03fd8>"}},{"id":1343965,"event":"return","thread_id":7327900,"parent_id":1343964,"elapsed":4.874297883361578e-05,"elapsed_instrumentation":0.00018610601546242833,"return_value":{"class":"Array","value":"[]","object_id":1594640,"size":0}},{"id":1343966,"event":"call","thread_id":7327900,"sql_query":{"sql":"RELEASE SAVEPOINT active_record_1","database_type":"postgres"}},{"id":1343967,"event":"return","thread_id":7327900,"parent_id":1343966,"elapsed":0.000634281,"elapsed_instrumentation":9.570398833602667e-05},{"id":1343968,"event":"call","thread_id":7327900,"defined_class":"Chewy::Strategy::Mastodon","method_id":"leave","path":"lib/chewy/strategy/mastodon.rb","lineno":16,"static":false,"parameters":[],"receiver":{"class":"Chewy::Strategy::Mastodon","object_id":7328060,"value":"#<Chewy::Strategy::Mastodon:0x00007fdc05f39ce0>"}},{"id":1343969,"event":"call","thread_id":7327900,"defined_class":"RedisConfiguration","method_id":"with","path":"app/lib/redis_configuration.rb","lineno":10,"static":true,"parameters":[{"name":"*","class":"Array","object_id":7328080,"value":"[]","kind":"rest","size":0},{"name":"**","class":"Hash","object_id":7328100,"value":"{}","kind":"keyrest","size":0},{"name":"&","class":"NilClass","object_id":4,"value":null,"kind":"block"}],"receiver":{"class":"Class","object_id":32420,"value":"RedisConfiguration"}},{"id":1343970,"event":"call","thread_id":7327900,"defined_class":"RedisConfiguration","method_id":"pool","path":"app/lib/redis_configuration.rb","lineno":12,"static":true,"parameters":[],"receiver":{"class":"Class","object_id":32420,"value":"RedisConfiguration"}},{"id":1343971,"event":"return","thread_id":7327900,"parent_id":1343970,"elapsed":4.673987859860063e-06,"elapsed_instrumentation":0.00029950501630082726,"return_value":{"class":"ConnectionPool","value":"#<ConnectionPool:0x00007fdc0a6c8020>","object_id":404600}},{"id":1343972,"event":"call","thread_id":7327900,"defined_class":"RedisConfiguration","method_id":"connection","path":"app/lib/redis_configuration.rb","lineno":25,"static":false,"parameters":[],"receiver":{"class":"RedisConfiguration","object_id":7328120,"value":"#<RedisConfiguration:0x00007fdc05f58b90>"}},{"id":1343973,"event":"call","thread_id":7327900,"defined_class":"RedisConfiguration","method_id":"namespace?","path":"app/lib/redis_configuration.rb","lineno":33,"static":false,"parameters":[],"receiver":{"class":"RedisConfiguration","object_id":7328120,"value":"#<RedisConfiguration:0x00007fdc05f58b90>"}},{"id":1343974,"event":"call","thread_id":7327900,"defined_class":"RedisConfiguration","method_id":"namespace","path":"app/lib/redis_configuration.rb","lineno":37,"static":false,"parameters":[],"receiver":{"class":"RedisConfiguration","object_id":7328120,"value":"#<RedisConfiguration:0x00007fdc05f58b90>"}},{"id":1343975,"event":"return","thread_id":7327900,"parent_id":1343974,"elapsed":6.888993084430695e-06,"elapsed_instrumentation":0.00011386198457330465,"return_value":{"class":"String","value":"mastodon_test","object_id":7328140}},{"id":1343976,"event":"return","thread_id":7327900,"parent_id":1343973,"elapsed":0.00014386599650606513,"elapsed_instrumentation":7.589001324959099e-05,"return_value":{"class":"TrueClass","value":"true","object_id":20}},{"id":1343977,"event":"call","thread_id":7327900,"defined_class":"RedisConfiguration","method_id":"namespace","path":"app/lib/redis_configuration.rb","lineno":37,"static":false,"parameters":[],"receiver":{"class":"RedisConfiguration","object_id":7328120,"value":"#<RedisConfiguration:0x00007fdc05f58b90>"}},{"id":1343978,"event":"return","thread_id":7327900,"parent_id":1343977,"elapsed":3.98702104575932e-06,"elapsed_instrumentation":6.665696855634451e-05,"return_value":{"class":"String","value":"mastodon_test","object_id":7328160}},{"id":1343979,"event":"call","thread_id":7327900,"defined_class":"RedisConfiguration","method_id":"url","path":"app/lib/redis_configuration.rb","lineno":41,"static":false,"parameters":[],"receiver":{"class":"RedisConfiguration","object_id":7328120,"value":"#<RedisConfiguration:0x00007fdc05f58b90>"}},{"id":1343980,"event":"return","thread_id":7327900,"parent_id":1343979,"elapsed":4.549016011878848e-06,"elapsed_instrumentation":7.450298289768398e-05,"return_value":{"class":"String","value":"redis://redis:6379/0","object_id":7328180}},{"id":1343981,"event":"return","thread_id":7327900,"parent_id":1343972,"elapsed":0.0008286380034405738,"elapsed_instrumentation":0.00014250498497858644,"return_value":{"class":"Redis::Namespace","value":"#<Redis::Namespace:0x00007fdc096e9528>","object_id":7328200}},{"id":1343982,"event":"return","thread_id":7327900,"parent_id":1343969,"elapsed":0.0014218600117601454,"elapsed_instrumentation":0.00015665398677811027,"return_value":{"class":"Array","value":"[]","object_id":7328220,"size":0}},{"id":1343983,"event":"return","thread_id":7327900,"parent_id":1343968,"elapsed":0.0016007499943953007,"elapsed_instrumentation":9.737000800669193e-05,"return_value":{"class":"Array","value":"[]","object_id":7328220,"size":0}},{"id":1343984,"event":"return","thread_id":9160,"parent_id":1343931,"elapsed":0.03320627799257636,"elapsed_instrumentation":0.00020153599325567484,"return_value":{"class":"Array","value":"[1, 0]","object_id":7328240,"size":2}},{"id":1343985,"event":"return","thread_id":9160,"parent_id":1343930,"elapsed":0.03409374301554635,"elapsed_instrumentation":0.00037274998612701893,"return_value":{"class":"StringIO","value":"#<StringIO:0x00007fdc05f63860>","object_id":7328260}},{"id":1343986,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT \"status_stats\".* FROM \"status_stats\" WHERE \"status_stats\".\"id\" = $1 LIMIT $2","database_type":"postgres"}},{"id":1343987,"event":"return","thread_id":9160,"parent_id":1343986,"elapsed":0.000780525,"elapsed_instrumentation":0.00010702601866796613},{"id":1343988,"event":"call","thread_id":9160,"defined_class":"StatusStat","method_id":"replies_count","path":"app/models/status_stat.rb","lineno":19,"static":false,"parameters":[],"receiver":{"class":"StatusStat","object_id":7327820,"value":"#<StatusStat:0x00007fdc06b19880>"}},{"id":1343989,"event":"return","thread_id":9160,"parent_id":1343988,"elapsed":0.000144041987368837,"elapsed_instrumentation":0.00016159602091647685,"return_value":{"class":"Integer","value":"0","object_id":1}}]}