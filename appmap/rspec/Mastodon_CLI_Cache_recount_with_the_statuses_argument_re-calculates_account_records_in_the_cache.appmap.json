{"version":"1.12.0","metadata":{"app":"mastodon","language":{"name":"ruby","engine":"ruby","version":"3.2.2"},"client":{"name":"appmap","url":"https://github.com/applandinc/appmap-ruby","version":"0.102.1"},"frameworks":[{"name":"rails","version":"7.1.1"},{"name":"rspec","version":"3.12.2"}],"git":{"repository":"https://github.com/sgrigson/mastodon.git","branch":"appmap-config","commit":"2c1ae2317e8741caf25b51e9b3b2c15776c54ae3","status":["M .husky/pre-commit"],"git_last_annotated_tag":"0.1.2-14608-g2c1ae2317e8741caf25b51e9b3b2c15776c54ae3","git_last_tag":"v4.2.0","git_commits_since_last_annotated_tag":0,"git_commits_since_last_tag":0},"name":"Mastodon::CLI::Cache #recount with the `statuses` argument re-calculates account records in the cache","source_location":"spec/lib/mastodon/cli/cache_spec.rb","recorder":{"name":"rspec","type":"tests"},"test_status":"succeeded"},"classMap":[{"name":"lib","type":"package","children":[{"name":"mastodon/cli","type":"package","children":[{"name":"Mastodon","type":"class","children":[{"name":"CLI","type":"class","children":[{"name":"Cache","type":"class","children":[{"name":"recount","type":"function","location":"lib/mastodon/cli/cache.rb:23","static":false}]},{"name":"ProgressHelper","type":"class","children":[{"name":"parallelize_with_progress","type":"function","location":"lib/mastodon/cli/progress_helper.rb:27","static":false},{"name":"create_progress_bar","type":"function","location":"lib/mastodon/cli/progress_helper.rb:18","static":false}]}]}]}]},{"name":"chewy/strategy","type":"package","children":[{"name":"Chewy","type":"class","children":[{"name":"Strategy","type":"class","children":[{"name":"Mastodon","type":"class","children":[{"name":"leave","type":"function","location":"lib/chewy/strategy/mastodon.rb:16","static":false}]}]}]}]}]},{"name":"app","type":"package","children":[{"name":"models","type":"package","children":[{"name":"Status","type":"class","children":[{"name":"status_stat","type":"function","location":"app/models/status.rb:388","static":false}]},{"name":"StatusStat","type":"class","children":[{"name":"replies_count","type":"function","location":"app/models/status_stat.rb:19","static":false}]}]},{"name":"lib","type":"package","children":[{"name":"RedisConfiguration","type":"class","children":[{"name":"with","type":"function","location":"app/lib/redis_configuration.rb:10","static":true},{"name":"pool","type":"function","location":"app/lib/redis_configuration.rb:12","static":true}]}]}]},{"name":"activesupport","type":"package","children":[{"name":"ActiveSupport","type":"class","children":[{"name":"Callbacks","type":"class","children":[{"name":"CallbackSequence","type":"class","children":[{"name":"invoke_before","type":"function","location":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb:597","static":false,"labels":["mvc.before_action"]},{"name":"invoke_after","type":"function","location":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb:601","static":false,"labels":["mvc.after_action"]}]}]}]}]},{"name":"ruby","type":"package","children":[{"name":"String","type":"class","children":[{"name":"unpack1","type":"function","location":"<internal:pack>:28","static":false,"labels":["string.unpack"]}]}]}],"events":[{"id":3040247,"event":"call","thread_id":9160,"defined_class":"Mastodon::CLI::Cache","method_id":"recount","path":"lib/mastodon/cli/cache.rb","lineno":23,"static":false,"parameters":[{"name":"type","class":"String","object_id":688940,"value":"statuses","kind":"req"}],"receiver":{"class":"Mastodon::CLI::Cache","object_id":14909840,"value":"#<Mastodon::CLI::Cache:0x00007fc93465c7c8>"}},{"id":3040248,"event":"call","thread_id":9160,"defined_class":"Mastodon::CLI::ProgressHelper","method_id":"parallelize_with_progress","path":"lib/mastodon/cli/progress_helper.rb","lineno":27,"static":false,"parameters":[{"name":"scope","class":"ActiveRecord::Relation","object_id":14909860,"value":"#<Status::ActiveRecord_Relation:0x00007fc93112ae60>","kind":"req"}],"receiver":{"class":"Mastodon::CLI::Cache","object_id":14909840,"value":"#<Mastodon::CLI::Cache:0x00007fc93465c7c8>"}},{"id":3040249,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT COUNT(*) FROM \"statuses\" WHERE \"statuses\".\"deleted_at\" IS NULL","database_type":"postgres"}},{"id":3040250,"event":"return","thread_id":9160,"parent_id":3040249,"elapsed":0.000670667,"elapsed_instrumentation":9.620602941140532e-05},{"id":3040251,"event":"call","thread_id":9160,"defined_class":"Mastodon::CLI::ProgressHelper","method_id":"create_progress_bar","path":"lib/mastodon/cli/progress_helper.rb","lineno":18,"static":false,"parameters":[{"name":"total","class":"Integer","object_id":3,"value":"1","kind":"opt"}],"receiver":{"class":"Mastodon::CLI::Cache","object_id":14909840,"value":"#<Mastodon::CLI::Cache:0x00007fc93465c7c8>"}},{"id":3040252,"event":"return","thread_id":9160,"parent_id":3040251,"elapsed":0.00011555501259863377,"elapsed_instrumentation":0.00019761902512982488,"return_value":{"class":"ProgressBar::Base","value":"","object_id":14909880}},{"id":3040253,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT \"statuses\".* FROM \"statuses\" WHERE \"statuses\".\"deleted_at\" IS NULL ORDER BY \"statuses\".\"id\" ASC LIMIT $1","database_type":"postgres"}},{"id":3040254,"event":"return","thread_id":9160,"parent_id":3040253,"elapsed":0.000718519,"elapsed_instrumentation":8.400896331295371e-05},{"id":3040255,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT \"status_stats\".* FROM \"status_stats\" WHERE \"status_stats\".\"status_id\" = $1","database_type":"postgres"}},{"id":3040256,"event":"return","thread_id":9160,"parent_id":3040255,"elapsed":0.000568395,"elapsed_instrumentation":8.534605149179697e-05},{"id":3040257,"event":"call","thread_id":14909900,"defined_class":"Status","method_id":"status_stat","path":"app/models/status.rb","lineno":388,"static":false,"parameters":[],"receiver":{"class":"Status","object_id":14909920,"value":"#<Status:0x00007fc931bd42a8>"}},{"id":3040258,"event":"return","thread_id":14909900,"parent_id":3040257,"elapsed":2.6262016035616398e-05,"elapsed_instrumentation":0.0003462249878793955,"return_value":{"class":"StatusStat","value":"#<StatusStat:0x00007fc8e21cc098>","object_id":14909940}},{"id":3040259,"event":"call","thread_id":14909900,"sql_query":{"sql":"SELECT COUNT(*) FROM \"statuses\" WHERE \"statuses\".\"deleted_at\" IS NULL AND \"statuses\".\"in_reply_to_id\" = $1 AND \"statuses\".\"visibility\" != $2","database_type":"postgres"}},{"id":3040260,"event":"return","thread_id":14909900,"parent_id":3040259,"elapsed":0.001077398,"elapsed_instrumentation":0.0002319729537703097},{"id":3040261,"event":"call","thread_id":14909900,"sql_query":{"sql":"SELECT COUNT(*) FROM \"statuses\" WHERE \"statuses\".\"deleted_at\" IS NULL AND \"statuses\".\"reblog_of_id\" = $1","database_type":"postgres"}},{"id":3040262,"event":"return","thread_id":14909900,"parent_id":3040261,"elapsed":0.00094486,"elapsed_instrumentation":9.708700235933065e-05},{"id":3040263,"event":"call","thread_id":14909900,"sql_query":{"sql":"SELECT COUNT(*) FROM \"favourites\" WHERE \"favourites\".\"status_id\" = $1","database_type":"postgres"}},{"id":3040264,"event":"return","thread_id":14909900,"parent_id":3040263,"elapsed":0.000538263,"elapsed_instrumentation":9.407004108652472e-05},{"id":3040265,"event":"call","thread_id":14909900,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_before","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":597,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":14909960,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":318880,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fc93543e670>"}},{"id":3040266,"event":"return","thread_id":14909900,"parent_id":3040265,"elapsed":3.167102113366127e-05,"elapsed_instrumentation":0.00037573400186374784,"return_value":{"class":"Array","value":"[#<Proc:0x00007fc93408b8a8 /workspaces/mastodon/vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib]","object_id":318900,"size":1}},{"id":3040267,"event":"call","thread_id":14909900,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_before","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":597,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":14909980,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":318940,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fc93543e620>"}},{"id":3040268,"event":"return","thread_id":14909900,"parent_id":3040267,"elapsed":0.00010775000555440784,"elapsed_instrumentation":0.0002803239622153342,"return_value":{"class":"Array","value":"[#<Proc:0x00007fc93408ad90 /workspaces/mastodon/vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib, #<Proc:0x00007fc93408af98 /workspaces/mastodon/vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib]","object_id":318960,"size":2}},{"id":3040269,"event":"call","thread_id":14909900,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_after","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":601,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":14909980,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":318940,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fc93543e620>"}},{"id":3040270,"event":"return","thread_id":14909900,"parent_id":3040269,"elapsed":3.6159763112664223e-06,"elapsed_instrumentation":0.0001114180195145309,"return_value":{"class":"Array","value":"[]","object_id":318980,"size":0}},{"id":3040271,"event":"call","thread_id":14909900,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_after","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":601,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":14909960,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":318880,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fc93543e670>"}},{"id":3040272,"event":"return","thread_id":14909900,"parent_id":3040271,"elapsed":2.875982318073511e-06,"elapsed_instrumentation":0.00011091196211054921,"return_value":{"class":"Array","value":"[]","object_id":319000,"size":0}},{"id":3040273,"event":"call","thread_id":14909900,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_before","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":597,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":14910000,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":319040,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fc93543e580>"}},{"id":3040274,"event":"return","thread_id":14909900,"parent_id":3040273,"elapsed":0.00023119698744267225,"elapsed_instrumentation":0.00015720399096608162,"return_value":{"class":"Array","value":"[#<Proc:0x00007fc9340898c8 /workspaces/mastodon/vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib]","object_id":319060,"size":1}},{"id":3040275,"event":"call","thread_id":14909900,"sql_query":{"sql":"SAVEPOINT active_record_1","database_type":"postgres"}},{"id":3040276,"event":"return","thread_id":14909900,"parent_id":3040275,"elapsed":0.00050276,"elapsed_instrumentation":0.00014140200801193714},{"id":3040277,"event":"call","thread_id":14909900,"defined_class":"String","method_id":"unpack1","path":"<internal:pack>","lineno":28,"static":false,"parameters":[{"name":"fmt","class":"String","object_id":319240,"value":"H*","kind":"req"},{"name":"offset","class":"NilClass","object_id":4,"value":null,"kind":"key"}],"receiver":{"class":"String","object_id":14910020,"value":"__\f_\n\u0014\u0000|_;"}},{"id":3040278,"event":"return","thread_id":14909900,"parent_id":3040277,"elapsed":8.671951945871115e-06,"elapsed_instrumentation":0.00026171497302129865,"return_value":{"class":"String","value":"c1a00ceb0a14007ca63b","object_id":14910040}},{"id":3040279,"event":"call","thread_id":14909900,"sql_query":{"sql":"UPDATE \"status_stats\" SET \"replies_count\" = $1, \"reblogs_count\" = $2, \"favourites_count\" = $3, \"updated_at\" = $4 WHERE \"status_stats\".\"id\" = $5","database_type":"postgres"}},{"id":3040280,"event":"return","thread_id":14909900,"parent_id":3040279,"elapsed":0.002471807,"elapsed_instrumentation":0.00021951599046587944},{"id":3040281,"event":"call","thread_id":14909900,"defined_class":"ActiveSupport::Callbacks::CallbackSequence","method_id":"invoke_after","path":"vendor/bundle/ruby/3.2.0/gems/activesupport-7.1.1/lib/active_support/callbacks.rb","lineno":601,"static":false,"parameters":[{"name":"arg","class":"ActiveSupport::Callbacks::Filters::Environment","object_id":14910000,"value":null,"kind":"req"}],"receiver":{"class":"ActiveSupport::Callbacks::CallbackSequence","object_id":319040,"value":"#<ActiveSupport::Callbacks::CallbackSequence:0x00007fc93543e580>"}},{"id":3040282,"event":"return","thread_id":14909900,"parent_id":3040281,"elapsed":6.604008376598358e-06,"elapsed_instrumentation":0.00026839994825422764,"return_value":{"class":"Array","value":"[]","object_id":319080,"size":0}},{"id":3040283,"event":"call","thread_id":14909900,"sql_query":{"sql":"RELEASE SAVEPOINT active_record_1","database_type":"postgres"}},{"id":3040284,"event":"return","thread_id":14909900,"parent_id":3040283,"elapsed":0.000640506,"elapsed_instrumentation":0.0003976210136897862},{"id":3040285,"event":"call","thread_id":14909900,"defined_class":"Chewy::Strategy::Mastodon","method_id":"leave","path":"lib/chewy/strategy/mastodon.rb","lineno":16,"static":false,"parameters":[],"receiver":{"class":"Chewy::Strategy::Mastodon","object_id":14910060,"value":"#<Chewy::Strategy::Mastodon:0x00007fc931c3c498>"}},{"id":3040286,"event":"call","thread_id":14909900,"defined_class":"RedisConfiguration","method_id":"with","path":"app/lib/redis_configuration.rb","lineno":10,"static":true,"parameters":[{"name":"*","class":"Array","object_id":14910080,"value":"[]","kind":"rest","size":0},{"name":"**","class":"Hash","object_id":14910100,"value":"{}","kind":"keyrest","size":0},{"name":"&","class":"NilClass","object_id":4,"value":null,"kind":"block"}],"receiver":{"class":"Class","object_id":32420,"value":"RedisConfiguration"}},{"id":3040287,"event":"call","thread_id":14909900,"defined_class":"RedisConfiguration","method_id":"pool","path":"app/lib/redis_configuration.rb","lineno":12,"static":true,"parameters":[],"receiver":{"class":"Class","object_id":32420,"value":"RedisConfiguration"}},{"id":3040288,"event":"return","thread_id":14909900,"parent_id":3040287,"elapsed":5.328969564288855e-06,"elapsed_instrumentation":0.00014601706061512232,"return_value":{"class":"ConnectionPool","value":"#<ConnectionPool:0x00007fc934c381b0>","object_id":345020}},{"id":3040289,"event":"return","thread_id":14909900,"parent_id":3040286,"elapsed":0.0003080720198340714,"elapsed_instrumentation":0.0004210430197417736,"return_value":{"class":"Array","value":"[]","object_id":14910120,"size":0}},{"id":3040290,"event":"return","thread_id":14909900,"parent_id":3040285,"elapsed":0.0007817019941285253,"elapsed_instrumentation":0.0004194849170744419,"return_value":{"class":"Array","value":"[]","object_id":14910120,"size":0}},{"id":3040291,"event":"return","thread_id":9160,"parent_id":3040248,"elapsed":0.029793121968396008,"elapsed_instrumentation":0.00017930602189153433,"return_value":{"class":"Array","value":"[1, 0]","object_id":14910140,"size":2}},{"id":3040292,"event":"return","thread_id":9160,"parent_id":3040247,"elapsed":0.03083905903622508,"elapsed_instrumentation":0.00023091898765414953,"return_value":{"class":"StringIO","value":"#<StringIO:0x00007fc931b5d310>","object_id":14910160}},{"id":3040293,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT \"status_stats\".* FROM \"status_stats\" WHERE \"status_stats\".\"id\" = $1 LIMIT $2","database_type":"postgres"}},{"id":3040294,"event":"return","thread_id":9160,"parent_id":3040293,"elapsed":0.000853033,"elapsed_instrumentation":0.00021911103976890445},{"id":3040295,"event":"call","thread_id":9160,"defined_class":"StatusStat","method_id":"replies_count","path":"app/models/status_stat.rb","lineno":19,"static":false,"parameters":[],"receiver":{"class":"StatusStat","object_id":14909820,"value":"#<StatusStat:0x00007fc8e21cd0d8>"}},{"id":3040296,"event":"return","thread_id":9160,"parent_id":3040295,"elapsed":0.0004406989901326597,"elapsed_instrumentation":0.0002220619935542345,"return_value":{"class":"Integer","value":"0","object_id":1}}]}