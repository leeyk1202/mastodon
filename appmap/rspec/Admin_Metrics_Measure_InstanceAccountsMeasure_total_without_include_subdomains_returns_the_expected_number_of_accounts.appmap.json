{"version":"1.12.0","metadata":{"app":"mastodon","language":{"name":"ruby","engine":"ruby","version":"3.2.2"},"client":{"name":"appmap","url":"https://github.com/applandinc/appmap-ruby","version":"0.102.1"},"frameworks":[{"name":"rails","version":"7.1.1"},{"name":"rspec","version":"3.12.2"}],"git":{"repository":"https://github.com/sgrigson/mastodon.git","branch":"appmap-config","commit":"2c1ae2317e8741caf25b51e9b3b2c15776c54ae3","status":["M .husky/pre-commit"],"git_last_annotated_tag":"0.1.2-14608-g2c1ae2317e8741caf25b51e9b3b2c15776c54ae3","git_last_tag":"v4.2.0","git_commits_since_last_annotated_tag":0,"git_commits_since_last_tag":0},"name":"Admin::Metrics::Measure::InstanceAccountsMeasure total without include_subdomains returns the expected number of accounts","source_location":"spec/lib/admin/metrics/measure/instance_accounts_measure_spec.rb","recorder":{"name":"rspec","type":"tests"},"test_status":"succeeded"},"classMap":[{"name":"app/lib/admin/metrics/measure","type":"package","children":[{"name":"Admin","type":"class","children":[{"name":"Metrics","type":"class","children":[{"name":"Measure","type":"class","children":[{"name":"BaseMeasure","type":"class","children":[{"name":"total","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:37","static":false},{"name":"load","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:59","static":false},{"name":"cache_key","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:21","static":false},{"name":"canonicalized_params","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:104","static":false},{"name":"perform_queries","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:68","static":false}]},{"name":"InstanceAccountsMeasure","type":"class","children":[{"name":"key","type":"function","location":"app/lib/admin/metrics/measure/instance_accounts_measure.rb:10","static":false},{"name":"params","type":"function","location":"app/lib/admin/metrics/measure/instance_accounts_measure.rb:59","static":false},{"name":"perform_total_query","type":"function","location":"app/lib/admin/metrics/measure/instance_accounts_measure.rb:20","static":false},{"name":"perform_previous_total_query","type":"function","location":"app/lib/admin/metrics/measure/instance_accounts_measure.rb:26","static":false},{"name":"sql_array","type":"function","location":"app/lib/admin/metrics/measure/instance_accounts_measure.rb:30","static":false},{"name":"sql_query_string","type":"function","location":"app/lib/admin/metrics/measure/instance_accounts_measure.rb:34","static":false}]},{"name":"QueryHelper","type":"class","children":[{"name":"perform_data_query","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:6","static":false},{"name":"measurement_data_rows","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:10","static":false},{"name":"sanitized_sql_string","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:14","static":false},{"name":"account_domain_sql","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:18","static":false}]}]}]}]}]},{"name":"logger","type":"package","children":[{"name":"Logger","type":"class","children":[{"name":"LogDevice","type":"class","children":[{"name":"write","type":"function","location":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb:31","static":false,"labels":["log"]}]}]}]},{"name":"ruby","type":"package","children":[{"name":"Marshal","type":"class","children":[{"name":"dump","type":"function","location":"Marshal.dump","static":true,"labels":["serialize"]}]}]}],"events":[{"id":3011715,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"total","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":37,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":14766200,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fc931df74e0>"}},{"id":3011716,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"load","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":14766200,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fc931df74e0>"}},{"id":3011717,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"cache_key","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":21,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":14766200,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fc931df74e0>"}},{"id":3011718,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"key","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":10,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":14766200,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fc931df74e0>"}},{"id":3011719,"event":"return","thread_id":9160,"parent_id":3011718,"elapsed":2.9720249585807323e-06,"elapsed_instrumentation":7.059797644615173e-05,"return_value":{"class":"String","value":"instance_accounts","object_id":14765120}},{"id":3011720,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"canonicalized_params","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":104,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":14766200,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fc931df74e0>"}},{"id":3011721,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":14766200,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fc931df74e0>"}},{"id":3011722,"event":"return","thread_id":9160,"parent_id":3011721,"elapsed":7.343600736930966e-05,"elapsed_instrumentation":7.529102731496096e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":14766220}},{"id":3011723,"event":"return","thread_id":9160,"parent_id":3011720,"elapsed":0.00019801600137725472,"elapsed_instrumentation":6.02740328758955e-05,"return_value":{"class":"String","value":"domain=example.com","object_id":14766240}},{"id":3011724,"event":"return","thread_id":9160,"parent_id":3011717,"elapsed":0.00037972902646288276,"elapsed_instrumentation":6.005499744787812e-05,"return_value":{"class":"String","value":"metrics/measure/instance_accounts;2023-11-04T03:20:10+00:00;2023-11-06T03:20:10+00:00;domain=example (...4 more characters)","object_id":14766260}},{"id":3011725,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":14766280,"value":"Cache read: metrics/measure/instance_accounts;2023-11-04T03:20:10+00:00;2023-11-06T03:20:10+00:00;do (...89 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":3011726,"event":"return","thread_id":9160,"parent_id":3011725,"elapsed":0.0007633949862793088,"elapsed_instrumentation":0.00012366502778604627,"return_value":{"class":"Integer","value":"189","object_id":379}},{"id":3011727,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":14766300,"value":"Cache generate: metrics/measure/instance_accounts;2023-11-04T03:20:10+00:00;2023-11-06T03:20:10+00:0 (...93 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":3011728,"event":"return","thread_id":9160,"parent_id":3011727,"elapsed":0.0007262489525601268,"elapsed_instrumentation":0.00022452900884673,"return_value":{"class":"Integer","value":"193","object_id":387}},{"id":3011729,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"perform_queries","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":68,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":14766200,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fc931df74e0>"}},{"id":3011730,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"perform_total_query","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":20,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":14766200,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fc931df74e0>"}},{"id":3011731,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":14766200,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fc931df74e0>"}},{"id":3011732,"event":"return","thread_id":9160,"parent_id":3011731,"elapsed":6.584095535799861e-05,"elapsed_instrumentation":8.286605589091778e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":14766320}},{"id":3011733,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":14766200,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fc931df74e0>"}},{"id":3011734,"event":"return","thread_id":9160,"parent_id":3011733,"elapsed":6.56300107948482e-05,"elapsed_instrumentation":0.00012332398910075426,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":14766340}},{"id":3011735,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT COUNT(*) FROM \"accounts\" WHERE \"accounts\".\"domain\" = $1","database_type":"postgres"}},{"id":3011736,"event":"return","thread_id":9160,"parent_id":3011735,"elapsed":0.00120276,"elapsed_instrumentation":0.0001587619772180915},{"id":3011737,"event":"return","thread_id":9160,"parent_id":3011730,"elapsed":0.0033970550284720957,"elapsed_instrumentation":0.00012897996930405498,"return_value":{"class":"Integer","value":"3","object_id":7}},{"id":3011738,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"perform_previous_total_query","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":26,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":14766200,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fc931df74e0>"}},{"id":3011739,"event":"return","thread_id":9160,"parent_id":3011738,"elapsed":3.3809919841587543e-06,"elapsed_instrumentation":0.00010221300181001425},{"id":3011740,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"perform_data_query","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":6,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":14766200,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fc931df74e0>"}},{"id":3011741,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"measurement_data_rows","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":10,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":14766200,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fc931df74e0>"}},{"id":3011742,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"sanitized_sql_string","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":14,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":14766200,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fc931df74e0>"}},{"id":3011743,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"sql_array","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":30,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":14766200,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fc931df74e0>"}},{"id":3011744,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"sql_query_string","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":34,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":14766200,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fc931df74e0>"}},{"id":3011745,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":14766200,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fc931df74e0>"}},{"id":3011746,"event":"return","thread_id":9160,"parent_id":3011745,"elapsed":7.931498112156987e-05,"elapsed_instrumentation":8.118100231513381e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":14766360}},{"id":3011747,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"account_domain_sql","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":18,"static":false,"parameters":[{"name":"include_subdomains","class":"NilClass","object_id":4,"value":null,"kind":"req"}],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":14766200,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fc931df74e0>"}},{"id":3011748,"event":"return","thread_id":9160,"parent_id":3011747,"elapsed":4.268018528819084e-06,"elapsed_instrumentation":8.620094740763307e-05,"return_value":{"class":"String","value":"accounts.domain = :domain::text","object_id":3036700}},{"id":3011749,"event":"return","thread_id":9160,"parent_id":3011744,"elapsed":0.00034579902421683073,"elapsed_instrumentation":5.94009761698544e-05,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH new_accounts AS ( SELECT accounts.id FROM accounts WHERE date_trunc('day', acc (...280 more characters)","object_id":14766380}},{"id":3011750,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":14766200,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fc931df74e0>"}},{"id":3011751,"event":"return","thread_id":9160,"parent_id":3011750,"elapsed":3.904203185811639e-05,"elapsed_instrumentation":7.576303323730826e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":14766400}},{"id":3011752,"event":"return","thread_id":9160,"parent_id":3011743,"elapsed":0.0005549180204980075,"elapsed_instrumentation":0.00014742003986611962,"return_value":{"class":"Array","value":"[SELECT axis.*, ( WITH new_accounts AS ( SELECT accounts.id FROM accounts WHERE date_trunc('day', acc (...280 more characters), {:start_at=>2023-11-04T03:20:10+00:00, :end_at=>2023-11-06T03:20:10+00:00, :domain=>example.com}]","object_id":14766420,"size":2}},{"id":3011753,"event":"return","thread_id":9160,"parent_id":3011742,"elapsed":0.0010823310003615916,"elapsed_instrumentation":0.0001776449498720467,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH new_accounts AS ( SELECT accounts.id FROM accounts WHERE date_trunc('day', acc (...326 more characters)","object_id":14766440}},{"id":3011754,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT axis.*, ( WITH new_accounts AS ( SELECT accounts.id FROM accounts WHERE date_trunc('day', accounts.created_at)::date = axis.period AND accounts.domain = 'example.com'::text ) SELECT count(*) FROM new_accounts ) AS value FROM ( SELECT generate_series(date_trunc('day', '2023-11-04 03:20:10.782309'::timestamp)::date, date_trunc('day', '2023-11-06 03:20:10.782489'::timestamp)::date, interval '1 day') AS period ) AS axis","database_type":"postgres"}},{"id":3011755,"event":"return","thread_id":9160,"parent_id":3011754,"elapsed":0.001299419,"elapsed_instrumentation":8.805003017187119e-05},{"id":3011756,"event":"return","thread_id":9160,"parent_id":3011741,"elapsed":0.003000890021212399,"elapsed_instrumentation":8.881196845322847e-05,"return_value":{"class":"ActiveRecord::Result","value":"#<ActiveRecord::Result:0x00007fc931df50f0>","object_id":14766460}},{"id":3011757,"event":"return","thread_id":9160,"parent_id":3011740,"elapsed":0.003229745023418218,"elapsed_instrumentation":0.00018677703337743878,"return_value":{"class":"Array","value":"[{:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}, {:date=>2023-11-06 00:00:00 +0000, :value=>1}]","object_id":14766480,"size":3}},{"id":3011758,"event":"return","thread_id":9160,"parent_id":3011729,"elapsed":0.007116915017832071,"elapsed_instrumentation":0.00029249803628772497,"return_value":{"class":"Hash","value":"{:total=>3, :previous_total=>, :data=>[{:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}, {:date=>2023-11-06 00:00:00 +0000, :value=>1}]}","object_id":14766500,"size":3}},{"id":3011759,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":14766520,"value":"Cache write: metrics/measure/instance_accounts;2023-11-04T03:20:10+00:00;2023-11-06T03:20:10+00:00;d (...90 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":3011760,"event":"return","thread_id":9160,"parent_id":3011759,"elapsed":0.0011190319783054292,"elapsed_instrumentation":0.0001347600482404232,"return_value":{"class":"Integer","value":"190","object_id":381}},{"id":3011761,"event":"call","thread_id":9160,"defined_class":"Marshal","method_id":"dump","path":"Marshal.dump","static":true,"parameters":[{"name":"arg","class":"Array","object_id":14766540,"value":"[{:total=>3, :previous_total=>, :data=>[{:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}, {:date=>2023-11-06 00:00:00 +0000, :value=>1}]}]","kind":"rest","size":1}],"receiver":{"class":"Module","object_id":318180,"value":"Marshal"}},{"id":3011762,"event":"return","thread_id":9160,"parent_id":3011761,"elapsed":3.7380028516054153e-05,"elapsed_instrumentation":0.00040050497045740485,"return_value":{"class":"String","value":"\u0004\b{\b:\ntotali\b:\u0013previous_total0:\tdata[\b{\u0007:\tdateIu:\tTime\r__\u001e_\u0000\u0000\u0000\u0000\u0007:\u000boffseti\u0000:\tzone0:\nvalueI\"\u00060\u0006:\u0006EF{\u0007; (...67 more characters)","object_id":14766560}},{"id":3011763,"event":"return","thread_id":9160,"parent_id":3011716,"elapsed":0.012136264005675912,"elapsed_instrumentation":0.00021700497018173337,"return_value":{"class":"ActiveSupport::HashWithIndifferentAccess","value":"{total=>3, previous_total=>, data=>[{date=>2023-11-04 00:00:00 +0000, value=>0}, {date=>2023-11-05 00:00:00 +0000, value=>0}, {date=>2023-11-06 00:00:00 +0000, value=>1}]}","object_id":14766580,"size":3}},{"id":3011764,"event":"return","thread_id":9160,"parent_id":3011715,"elapsed":0.012378095008898526,"elapsed_instrumentation":0.0002937649842351675,"return_value":{"class":"Integer","value":"3","object_id":7}}]}