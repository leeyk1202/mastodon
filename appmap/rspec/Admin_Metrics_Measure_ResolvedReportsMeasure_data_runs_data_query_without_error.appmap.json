{"version":"1.12.0","metadata":{"app":"mastodon","language":{"name":"ruby","engine":"ruby","version":"3.2.2"},"client":{"name":"appmap","url":"https://github.com/applandinc/appmap-ruby","version":"0.102.1"},"frameworks":[{"name":"rails","version":"7.1.1"},{"name":"rspec","version":"3.12.2"}],"git":{"repository":"https://github.com/sgrigson/mastodon.git","branch":"appmap-config","commit":"743782bd299fd54e12a4a5829872efc505132ab3","status":["M .husky/pre-commit","?? sql_warning.txt"],"git_last_annotated_tag":"0.1.2-14597-g743782bd299fd54e12a4a5829872efc505132ab3","git_last_tag":"v4.2.0","git_commits_since_last_annotated_tag":0,"git_commits_since_last_tag":0},"name":"Admin::Metrics::Measure::ResolvedReportsMeasure #data runs data query without error","source_location":"spec/lib/admin/metrics/measure/resolved_reports_measure_spec.rb","recorder":{"name":"rspec","type":"tests"},"test_status":"succeeded"},"classMap":[{"name":"app/lib/admin/metrics/measure","type":"package","children":[{"name":"Admin","type":"class","children":[{"name":"Metrics","type":"class","children":[{"name":"Measure","type":"class","children":[{"name":"BaseMeasure","type":"class","children":[{"name":"data","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:45","static":false},{"name":"load","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:59","static":false},{"name":"cache_key","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:21","static":false},{"name":"canonicalized_params","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:104","static":false},{"name":"params","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:100","static":false},{"name":"perform_queries","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:68","static":false},{"name":"time_period","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:88","static":false},{"name":"previous_time_period","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:92","static":false},{"name":"length_of_period","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:96","static":false}]},{"name":"ResolvedReportsMeasure","type":"class","children":[{"name":"key","type":"function","location":"app/lib/admin/metrics/measure/resolved_reports_measure.rb:6","static":false},{"name":"perform_total_query","type":"function","location":"app/lib/admin/metrics/measure/resolved_reports_measure.rb:12","static":false},{"name":"perform_previous_total_query","type":"function","location":"app/lib/admin/metrics/measure/resolved_reports_measure.rb:16","static":false},{"name":"sql_array","type":"function","location":"app/lib/admin/metrics/measure/resolved_reports_measure.rb:20","static":false},{"name":"sql_query_string","type":"function","location":"app/lib/admin/metrics/measure/resolved_reports_measure.rb:24","static":false}]},{"name":"QueryHelper","type":"class","children":[{"name":"perform_data_query","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:6","static":false},{"name":"measurement_data_rows","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:10","static":false},{"name":"sanitized_sql_string","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:14","static":false}]}]}]}]}]},{"name":"logger","type":"package","children":[{"name":"Logger","type":"class","children":[{"name":"LogDevice","type":"class","children":[{"name":"write","type":"function","location":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb:31","static":false,"labels":["log"]}]}]}]},{"name":"ruby","type":"package","children":[{"name":"Marshal","type":"class","children":[{"name":"dump","type":"function","location":"Marshal.dump","static":true,"labels":["serialize"]}]}]}],"events":[{"id":1593967,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"data","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":45,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::ResolvedReportsMeasure","object_id":8705280,"value":"#<Admin::Metrics::Measure::ResolvedReportsMeasure:0x00007fdc074aa020>"}},{"id":1593968,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"load","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::ResolvedReportsMeasure","object_id":8705280,"value":"#<Admin::Metrics::Measure::ResolvedReportsMeasure:0x00007fdc074aa020>"}},{"id":1593969,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"cache_key","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":21,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::ResolvedReportsMeasure","object_id":8705280,"value":"#<Admin::Metrics::Measure::ResolvedReportsMeasure:0x00007fdc074aa020>"}},{"id":1593970,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::ResolvedReportsMeasure","method_id":"key","path":"app/lib/admin/metrics/measure/resolved_reports_measure.rb","lineno":6,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::ResolvedReportsMeasure","object_id":8705280,"value":"#<Admin::Metrics::Measure::ResolvedReportsMeasure:0x00007fdc074aa020>"}},{"id":1593971,"event":"return","thread_id":9160,"parent_id":1593970,"elapsed":2.8999929782003164e-06,"elapsed_instrumentation":0.00013283899170346558,"return_value":{"class":"String","value":"resolved_reports","object_id":8705300}},{"id":1593972,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"canonicalized_params","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":104,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::ResolvedReportsMeasure","object_id":8705280,"value":"#<Admin::Metrics::Measure::ResolvedReportsMeasure:0x00007fdc074aa020>"}},{"id":1593973,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":100,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::ResolvedReportsMeasure","object_id":8705280,"value":"#<Admin::Metrics::Measure::ResolvedReportsMeasure:0x00007fdc074aa020>"}},{"id":1593974,"event":"return","thread_id":9160,"parent_id":1593973,"elapsed":2.2450112737715244e-06,"elapsed_instrumentation":9.293996845372021e-05,"return_value":{"class":"Hash","value":"{}","object_id":8705320,"size":0}},{"id":1593975,"event":"return","thread_id":9160,"parent_id":1593972,"elapsed":0.00011843000538647175,"elapsed_instrumentation":6.9650006480515e-05,"return_value":{"class":"String","value":"","object_id":8705340}},{"id":1593976,"event":"return","thread_id":9160,"parent_id":1593969,"elapsed":0.0003905109770130366,"elapsed_instrumentation":7.360399467870593e-05,"return_value":{"class":"String","value":"metrics/measure/resolved_reports;2023-11-03T23:27:03+00:00;2023-11-05T23:27:03+00:00;","object_id":8705360}},{"id":1593977,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":8705380,"value":"Cache read: metrics/measure/resolved_reports;2023-11-03T23:27:03+00:00;2023-11-05T23:27:03+00:00; ({ (...70 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fdc1b4b7180>"}},{"id":1593978,"event":"return","thread_id":9160,"parent_id":1593977,"elapsed":0.0010535530163906515,"elapsed_instrumentation":0.0001890829880721867,"return_value":{"class":"Integer","value":"170","object_id":341}},{"id":1593979,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":8705400,"value":"Cache generate: metrics/measure/resolved_reports;2023-11-03T23:27:03+00:00;2023-11-05T23:27:03+00:00 (...74 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fdc1b4b7180>"}},{"id":1593980,"event":"return","thread_id":9160,"parent_id":1593979,"elapsed":0.0009035209950525314,"elapsed_instrumentation":0.00015022596926428378,"return_value":{"class":"Integer","value":"174","object_id":349}},{"id":1593981,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"perform_queries","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":68,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::ResolvedReportsMeasure","object_id":8705280,"value":"#<Admin::Metrics::Measure::ResolvedReportsMeasure:0x00007fdc074aa020>"}},{"id":1593982,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::ResolvedReportsMeasure","method_id":"perform_total_query","path":"app/lib/admin/metrics/measure/resolved_reports_measure.rb","lineno":12,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::ResolvedReportsMeasure","object_id":8705280,"value":"#<Admin::Metrics::Measure::ResolvedReportsMeasure:0x00007fdc074aa020>"}},{"id":1593983,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"time_period","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":88,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::ResolvedReportsMeasure","object_id":8705280,"value":"#<Admin::Metrics::Measure::ResolvedReportsMeasure:0x00007fdc074aa020>"}},{"id":1593984,"event":"return","thread_id":9160,"parent_id":1593983,"elapsed":1.572497421875596e-05,"elapsed_instrumentation":0.0007328520005103201,"return_value":{"class":"Range","value":"2023-11-03T23:27:03+00:00..2023-11-05T23:27:03+00:00","object_id":8705420}},{"id":1593985,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT COUNT(*) FROM \"reports\" WHERE \"reports\".\"action_taken_at\" IS NOT NULL AND \"reports\".\"action_taken_at\" BETWEEN $1 AND $2","database_type":"postgres"}},{"id":1593986,"event":"return","thread_id":9160,"parent_id":1593985,"elapsed":0.0010862,"elapsed_instrumentation":0.00011678400915116072},{"id":1593987,"event":"return","thread_id":9160,"parent_id":1593982,"elapsed":0.0038273500103969127,"elapsed_instrumentation":0.0001964370021596551,"return_value":{"class":"Integer","value":"0","object_id":1}},{"id":1593988,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::ResolvedReportsMeasure","method_id":"perform_previous_total_query","path":"app/lib/admin/metrics/measure/resolved_reports_measure.rb","lineno":16,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::ResolvedReportsMeasure","object_id":8705280,"value":"#<Admin::Metrics::Measure::ResolvedReportsMeasure:0x00007fdc074aa020>"}},{"id":1593989,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"previous_time_period","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":92,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::ResolvedReportsMeasure","object_id":8705280,"value":"#<Admin::Metrics::Measure::ResolvedReportsMeasure:0x00007fdc074aa020>"}},{"id":1593990,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"length_of_period","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":96,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::ResolvedReportsMeasure","object_id":8705280,"value":"#<Admin::Metrics::Measure::ResolvedReportsMeasure:0x00007fdc074aa020>"}},{"id":1593991,"event":"return","thread_id":9160,"parent_id":1593990,"elapsed":1.8551014363765717e-05,"elapsed_instrumentation":8.907297160476446e-05,"return_value":{"class":"Rational","value":"345600000629/172800000000","object_id":8705440}},{"id":1593992,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"length_of_period","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":96,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::ResolvedReportsMeasure","object_id":8705280,"value":"#<Admin::Metrics::Measure::ResolvedReportsMeasure:0x00007fdc074aa020>"}},{"id":1593993,"event":"return","thread_id":9160,"parent_id":1593992,"elapsed":4.539993824437261e-06,"elapsed_instrumentation":0.00011975999223068357,"return_value":{"class":"Rational","value":"345600000629/172800000000","object_id":8705440}},{"id":1593994,"event":"return","thread_id":9160,"parent_id":1593989,"elapsed":0.0010449489927850664,"elapsed_instrumentation":0.00013135198969393969,"return_value":{"class":"Range","value":"2023-11-01T23:27:03+00:00..2023-11-03T23:27:03+00:00","object_id":8705460}},{"id":1593995,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT COUNT(*) FROM \"reports\" WHERE \"reports\".\"action_taken_at\" IS NOT NULL AND \"reports\".\"action_taken_at\" BETWEEN $1 AND $2","database_type":"postgres"}},{"id":1593996,"event":"return","thread_id":9160,"parent_id":1593995,"elapsed":0.000851198,"elapsed_instrumentation":0.0001033990120049566},{"id":1593997,"event":"return","thread_id":9160,"parent_id":1593988,"elapsed":0.003565589984646067,"elapsed_instrumentation":0.00015814602375030518,"return_value":{"class":"Integer","value":"0","object_id":1}},{"id":1593998,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"perform_data_query","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":6,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::ResolvedReportsMeasure","object_id":8705280,"value":"#<Admin::Metrics::Measure::ResolvedReportsMeasure:0x00007fdc074aa020>"}},{"id":1593999,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"measurement_data_rows","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":10,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::ResolvedReportsMeasure","object_id":8705280,"value":"#<Admin::Metrics::Measure::ResolvedReportsMeasure:0x00007fdc074aa020>"}},{"id":1594000,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"sanitized_sql_string","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":14,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::ResolvedReportsMeasure","object_id":8705280,"value":"#<Admin::Metrics::Measure::ResolvedReportsMeasure:0x00007fdc074aa020>"}},{"id":1594001,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::ResolvedReportsMeasure","method_id":"sql_array","path":"app/lib/admin/metrics/measure/resolved_reports_measure.rb","lineno":20,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::ResolvedReportsMeasure","object_id":8705280,"value":"#<Admin::Metrics::Measure::ResolvedReportsMeasure:0x00007fdc074aa020>"}},{"id":1594002,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::ResolvedReportsMeasure","method_id":"sql_query_string","path":"app/lib/admin/metrics/measure/resolved_reports_measure.rb","lineno":24,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::ResolvedReportsMeasure","object_id":8705280,"value":"#<Admin::Metrics::Measure::ResolvedReportsMeasure:0x00007fdc074aa020>"}},{"id":1594003,"event":"return","thread_id":9160,"parent_id":1594002,"elapsed":7.396197179332376e-05,"elapsed_instrumentation":8.687999797984958e-05,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH resolved_reports AS ( SELECT reports.id FROM reports WHERE date_trunc('day', r (...254 more characters)","object_id":8705480}},{"id":1594004,"event":"return","thread_id":9160,"parent_id":1594001,"elapsed":0.0001808159868232906,"elapsed_instrumentation":0.00015470400103367865,"return_value":{"class":"Array","value":"[SELECT axis.*, ( WITH resolved_reports AS ( SELECT reports.id FROM reports WHERE date_trunc('day', r (...254 more characters), {:start_at=>2023-11-03T23:27:03+00:00, :end_at=>2023-11-05T23:27:03+00:00}]","object_id":8705500,"size":2}},{"id":1594005,"event":"return","thread_id":9160,"parent_id":1594000,"elapsed":0.0004807699879165739,"elapsed_instrumentation":7.461101631633937e-05,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH resolved_reports AS ( SELECT reports.id FROM reports WHERE date_trunc('day', r (...294 more characters)","object_id":8705520}},{"id":1594006,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT axis.*, ( WITH resolved_reports AS ( SELECT reports.id FROM reports WHERE date_trunc('day', reports.action_taken_at)::date = axis.period ) SELECT count(*) FROM resolved_reports ) AS value FROM ( SELECT generate_series(date_trunc('day', '2023-11-03 23:27:03.026629'::timestamp)::date, date_trunc('day', '2023-11-05 23:27:03.026944'::timestamp)::date, interval '1 day') AS period ) AS axis","database_type":"postgres"}},{"id":1594007,"event":"return","thread_id":9160,"parent_id":1594006,"elapsed":0.001305651,"elapsed_instrumentation":9.236601181328297e-05},{"id":1594008,"event":"return","thread_id":9160,"parent_id":1593999,"elapsed":0.0023144940205384046,"elapsed_instrumentation":0.0001259779674001038,"return_value":{"class":"ActiveRecord::Result","value":"#<ActiveRecord::Result:0x00007fdc074a7fa0>","object_id":8705540}},{"id":1594009,"event":"return","thread_id":9160,"parent_id":1593998,"elapsed":0.00249378799344413,"elapsed_instrumentation":0.00044790998799726367,"return_value":{"class":"Array","value":"[{:date=>2023-11-03 00:00:00 +0000, :value=>0}, {:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}]","object_id":8705560,"size":3}},{"id":1594010,"event":"return","thread_id":9160,"parent_id":1593981,"elapsed":0.010943760978989303,"elapsed_instrumentation":0.00034629603032954037,"return_value":{"class":"Hash","value":"{:total=>0, :previous_total=>0, :data=>[{:date=>2023-11-03 00:00:00 +0000, :value=>0}, {:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}]}","object_id":8705580,"size":3}},{"id":1594011,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":8705600,"value":"Cache write: metrics/measure/resolved_reports;2023-11-03T23:27:03+00:00;2023-11-05T23:27:03+00:00; ( (...71 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fdc1b4b7180>"}},{"id":1594012,"event":"return","thread_id":9160,"parent_id":1594011,"elapsed":0.0011647249921225011,"elapsed_instrumentation":0.0002460370014887303,"return_value":{"class":"Integer","value":"171","object_id":343}},{"id":1594013,"event":"call","thread_id":9160,"defined_class":"Marshal","method_id":"dump","path":"Marshal.dump","static":true,"parameters":[{"name":"arg","class":"Array","object_id":8705620,"value":"[{:total=>0, :previous_total=>0, :data=>[{:date=>2023-11-03 00:00:00 +0000, :value=>0}, {:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}]}]","kind":"rest","size":1}],"receiver":{"class":"Module","object_id":209120,"value":"Marshal"}},{"id":1594014,"event":"return","thread_id":9160,"parent_id":1594013,"elapsed":4.426098894327879e-05,"elapsed_instrumentation":0.000364909996278584,"return_value":{"class":"String","value":"\u0004\b{\b:\ntotali\u0000:\u0013previous_totali\u0000:\tdata[\b{\u0007:\tdateIu:\tTime\r`_\u001e_\u0000\u0000\u0000\u0000\u0007:\u000boffseti\u0000:\tzone0:\nvalueI\"\u00060\u0006:\u0006EF{\u0007 (...68 more characters)","object_id":8705640}},{"id":1594015,"event":"return","thread_id":9160,"parent_id":1593968,"elapsed":0.017216117994394153,"elapsed_instrumentation":0.00024255600874312222,"return_value":{"class":"ActiveSupport::HashWithIndifferentAccess","value":"{total=>0, previous_total=>0, data=>[{date=>2023-11-03 00:00:00 +0000, value=>0}, {date=>2023-11-04 00:00:00 +0000, value=>0}, {date=>2023-11-05 00:00:00 +0000, value=>0}]}","object_id":8705660,"size":3}},{"id":1594016,"event":"return","thread_id":9160,"parent_id":1593967,"elapsed":0.01748594900709577,"elapsed_instrumentation":0.00041046098340302706,"return_value":{"class":"Array","value":"[{date=>2023-11-03 00:00:00 +0000, value=>0}, {date=>2023-11-04 00:00:00 +0000, value=>0}, {date=>2023-11-05 00:00:00 +0000, value=>0}]","object_id":8705680,"size":3}}]}