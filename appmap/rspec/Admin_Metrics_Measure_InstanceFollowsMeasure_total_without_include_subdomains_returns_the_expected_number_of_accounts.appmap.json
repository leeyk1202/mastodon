{"version":"1.12.0","metadata":{"app":"mastodon","language":{"name":"ruby","engine":"ruby","version":"3.2.2"},"client":{"name":"appmap","url":"https://github.com/applandinc/appmap-ruby","version":"0.102.1"},"frameworks":[{"name":"rails","version":"7.1.1"},{"name":"rspec","version":"3.12.2"}],"git":{"repository":"https://github.com/sgrigson/mastodon.git","branch":"appmap-config","commit":"2c1ae2317e8741caf25b51e9b3b2c15776c54ae3","status":["M .husky/pre-commit"],"git_last_annotated_tag":"0.1.2-14608-g2c1ae2317e8741caf25b51e9b3b2c15776c54ae3","git_last_tag":"v4.2.0","git_commits_since_last_annotated_tag":0,"git_commits_since_last_tag":0},"name":"Admin::Metrics::Measure::InstanceFollowsMeasure total without include_subdomains returns the expected number of accounts","source_location":"spec/lib/admin/metrics/measure/instance_follows_measure_spec.rb","recorder":{"name":"rspec","type":"tests"},"test_status":"succeeded"},"classMap":[{"name":"app/lib/admin/metrics/measure","type":"package","children":[{"name":"Admin","type":"class","children":[{"name":"Metrics","type":"class","children":[{"name":"Measure","type":"class","children":[{"name":"BaseMeasure","type":"class","children":[{"name":"total","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:37","static":false},{"name":"load","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:59","static":false},{"name":"cache_key","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:21","static":false},{"name":"canonicalized_params","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:104","static":false},{"name":"perform_queries","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:68","static":false}]},{"name":"InstanceFollowsMeasure","type":"class","children":[{"name":"key","type":"function","location":"app/lib/admin/metrics/measure/instance_follows_measure.rb:10","static":false},{"name":"params","type":"function","location":"app/lib/admin/metrics/measure/instance_follows_measure.rb:60","static":false},{"name":"perform_total_query","type":"function","location":"app/lib/admin/metrics/measure/instance_follows_measure.rb:20","static":false},{"name":"perform_previous_total_query","type":"function","location":"app/lib/admin/metrics/measure/instance_follows_measure.rb:26","static":false},{"name":"sql_array","type":"function","location":"app/lib/admin/metrics/measure/instance_follows_measure.rb:30","static":false},{"name":"sql_query_string","type":"function","location":"app/lib/admin/metrics/measure/instance_follows_measure.rb:34","static":false}]},{"name":"QueryHelper","type":"class","children":[{"name":"perform_data_query","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:6","static":false},{"name":"measurement_data_rows","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:10","static":false},{"name":"sanitized_sql_string","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:14","static":false},{"name":"account_domain_sql","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:18","static":false}]}]}]}]}]},{"name":"logger","type":"package","children":[{"name":"Logger","type":"class","children":[{"name":"LogDevice","type":"class","children":[{"name":"write","type":"function","location":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb:31","static":false,"labels":["log"]}]}]}]},{"name":"ruby","type":"package","children":[{"name":"Marshal","type":"class","children":[{"name":"dump","type":"function","location":"Marshal.dump","static":true,"labels":["serialize"]}]}]}],"events":[{"id":906311,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"total","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":37,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5547360,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc931067280>"}},{"id":906312,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"load","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5547360,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc931067280>"}},{"id":906313,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"cache_key","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":21,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5547360,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc931067280>"}},{"id":906314,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"key","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":10,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5547360,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc931067280>"}},{"id":906315,"event":"return","thread_id":9160,"parent_id":906314,"elapsed":3.130000550299883e-06,"elapsed_instrumentation":0.00011163903400301933,"return_value":{"class":"String","value":"instance_follows","object_id":5547380}},{"id":906316,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"canonicalized_params","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":104,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5547360,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc931067280>"}},{"id":906317,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5547360,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc931067280>"}},{"id":906318,"event":"return","thread_id":9160,"parent_id":906317,"elapsed":7.327902130782604e-05,"elapsed_instrumentation":0.0001020299969241023,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":5547400}},{"id":906319,"event":"return","thread_id":9160,"parent_id":906316,"elapsed":0.00036415201611816883,"elapsed_instrumentation":0.00010505400132387877,"return_value":{"class":"String","value":"domain=example.com","object_id":5547420}},{"id":906320,"event":"return","thread_id":9160,"parent_id":906313,"elapsed":0.0006531249964609742,"elapsed_instrumentation":7.070298306643963e-05,"return_value":{"class":"String","value":"metrics/measure/instance_follows;2023-11-04T02:57:57+00:00;2023-11-06T02:57:57+00:00;domain=example. (...3 more characters)","object_id":5547440}},{"id":906321,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":5547460,"value":"Cache read: metrics/measure/instance_follows;2023-11-04T02:57:57+00:00;2023-11-06T02:57:57+00:00;dom (...88 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":906322,"event":"return","thread_id":9160,"parent_id":906321,"elapsed":0.0006801669951528311,"elapsed_instrumentation":0.00015054200775921345,"return_value":{"class":"Integer","value":"188","object_id":377}},{"id":906323,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":5547480,"value":"Cache generate: metrics/measure/instance_follows;2023-11-04T02:57:57+00:00;2023-11-06T02:57:57+00:00 (...92 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":906324,"event":"return","thread_id":9160,"parent_id":906323,"elapsed":0.0007803430198691785,"elapsed_instrumentation":0.00019000499742105603,"return_value":{"class":"Integer","value":"192","object_id":385}},{"id":906325,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"perform_queries","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":68,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5547360,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc931067280>"}},{"id":906326,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"perform_total_query","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":20,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5547360,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc931067280>"}},{"id":906327,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5547360,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc931067280>"}},{"id":906328,"event":"return","thread_id":9160,"parent_id":906327,"elapsed":0.00021731702145189047,"elapsed_instrumentation":0.0001276159891858697,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":5547500}},{"id":906329,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5547360,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc931067280>"}},{"id":906330,"event":"return","thread_id":9160,"parent_id":906329,"elapsed":4.715705290436745e-05,"elapsed_instrumentation":9.631190914660692e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":5547520}},{"id":906331,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT COUNT(*) FROM \"follows\" INNER JOIN \"accounts\" ON \"accounts\".\"id\" = \"follows\".\"target_account_id\" WHERE \"accounts\".\"domain\" = $1","database_type":"postgres"}},{"id":906332,"event":"return","thread_id":9160,"parent_id":906331,"elapsed":0.001823401,"elapsed_instrumentation":0.0001736690173856914},{"id":906333,"event":"return","thread_id":9160,"parent_id":906326,"elapsed":0.005352113978005946,"elapsed_instrumentation":0.00021628098329529166,"return_value":{"class":"Integer","value":"2","object_id":5}},{"id":906334,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"perform_previous_total_query","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":26,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5547360,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc931067280>"}},{"id":906335,"event":"return","thread_id":9160,"parent_id":906334,"elapsed":3.536988515406847e-06,"elapsed_instrumentation":0.0002762979711405933},{"id":906336,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"perform_data_query","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":6,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5547360,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc931067280>"}},{"id":906337,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"measurement_data_rows","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":10,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5547360,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc931067280>"}},{"id":906338,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"sanitized_sql_string","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":14,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5547360,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc931067280>"}},{"id":906339,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"sql_array","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":30,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5547360,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc931067280>"}},{"id":906340,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"sql_query_string","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":34,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5547360,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc931067280>"}},{"id":906341,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5547360,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc931067280>"}},{"id":906342,"event":"return","thread_id":9160,"parent_id":906341,"elapsed":8.227396756410599e-05,"elapsed_instrumentation":0.0001091290614567697,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":5547540}},{"id":906343,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"account_domain_sql","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":18,"static":false,"parameters":[{"name":"include_subdomains","class":"NilClass","object_id":4,"value":null,"kind":"req"}],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5547360,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc931067280>"}},{"id":906344,"event":"return","thread_id":9160,"parent_id":906343,"elapsed":5.750043783336878e-06,"elapsed_instrumentation":0.00014088198076933622,"return_value":{"class":"String","value":"accounts.domain = :domain::text","object_id":3036700}},{"id":906345,"event":"return","thread_id":9160,"parent_id":906340,"elapsed":0.0004977880162186921,"elapsed_instrumentation":0.00010630895849317312,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH new_follows AS ( SELECT follows.id FROM follows INNER JOIN accounts ON follows (...338 more characters)","object_id":5547560}},{"id":906346,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5547360,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc931067280>"}},{"id":906347,"event":"return","thread_id":9160,"parent_id":906346,"elapsed":6.39149802736938e-05,"elapsed_instrumentation":0.00013764901086688042,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":5547580}},{"id":906348,"event":"return","thread_id":9160,"parent_id":906339,"elapsed":0.0009641200304031372,"elapsed_instrumentation":0.0002945139422081411,"return_value":{"class":"Array","value":"[SELECT axis.*, ( WITH new_follows AS ( SELECT follows.id FROM follows INNER JOIN accounts ON follows (...338 more characters), {:start_at=>2023-11-04T02:57:57+00:00, :end_at=>2023-11-06T02:57:57+00:00, :domain=>example.com}]","object_id":5547600,"size":2}},{"id":906349,"event":"return","thread_id":9160,"parent_id":906338,"elapsed":0.001537058036774397,"elapsed_instrumentation":0.00030773296020925045,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH new_follows AS ( SELECT follows.id FROM follows INNER JOIN accounts ON follows (...384 more characters)","object_id":5547620}},{"id":906350,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT axis.*, ( WITH new_follows AS ( SELECT follows.id FROM follows INNER JOIN accounts ON follows.target_account_id = accounts.id WHERE date_trunc('day', follows.created_at)::date = axis.period AND accounts.domain = 'example.com'::text ) SELECT count(*) FROM new_follows ) AS value FROM ( SELECT generate_series(date_trunc('day', '2023-11-04 02:57:57.282285'::timestamp)::date, date_trunc('day', '2023-11-06 02:57:57.282682'::timestamp)::date, interval '1 day') AS period ) AS axis","database_type":"postgres"}},{"id":906351,"event":"return","thread_id":9160,"parent_id":906350,"elapsed":0.002615238,"elapsed_instrumentation":0.0001391789992339909},{"id":906352,"event":"return","thread_id":9160,"parent_id":906337,"elapsed":0.005387137003708631,"elapsed_instrumentation":0.00021376594668254256,"return_value":{"class":"ActiveRecord::Result","value":"#<ActiveRecord::Result:0x00007fc931065480>","object_id":5547640}},{"id":906353,"event":"return","thread_id":9160,"parent_id":906336,"elapsed":0.005670725950039923,"elapsed_instrumentation":0.00022198102669790387,"return_value":{"class":"Array","value":"[{:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}, {:date=>2023-11-06 00:00:00 +0000, :value=>2}]","object_id":5547660,"size":3}},{"id":906354,"event":"return","thread_id":9160,"parent_id":906325,"elapsed":0.011853775009512901,"elapsed_instrumentation":0.0003315749345347285,"return_value":{"class":"Hash","value":"{:total=>2, :previous_total=>, :data=>[{:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}, {:date=>2023-11-06 00:00:00 +0000, :value=>2}]}","object_id":5547680,"size":3}},{"id":906355,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":5547700,"value":"Cache write: metrics/measure/instance_follows;2023-11-04T02:57:57+00:00;2023-11-06T02:57:57+00:00;do (...89 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":906356,"event":"return","thread_id":9160,"parent_id":906355,"elapsed":0.000893965014256537,"elapsed_instrumentation":0.0004361250321380794,"return_value":{"class":"Integer","value":"189","object_id":379}},{"id":906357,"event":"call","thread_id":9160,"defined_class":"Marshal","method_id":"dump","path":"Marshal.dump","static":true,"parameters":[{"name":"arg","class":"Array","object_id":5547720,"value":"[{:total=>2, :previous_total=>, :data=>[{:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}, {:date=>2023-11-06 00:00:00 +0000, :value=>2}]}]","kind":"rest","size":1}],"receiver":{"class":"Module","object_id":318180,"value":"Marshal"}},{"id":906358,"event":"return","thread_id":9160,"parent_id":906357,"elapsed":6.275402847677469e-05,"elapsed_instrumentation":0.000580094987526536,"return_value":{"class":"String","value":"\u0004\b{\b:\ntotali\u0007:\u0013previous_total0:\tdata[\b{\u0007:\tdateIu:\tTime\r__\u001e_\u0000\u0000\u0000\u0000\u0007:\u000boffseti\u0000:\tzone0:\nvalueI\"\u00060\u0006:\u0006EF{\u0007; (...67 more characters)","object_id":5547740}},{"id":906359,"event":"return","thread_id":9160,"parent_id":906312,"elapsed":0.01776778104249388,"elapsed_instrumentation":0.00023005896946415305,"return_value":{"class":"ActiveSupport::HashWithIndifferentAccess","value":"{total=>2, previous_total=>, data=>[{date=>2023-11-04 00:00:00 +0000, value=>0}, {date=>2023-11-05 00:00:00 +0000, value=>0}, {date=>2023-11-06 00:00:00 +0000, value=>2}]}","object_id":5547760,"size":3}},{"id":906360,"event":"return","thread_id":9160,"parent_id":906311,"elapsed":0.018022837000899017,"elapsed_instrumentation":0.0001526859705336392,"return_value":{"class":"Integer","value":"2","object_id":5}}]}