{"version":"1.12.0","metadata":{"app":"mastodon","language":{"name":"ruby","engine":"ruby","version":"3.2.2"},"client":{"name":"appmap","url":"https://github.com/applandinc/appmap-ruby","version":"0.102.1"},"frameworks":[{"name":"rails","version":"7.1.1"},{"name":"rspec","version":"3.12.2"}],"git":{"repository":"https://github.com/sgrigson/mastodon.git","branch":"appmap-config","commit":"2c1ae2317e8741caf25b51e9b3b2c15776c54ae3","status":["M .husky/pre-commit"],"git_last_annotated_tag":"0.1.2-14608-g2c1ae2317e8741caf25b51e9b3b2c15776c54ae3","git_last_tag":"v4.2.0","git_commits_since_last_annotated_tag":0,"git_commits_since_last_tag":0},"name":"Admin::Metrics::Measure::InstanceFollowsMeasure #data runs data query without error","source_location":"spec/lib/admin/metrics/measure/instance_follows_measure_spec.rb","recorder":{"name":"rspec","type":"tests"},"test_status":"succeeded"},"classMap":[{"name":"app/lib/admin/metrics/measure","type":"package","children":[{"name":"Admin","type":"class","children":[{"name":"Metrics","type":"class","children":[{"name":"Measure","type":"class","children":[{"name":"BaseMeasure","type":"class","children":[{"name":"data","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:45","static":false},{"name":"load","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:59","static":false},{"name":"cache_key","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:21","static":false},{"name":"canonicalized_params","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:104","static":false},{"name":"perform_queries","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:68","static":false}]},{"name":"InstanceFollowsMeasure","type":"class","children":[{"name":"key","type":"function","location":"app/lib/admin/metrics/measure/instance_follows_measure.rb:10","static":false},{"name":"params","type":"function","location":"app/lib/admin/metrics/measure/instance_follows_measure.rb:60","static":false},{"name":"perform_total_query","type":"function","location":"app/lib/admin/metrics/measure/instance_follows_measure.rb:20","static":false},{"name":"perform_previous_total_query","type":"function","location":"app/lib/admin/metrics/measure/instance_follows_measure.rb:26","static":false},{"name":"sql_array","type":"function","location":"app/lib/admin/metrics/measure/instance_follows_measure.rb:30","static":false},{"name":"sql_query_string","type":"function","location":"app/lib/admin/metrics/measure/instance_follows_measure.rb:34","static":false}]},{"name":"QueryHelper","type":"class","children":[{"name":"perform_data_query","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:6","static":false},{"name":"measurement_data_rows","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:10","static":false},{"name":"sanitized_sql_string","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:14","static":false},{"name":"account_domain_sql","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:18","static":false}]}]}]}]}]},{"name":"logger","type":"package","children":[{"name":"Logger","type":"class","children":[{"name":"LogDevice","type":"class","children":[{"name":"write","type":"function","location":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb:31","static":false,"labels":["log"]}]}]}]},{"name":"ruby","type":"package","children":[{"name":"Marshal","type":"class","children":[{"name":"dump","type":"function","location":"Marshal.dump","static":true,"labels":["serialize"]}]}]}],"events":[{"id":906413,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"data","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":45,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5548680,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc9316376d8>"}},{"id":906414,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"load","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5548680,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc9316376d8>"}},{"id":906415,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"cache_key","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":21,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5548680,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc9316376d8>"}},{"id":906416,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"key","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":10,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5548680,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc9316376d8>"}},{"id":906417,"event":"return","thread_id":9160,"parent_id":906416,"elapsed":2.8819777071475983e-06,"elapsed_instrumentation":7.398403249680996e-05,"return_value":{"class":"String","value":"instance_follows","object_id":5547380}},{"id":906418,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"canonicalized_params","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":104,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5548680,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc9316376d8>"}},{"id":906419,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5548680,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc9316376d8>"}},{"id":906420,"event":"return","thread_id":9160,"parent_id":906419,"elapsed":7.73070496506989e-05,"elapsed_instrumentation":8.151697693392634e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":5548700}},{"id":906421,"event":"return","thread_id":9160,"parent_id":906418,"elapsed":0.00021143798949196935,"elapsed_instrumentation":6.606598617509007e-05,"return_value":{"class":"String","value":"domain=example.com","object_id":5548720}},{"id":906422,"event":"return","thread_id":9160,"parent_id":906415,"elapsed":0.0004043119843117893,"elapsed_instrumentation":6.51709851808846e-05,"return_value":{"class":"String","value":"metrics/measure/instance_follows;2023-11-04T02:57:57+00:00;2023-11-06T02:57:58+00:00;domain=example. (...3 more characters)","object_id":5548740}},{"id":906423,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":5548760,"value":"Cache read: metrics/measure/instance_follows;2023-11-04T02:57:57+00:00;2023-11-06T02:57:58+00:00;dom (...88 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":906424,"event":"return","thread_id":9160,"parent_id":906423,"elapsed":0.0007551509770564735,"elapsed_instrumentation":0.0001190660404972732,"return_value":{"class":"Integer","value":"188","object_id":377}},{"id":906425,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":5548780,"value":"Cache generate: metrics/measure/instance_follows;2023-11-04T02:57:57+00:00;2023-11-06T02:57:58+00:00 (...92 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":906426,"event":"return","thread_id":9160,"parent_id":906425,"elapsed":0.0008600750006735325,"elapsed_instrumentation":0.00013516098260879517,"return_value":{"class":"Integer","value":"192","object_id":385}},{"id":906427,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"perform_queries","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":68,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5548680,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc9316376d8>"}},{"id":906428,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"perform_total_query","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":20,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5548680,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc9316376d8>"}},{"id":906429,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5548680,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc9316376d8>"}},{"id":906430,"event":"return","thread_id":9160,"parent_id":906429,"elapsed":5.6196004152297974e-05,"elapsed_instrumentation":7.909798296168447e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":5548800}},{"id":906431,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5548680,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc9316376d8>"}},{"id":906432,"event":"return","thread_id":9160,"parent_id":906431,"elapsed":3.423402085900307e-05,"elapsed_instrumentation":9.942898759618402e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":5548820}},{"id":906433,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT COUNT(*) FROM \"follows\" INNER JOIN \"accounts\" ON \"accounts\".\"id\" = \"follows\".\"target_account_id\" WHERE \"accounts\".\"domain\" = $1","database_type":"postgres"}},{"id":906434,"event":"return","thread_id":9160,"parent_id":906433,"elapsed":0.001092314,"elapsed_instrumentation":9.8574033472687e-05},{"id":906435,"event":"return","thread_id":9160,"parent_id":906428,"elapsed":0.003087546967435628,"elapsed_instrumentation":9.366404265165329e-05,"return_value":{"class":"Integer","value":"2","object_id":5}},{"id":906436,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"perform_previous_total_query","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":26,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5548680,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc9316376d8>"}},{"id":906437,"event":"return","thread_id":9160,"parent_id":906436,"elapsed":3.1819799914956093e-06,"elapsed_instrumentation":8.169503416866064e-05},{"id":906438,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"perform_data_query","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":6,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5548680,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc9316376d8>"}},{"id":906439,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"measurement_data_rows","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":10,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5548680,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc9316376d8>"}},{"id":906440,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"sanitized_sql_string","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":14,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5548680,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc9316376d8>"}},{"id":906441,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"sql_array","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":30,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5548680,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc9316376d8>"}},{"id":906442,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"sql_query_string","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":34,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5548680,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc9316376d8>"}},{"id":906443,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5548680,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc9316376d8>"}},{"id":906444,"event":"return","thread_id":9160,"parent_id":906443,"elapsed":5.7705037761479616e-05,"elapsed_instrumentation":9.801000123843551e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":5548840}},{"id":906445,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"account_domain_sql","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":18,"static":false,"parameters":[{"name":"include_subdomains","class":"NilClass","object_id":4,"value":null,"kind":"req"}],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5548680,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc9316376d8>"}},{"id":906446,"event":"return","thread_id":9160,"parent_id":906445,"elapsed":4.230998456478119e-06,"elapsed_instrumentation":8.79199942573905e-05,"return_value":{"class":"String","value":"accounts.domain = :domain::text","object_id":3036700}},{"id":906447,"event":"return","thread_id":9160,"parent_id":906442,"elapsed":0.00037402199814096093,"elapsed_instrumentation":0.0005803380627185106,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH new_follows AS ( SELECT follows.id FROM follows INNER JOIN accounts ON follows (...338 more characters)","object_id":5548860}},{"id":906448,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5548680,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fc9316376d8>"}},{"id":906449,"event":"return","thread_id":9160,"parent_id":906448,"elapsed":3.9644946809858084e-05,"elapsed_instrumentation":7.786799687892199e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":5548880}},{"id":906450,"event":"return","thread_id":9160,"parent_id":906441,"elapsed":0.0011104170116595924,"elapsed_instrumentation":0.00013190199388191104,"return_value":{"class":"Array","value":"[SELECT axis.*, ( WITH new_follows AS ( SELECT follows.id FROM follows INNER JOIN accounts ON follows (...338 more characters), {:start_at=>2023-11-04T02:57:57+00:00, :end_at=>2023-11-06T02:57:58+00:00, :domain=>example.com}]","object_id":5548900,"size":2}},{"id":906451,"event":"return","thread_id":9160,"parent_id":906440,"elapsed":0.001544794999063015,"elapsed_instrumentation":7.734500104561448e-05,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH new_follows AS ( SELECT follows.id FROM follows INNER JOIN accounts ON follows (...384 more characters)","object_id":5548920}},{"id":906452,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT axis.*, ( WITH new_follows AS ( SELECT follows.id FROM follows INNER JOIN accounts ON follows.target_account_id = accounts.id WHERE date_trunc('day', follows.created_at)::date = axis.period AND accounts.domain = 'example.com'::text ) SELECT count(*) FROM new_follows ) AS value FROM ( SELECT generate_series(date_trunc('day', '2023-11-04 02:57:57.999985'::timestamp)::date, date_trunc('day', '2023-11-06 02:57:58.000158'::timestamp)::date, interval '1 day') AS period ) AS axis","database_type":"postgres"}},{"id":906453,"event":"return","thread_id":9160,"parent_id":906452,"elapsed":0.001426805,"elapsed_instrumentation":7.849698886275291e-05},{"id":906454,"event":"return","thread_id":9160,"parent_id":906439,"elapsed":0.0035850839922204614,"elapsed_instrumentation":9.107205551117659e-05,"return_value":{"class":"ActiveRecord::Result","value":"#<ActiveRecord::Result:0x00007fc931635928>","object_id":5548940}},{"id":906455,"event":"return","thread_id":9160,"parent_id":906438,"elapsed":0.0037193259922787547,"elapsed_instrumentation":0.00017826497787609696,"return_value":{"class":"Array","value":"[{:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}, {:date=>2023-11-06 00:00:00 +0000, :value=>2}]","object_id":5548960,"size":3}},{"id":906456,"event":"return","thread_id":9160,"parent_id":906427,"elapsed":0.007221369014587253,"elapsed_instrumentation":0.00020473700715228915,"return_value":{"class":"Hash","value":"{:total=>2, :previous_total=>, :data=>[{:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}, {:date=>2023-11-06 00:00:00 +0000, :value=>2}]}","object_id":5548980,"size":3}},{"id":906457,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":5549000,"value":"Cache write: metrics/measure/instance_follows;2023-11-04T02:57:57+00:00;2023-11-06T02:57:58+00:00;do (...89 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":906458,"event":"return","thread_id":9160,"parent_id":906457,"elapsed":0.0006293359911069274,"elapsed_instrumentation":0.00012500101001933217,"return_value":{"class":"Integer","value":"189","object_id":379}},{"id":906459,"event":"call","thread_id":9160,"defined_class":"Marshal","method_id":"dump","path":"Marshal.dump","static":true,"parameters":[{"name":"arg","class":"Array","object_id":5549020,"value":"[{:total=>2, :previous_total=>, :data=>[{:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}, {:date=>2023-11-06 00:00:00 +0000, :value=>2}]}]","kind":"rest","size":1}],"receiver":{"class":"Module","object_id":318180,"value":"Marshal"}},{"id":906460,"event":"return","thread_id":9160,"parent_id":906459,"elapsed":3.9147038478404284e-05,"elapsed_instrumentation":0.0002542469301261008,"return_value":{"class":"String","value":"\u0004\b{\b:\ntotali\u0007:\u0013previous_total0:\tdata[\b{\u0007:\tdateIu:\tTime\r__\u001e_\u0000\u0000\u0000\u0000\u0007:\u000boffseti\u0000:\tzone0:\nvalueI\"\u00060\u0006:\u0006EF{\u0007; (...67 more characters)","object_id":5549040}},{"id":906461,"event":"return","thread_id":9160,"parent_id":906414,"elapsed":0.011673708038870245,"elapsed_instrumentation":0.0002627979847602546,"return_value":{"class":"ActiveSupport::HashWithIndifferentAccess","value":"{total=>2, previous_total=>, data=>[{date=>2023-11-04 00:00:00 +0000, value=>0}, {date=>2023-11-05 00:00:00 +0000, value=>0}, {date=>2023-11-06 00:00:00 +0000, value=>2}]}","object_id":5549060,"size":3}},{"id":906462,"event":"return","thread_id":9160,"parent_id":906413,"elapsed":0.012109923001844436,"elapsed_instrumentation":0.00042463099816814065,"return_value":{"class":"Array","value":"[{date=>2023-11-04 00:00:00 +0000, value=>0}, {date=>2023-11-05 00:00:00 +0000, value=>0}, {date=>2023-11-06 00:00:00 +0000, value=>2}]","object_id":5549080,"size":3}}]}