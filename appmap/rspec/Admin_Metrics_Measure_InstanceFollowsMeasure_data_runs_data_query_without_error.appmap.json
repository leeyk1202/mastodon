{"version":"1.12.0","metadata":{"app":"mastodon","language":{"name":"ruby","engine":"ruby","version":"3.2.2"},"client":{"name":"appmap","url":"https://github.com/applandinc/appmap-ruby","version":"0.102.1"},"frameworks":[{"name":"rails","version":"7.1.1"},{"name":"rspec","version":"3.12.2"}],"git":{"repository":"https://github.com/sgrigson/mastodon.git","branch":"appmap-config","commit":"743782bd299fd54e12a4a5829872efc505132ab3","status":["M .husky/pre-commit","?? sql_warning.txt"],"git_last_annotated_tag":"0.1.2-14597-g743782bd299fd54e12a4a5829872efc505132ab3","git_last_tag":"v4.2.0","git_commits_since_last_annotated_tag":0,"git_commits_since_last_tag":0},"name":"Admin::Metrics::Measure::InstanceFollowsMeasure #data runs data query without error","source_location":"spec/lib/admin/metrics/measure/instance_follows_measure_spec.rb","recorder":{"name":"rspec","type":"tests"},"test_status":"succeeded"},"classMap":[{"name":"app/lib/admin/metrics/measure","type":"package","children":[{"name":"Admin","type":"class","children":[{"name":"Metrics","type":"class","children":[{"name":"Measure","type":"class","children":[{"name":"BaseMeasure","type":"class","children":[{"name":"data","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:45","static":false},{"name":"load","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:59","static":false},{"name":"cache_key","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:21","static":false},{"name":"canonicalized_params","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:104","static":false},{"name":"perform_queries","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:68","static":false}]},{"name":"InstanceFollowsMeasure","type":"class","children":[{"name":"key","type":"function","location":"app/lib/admin/metrics/measure/instance_follows_measure.rb:10","static":false},{"name":"params","type":"function","location":"app/lib/admin/metrics/measure/instance_follows_measure.rb:60","static":false},{"name":"perform_total_query","type":"function","location":"app/lib/admin/metrics/measure/instance_follows_measure.rb:20","static":false},{"name":"perform_previous_total_query","type":"function","location":"app/lib/admin/metrics/measure/instance_follows_measure.rb:26","static":false},{"name":"sql_array","type":"function","location":"app/lib/admin/metrics/measure/instance_follows_measure.rb:30","static":false},{"name":"sql_query_string","type":"function","location":"app/lib/admin/metrics/measure/instance_follows_measure.rb:34","static":false}]},{"name":"QueryHelper","type":"class","children":[{"name":"perform_data_query","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:6","static":false},{"name":"measurement_data_rows","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:10","static":false},{"name":"sanitized_sql_string","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:14","static":false},{"name":"account_domain_sql","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:18","static":false}]}]}]}]}]},{"name":"logger","type":"package","children":[{"name":"Logger","type":"class","children":[{"name":"LogDevice","type":"class","children":[{"name":"write","type":"function","location":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb:31","static":false,"labels":["log"]}]}]}]},{"name":"ruby","type":"package","children":[{"name":"Marshal","type":"class","children":[{"name":"dump","type":"function","location":"Marshal.dump","static":true,"labels":["serialize"]}]}]}],"events":[{"id":819362,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"data","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":45,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5000260,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fdc07720ca0>"}},{"id":819363,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"load","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5000260,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fdc07720ca0>"}},{"id":819364,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"cache_key","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":21,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5000260,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fdc07720ca0>"}},{"id":819365,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"key","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":10,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5000260,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fdc07720ca0>"}},{"id":819366,"event":"return","thread_id":9160,"parent_id":819365,"elapsed":5.156005499884486e-06,"elapsed_instrumentation":0.0002531389764044434,"return_value":{"class":"String","value":"instance_follows","object_id":4998900}},{"id":819367,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"canonicalized_params","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":104,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5000260,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fdc07720ca0>"}},{"id":819368,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5000260,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fdc07720ca0>"}},{"id":819369,"event":"return","thread_id":9160,"parent_id":819368,"elapsed":7.770798401907086e-05,"elapsed_instrumentation":9.275603224523365e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":5000280}},{"id":819370,"event":"return","thread_id":9160,"parent_id":819367,"elapsed":0.00022479897597804666,"elapsed_instrumentation":0.00012051602243445814,"return_value":{"class":"String","value":"domain=example.com","object_id":5000300}},{"id":819371,"event":"return","thread_id":9160,"parent_id":819364,"elapsed":0.0007291760121006519,"elapsed_instrumentation":0.00010507498518563807,"return_value":{"class":"String","value":"metrics/measure/instance_follows;2023-11-03T23:13:45+00:00;2023-11-05T23:13:45+00:00;domain=example. (...3 more characters)","object_id":5000320}},{"id":819372,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":5000340,"value":"Cache read: metrics/measure/instance_follows;2023-11-03T23:13:45+00:00;2023-11-05T23:13:45+00:00;dom (...88 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fdc1b4b7180>"}},{"id":819373,"event":"return","thread_id":9160,"parent_id":819372,"elapsed":0.0010178440134041011,"elapsed_instrumentation":0.0001743019965942949,"return_value":{"class":"Integer","value":"188","object_id":377}},{"id":819374,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":5000360,"value":"Cache generate: metrics/measure/instance_follows;2023-11-03T23:13:45+00:00;2023-11-05T23:13:45+00:00 (...92 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fdc1b4b7180>"}},{"id":819375,"event":"return","thread_id":9160,"parent_id":819374,"elapsed":0.0009128169913310558,"elapsed_instrumentation":0.00016196200158447027,"return_value":{"class":"Integer","value":"192","object_id":385}},{"id":819376,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"perform_queries","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":68,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5000260,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fdc07720ca0>"}},{"id":819377,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"perform_total_query","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":20,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5000260,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fdc07720ca0>"}},{"id":819378,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5000260,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fdc07720ca0>"}},{"id":819379,"event":"return","thread_id":9160,"parent_id":819378,"elapsed":8.248697849921882e-05,"elapsed_instrumentation":0.00012012099614366889,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":5000380}},{"id":819380,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5000260,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fdc07720ca0>"}},{"id":819381,"event":"return","thread_id":9160,"parent_id":819380,"elapsed":3.519700840115547e-05,"elapsed_instrumentation":8.625496411696076e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":5000400}},{"id":819382,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT COUNT(*) FROM \"follows\" INNER JOIN \"accounts\" ON \"accounts\".\"id\" = \"follows\".\"target_account_id\" WHERE \"accounts\".\"domain\" = $1","database_type":"postgres"}},{"id":819383,"event":"return","thread_id":9160,"parent_id":819382,"elapsed":0.001506279,"elapsed_instrumentation":0.00011549200280569494},{"id":819384,"event":"return","thread_id":9160,"parent_id":819377,"elapsed":0.004235994012560695,"elapsed_instrumentation":0.00011498498497530818,"return_value":{"class":"Integer","value":"2","object_id":5}},{"id":819385,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"perform_previous_total_query","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":26,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5000260,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fdc07720ca0>"}},{"id":819386,"event":"return","thread_id":9160,"parent_id":819385,"elapsed":4.590983735397458e-06,"elapsed_instrumentation":0.00010686999303288758},{"id":819387,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"perform_data_query","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":6,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5000260,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fdc07720ca0>"}},{"id":819388,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"measurement_data_rows","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":10,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5000260,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fdc07720ca0>"}},{"id":819389,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"sanitized_sql_string","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":14,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5000260,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fdc07720ca0>"}},{"id":819390,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"sql_array","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":30,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5000260,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fdc07720ca0>"}},{"id":819391,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"sql_query_string","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":34,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5000260,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fdc07720ca0>"}},{"id":819392,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5000260,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fdc07720ca0>"}},{"id":819393,"event":"return","thread_id":9160,"parent_id":819392,"elapsed":5.799200152978301e-05,"elapsed_instrumentation":8.579497807659209e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":5000420}},{"id":819394,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"account_domain_sql","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":18,"static":false,"parameters":[{"name":"include_subdomains","class":"NilClass","object_id":4,"value":null,"kind":"req"}],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5000260,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fdc07720ca0>"}},{"id":819395,"event":"return","thread_id":9160,"parent_id":819394,"elapsed":3.5270059015601873e-06,"elapsed_instrumentation":8.708398672752082e-05,"return_value":{"class":"String","value":"accounts.domain = :domain::text","object_id":4999780}},{"id":819396,"event":"return","thread_id":9160,"parent_id":819391,"elapsed":0.0003594630106817931,"elapsed_instrumentation":6.335100624710321e-05,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH new_follows AS ( SELECT follows.id FROM follows INNER JOIN accounts ON follows (...338 more characters)","object_id":5000440}},{"id":819397,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_follows_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowsMeasure","object_id":5000260,"value":"#<Admin::Metrics::Measure::InstanceFollowsMeasure:0x00007fdc07720ca0>"}},{"id":819398,"event":"return","thread_id":9160,"parent_id":819397,"elapsed":5.690497346222401e-05,"elapsed_instrumentation":0.0007359180017374456,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":5000460}},{"id":819399,"event":"return","thread_id":9160,"parent_id":819390,"elapsed":0.001258879026863724,"elapsed_instrumentation":0.00016829199739731848,"return_value":{"class":"Array","value":"[SELECT axis.*, ( WITH new_follows AS ( SELECT follows.id FROM follows INNER JOIN accounts ON follows (...338 more characters), {:start_at=>2023-11-03T23:13:45+00:00, :end_at=>2023-11-05T23:13:45+00:00, :domain=>example.com}]","object_id":5000480,"size":2}},{"id":819400,"event":"return","thread_id":9160,"parent_id":819389,"elapsed":0.0019238789973314852,"elapsed_instrumentation":9.523899643681943e-05,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH new_follows AS ( SELECT follows.id FROM follows INNER JOIN accounts ON follows (...384 more characters)","object_id":5000500}},{"id":819401,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT axis.*, ( WITH new_follows AS ( SELECT follows.id FROM follows INNER JOIN accounts ON follows.target_account_id = accounts.id WHERE date_trunc('day', follows.created_at)::date = axis.period AND accounts.domain = 'example.com'::text ) SELECT count(*) FROM new_follows ) AS value FROM ( SELECT generate_series(date_trunc('day', '2023-11-03 23:13:45.189298'::timestamp)::date, date_trunc('day', '2023-11-05 23:13:45.189463'::timestamp)::date, interval '1 day') AS period ) AS axis","database_type":"postgres"}},{"id":819402,"event":"return","thread_id":9160,"parent_id":819401,"elapsed":0.001956162,"elapsed_instrumentation":7.767998613417149e-05},{"id":819403,"event":"return","thread_id":9160,"parent_id":819388,"elapsed":0.0044039910135325044,"elapsed_instrumentation":9.973099804483354e-05,"return_value":{"class":"ActiveRecord::Result","value":"#<ActiveRecord::Result:0x00007fdc0775e988>","object_id":5000520}},{"id":819404,"event":"return","thread_id":9160,"parent_id":819387,"elapsed":0.00455170197528787,"elapsed_instrumentation":0.0003446729970164597,"return_value":{"class":"Array","value":"[{:date=>2023-11-03 00:00:00 +0000, :value=>0}, {:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>2}]","object_id":5000540,"size":3}},{"id":819405,"event":"return","thread_id":9160,"parent_id":819376,"elapsed":0.009618334996048361,"elapsed_instrumentation":0.00021550600649788976,"return_value":{"class":"Hash","value":"{:total=>2, :previous_total=>, :data=>[{:date=>2023-11-03 00:00:00 +0000, :value=>0}, {:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>2}]}","object_id":5000560,"size":3}},{"id":819406,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":5000580,"value":"Cache write: metrics/measure/instance_follows;2023-11-03T23:13:45+00:00;2023-11-05T23:13:45+00:00;do (...89 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fdc1b4b7180>"}},{"id":819407,"event":"return","thread_id":9160,"parent_id":819406,"elapsed":0.0008701530168764293,"elapsed_instrumentation":0.00015933701070025563,"return_value":{"class":"Integer","value":"189","object_id":379}},{"id":819408,"event":"call","thread_id":9160,"defined_class":"Marshal","method_id":"dump","path":"Marshal.dump","static":true,"parameters":[{"name":"arg","class":"Array","object_id":5000600,"value":"[{:total=>2, :previous_total=>, :data=>[{:date=>2023-11-03 00:00:00 +0000, :value=>0}, {:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>2}]}]","kind":"rest","size":1}],"receiver":{"class":"Module","object_id":209120,"value":"Marshal"}},{"id":819409,"event":"return","thread_id":9160,"parent_id":819408,"elapsed":3.681602538563311e-05,"elapsed_instrumentation":0.00027676497120410204,"return_value":{"class":"String","value":"\u0004\b{\b:\ntotali\u0007:\u0013previous_total0:\tdata[\b{\u0007:\tdateIu:\tTime\r`_\u001e_\u0000\u0000\u0000\u0000\u0007:\u000boffseti\u0000:\tzone0:\nvalueI\"\u00060\u0006:\u0006EF{\u0007; (...67 more characters)","object_id":5000620}},{"id":819410,"event":"return","thread_id":9160,"parent_id":819363,"elapsed":0.015195557003607973,"elapsed_instrumentation":0.0005273800052236766,"return_value":{"class":"ActiveSupport::HashWithIndifferentAccess","value":"{total=>2, previous_total=>, data=>[{date=>2023-11-03 00:00:00 +0000, value=>0}, {date=>2023-11-04 00:00:00 +0000, value=>0}, {date=>2023-11-05 00:00:00 +0000, value=>2}]}","object_id":5000640,"size":3}},{"id":819411,"event":"return","thread_id":9160,"parent_id":819362,"elapsed":0.01576349401148036,"elapsed_instrumentation":0.00035955497878603637,"return_value":{"class":"Array","value":"[{date=>2023-11-03 00:00:00 +0000, value=>0}, {date=>2023-11-04 00:00:00 +0000, value=>0}, {date=>2023-11-05 00:00:00 +0000, value=>2}]","object_id":5000660,"size":3}}]}