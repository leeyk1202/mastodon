{"version":"1.12.0","metadata":{"app":"mastodon","language":{"name":"ruby","engine":"ruby","version":"3.2.2"},"client":{"name":"appmap","url":"https://github.com/applandinc/appmap-ruby","version":"0.102.1"},"frameworks":[{"name":"rails","version":"7.1.1"},{"name":"rspec","version":"3.12.2"}],"git":{"repository":"https://github.com/sgrigson/mastodon.git","branch":"appmap-config","commit":"743782bd299fd54e12a4a5829872efc505132ab3","status":["M .husky/pre-commit","?? sql_warning.txt"],"git_last_annotated_tag":"0.1.2-14597-g743782bd299fd54e12a4a5829872efc505132ab3","git_last_tag":"v4.2.0","git_commits_since_last_annotated_tag":0,"git_commits_since_last_tag":0},"name":"User .those_who_can when there are not users with the needed role returns an empty list","source_location":"spec/models/user_spec.rb","recorder":{"name":"rspec","type":"tests"},"test_status":"succeeded"},"classMap":[{"name":"app","type":"package","children":[{"name":"models","type":"package","children":[{"name":"User","type":"class","children":[{"name":"those_who_can","type":"function","location":"app/models/user.rb:143","static":true}]},{"name":"UserRole","type":"class","children":[{"name":"that_can","type":"function","location":"app/models/user_role.rb:111","static":true},{"name":"can?","type":"function","location":"app/models/user_role.rb:131","static":false},{"name":"computed_permissions","type":"function","location":"app/models/user_role.rb:139","static":false},{"name":"everyone?","type":"function","location":"app/models/user_role.rb:115","static":false},{"name":"nobody?","type":"function","location":"app/models/user_role.rb:119","static":false},{"name":"everyone","type":"function","location":"app/models/user_role.rb:105","static":true}]}]},{"name":"lib","type":"package","children":[{"name":"RequestPool","type":"class","children":[{"name":"flush","type":"function","location":"app/lib/request_pool.rb:114","static":false}]},{"name":"connection_pool","type":"package","children":[{"name":"ConnectionPool","type":"class","children":[{"name":"SharedConnectionPool","type":"class","children":[{"name":"flush","type":"function","location":"app/lib/connection_pool/shared_connection_pool.rb:13","static":false}]},{"name":"SharedTimedStack","type":"class","children":[{"name":"flush","type":"function","location":"app/lib/connection_pool/shared_timed_stack.rb:51","static":false}]}]}]}]}]}],"events":[{"id":1424321,"event":"call","thread_id":9160,"defined_class":"User","method_id":"those_who_can","path":"app/models/user.rb","lineno":143,"static":true,"parameters":[{"name":"any_of_privileges","class":"Array","object_id":7652800,"value":"[:manage_blocks]","kind":"rest","size":1}],"receiver":{"class":"Class","object_id":35120,"value":"User"}},{"id":1424322,"event":"call","thread_id":9160,"defined_class":"UserRole","method_id":"that_can","path":"app/models/user_role.rb","lineno":111,"static":true,"parameters":[{"name":"any_of_privileges","class":"Array","object_id":7652820,"value":"[:manage_blocks]","kind":"rest","size":1}],"receiver":{"class":"Class","object_id":62120,"value":"UserRole"}},{"id":1424323,"event":"call","thread_id":2031560,"defined_class":"RequestPool","method_id":"flush","path":"app/lib/request_pool.rb","lineno":114,"static":false,"parameters":[{"name":"*","class":"Array","object_id":7652840,"value":"[]","kind":"rest","size":0},{"name":"**","class":"Hash","object_id":7652860,"value":"{}","kind":"keyrest","size":0},{"name":"&","class":"NilClass","object_id":4,"value":null,"kind":"block"}],"receiver":{"class":"RequestPool","object_id":2031540,"value":"#<RequestPool:0x00007fdc067d5480>"}},{"id":1424324,"event":"call","thread_id":2031560,"defined_class":"ConnectionPool::SharedConnectionPool","method_id":"flush","path":"app/lib/connection_pool/shared_connection_pool.rb","lineno":13,"static":false,"parameters":[{"name":"*","class":"Array","object_id":7652880,"value":"[]","kind":"rest","size":0},{"name":"**","class":"Hash","object_id":7652900,"value":"{}","kind":"keyrest","size":0},{"name":"&","class":"NilClass","object_id":4,"value":null,"kind":"block"}],"receiver":{"class":"ConnectionPool::SharedConnectionPool","object_id":2031620,"value":"#<ConnectionPool::SharedConnectionPool:0x00007fdc09af1fa8>"}},{"id":1424325,"event":"call","thread_id":2031560,"defined_class":"ConnectionPool::SharedTimedStack","method_id":"flush","path":"app/lib/connection_pool/shared_timed_stack.rb","lineno":51,"static":false,"parameters":[],"receiver":{"class":"ConnectionPool::SharedTimedStack","object_id":2031640,"value":"#<ConnectionPool::SharedTimedStack:0x00007fdc09af1eb8>"}},{"id":1424326,"event":"return","thread_id":2031560,"parent_id":1424325,"elapsed":6.017973646521568e-06,"elapsed_instrumentation":0.00011679902672767639,"return_value":{"class":"Array","value":"[]","object_id":2031680,"size":0}},{"id":1424327,"event":"return","thread_id":2031560,"parent_id":1424324,"elapsed":0.00015007000183686614,"elapsed_instrumentation":0.0002748680126387626,"return_value":{"class":"Array","value":"[]","object_id":2031680,"size":0}},{"id":1424328,"event":"return","thread_id":2031560,"parent_id":1424323,"elapsed":0.0004579270025715232,"elapsed_instrumentation":0.0003330750041641295,"return_value":{"class":"Array","value":"[]","object_id":2031680,"size":0}},{"id":1424329,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT \"user_roles\".* FROM \"user_roles\"","database_type":"postgres"}},{"id":1424330,"event":"return","thread_id":9160,"parent_id":1424329,"elapsed":0.001583305,"elapsed_instrumentation":0.00020085499272681773},{"id":1424331,"event":"call","thread_id":9160,"defined_class":"UserRole","method_id":"can?","path":"app/models/user_role.rb","lineno":131,"static":false,"parameters":[{"name":"any_of_privileges","class":"Array","object_id":7652920,"value":"[:manage_blocks]","kind":"rest","size":1}],"receiver":{"class":"UserRole","object_id":7652940,"value":"#<UserRole:0x00007fdbf64abe18>"}},{"id":1424332,"event":"call","thread_id":9160,"defined_class":"UserRole","method_id":"computed_permissions","path":"app/models/user_role.rb","lineno":139,"static":false,"parameters":[],"receiver":{"class":"UserRole","object_id":7652940,"value":"#<UserRole:0x00007fdbf64abe18>"}},{"id":1424333,"event":"call","thread_id":9160,"defined_class":"UserRole","method_id":"everyone?","path":"app/models/user_role.rb","lineno":115,"static":false,"parameters":[],"receiver":{"class":"UserRole","object_id":7652940,"value":"#<UserRole:0x00007fdbf64abe18>"}},{"id":1424334,"event":"return","thread_id":9160,"parent_id":1424333,"elapsed":1.7215992556884885e-05,"elapsed_instrumentation":6.586301606148481e-05,"return_value":{"class":"TrueClass","value":"true","object_id":20}},{"id":1424335,"event":"return","thread_id":9160,"parent_id":1424332,"elapsed":0.00010639999527484179,"elapsed_instrumentation":6.725499406456947e-05,"return_value":{"class":"Integer","value":"65536","object_id":131073}},{"id":1424336,"event":"return","thread_id":9160,"parent_id":1424331,"elapsed":0.00019791699014604092,"elapsed_instrumentation":0.00012221699580550194},{"id":1424337,"event":"call","thread_id":9160,"defined_class":"UserRole","method_id":"can?","path":"app/models/user_role.rb","lineno":131,"static":false,"parameters":[{"name":"any_of_privileges","class":"Array","object_id":7652960,"value":"[:manage_blocks]","kind":"rest","size":1}],"receiver":{"class":"UserRole","object_id":7652980,"value":"#<UserRole:0x00007fdbf64abcd8>"}},{"id":1424338,"event":"call","thread_id":9160,"defined_class":"UserRole","method_id":"computed_permissions","path":"app/models/user_role.rb","lineno":139,"static":false,"parameters":[],"receiver":{"class":"UserRole","object_id":7652980,"value":"#<UserRole:0x00007fdbf64abcd8>"}},{"id":1424339,"event":"call","thread_id":9160,"defined_class":"UserRole","method_id":"everyone?","path":"app/models/user_role.rb","lineno":115,"static":false,"parameters":[],"receiver":{"class":"UserRole","object_id":7652980,"value":"#<UserRole:0x00007fdbf64abcd8>"}},{"id":1424340,"event":"return","thread_id":9160,"parent_id":1424339,"elapsed":9.951996617019176e-06,"elapsed_instrumentation":5.430998862721026e-05},{"id":1424341,"event":"call","thread_id":9160,"defined_class":"UserRole","method_id":"nobody?","path":"app/models/user_role.rb","lineno":119,"static":false,"parameters":[],"receiver":{"class":"UserRole","object_id":7652980,"value":"#<UserRole:0x00007fdbf64abcd8>"}},{"id":1424342,"event":"return","thread_id":9160,"parent_id":1424341,"elapsed":6.451009539887309e-06,"elapsed_instrumentation":0.00011437595821917057},{"id":1424343,"event":"call","thread_id":9160,"defined_class":"UserRole","method_id":"everyone","path":"app/models/user_role.rb","lineno":105,"static":true,"parameters":[],"receiver":{"class":"Class","object_id":62120,"value":"UserRole"}},{"id":1424344,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT \"user_roles\".* FROM \"user_roles\" WHERE \"user_roles\".\"id\" = $1 LIMIT $2","database_type":"postgres"}},{"id":1424345,"event":"return","thread_id":9160,"parent_id":1424344,"elapsed":0.00064792,"elapsed_instrumentation":0.00012179400073364377},{"id":1424346,"event":"return","thread_id":9160,"parent_id":1424343,"elapsed":0.0018286870035808533,"elapsed_instrumentation":0.00014750502305105329,"return_value":{"class":"UserRole","value":"#<UserRole:0x00007fdbf64ab7d8>","object_id":7653000}},{"id":1424347,"event":"return","thread_id":9160,"parent_id":1424338,"elapsed":0.002320155006600544,"elapsed_instrumentation":0.00010332500096410513,"return_value":{"class":"Integer","value":"66844","object_id":133689}},{"id":1424348,"event":"return","thread_id":9160,"parent_id":1424337,"elapsed":0.002454130008118227,"elapsed_instrumentation":0.00011129997437819839},{"id":1424349,"event":"call","thread_id":9160,"defined_class":"UserRole","method_id":"can?","path":"app/models/user_role.rb","lineno":131,"static":false,"parameters":[{"name":"any_of_privileges","class":"Array","object_id":7653020,"value":"[:manage_blocks]","kind":"rest","size":1}],"receiver":{"class":"UserRole","object_id":7653040,"value":"#<UserRole:0x00007fdbf64abb98>"}},{"id":1424350,"event":"call","thread_id":9160,"defined_class":"UserRole","method_id":"computed_permissions","path":"app/models/user_role.rb","lineno":139,"static":false,"parameters":[],"receiver":{"class":"UserRole","object_id":7653040,"value":"#<UserRole:0x00007fdbf64abb98>"}},{"id":1424351,"event":"call","thread_id":9160,"defined_class":"UserRole","method_id":"everyone?","path":"app/models/user_role.rb","lineno":115,"static":false,"parameters":[],"receiver":{"class":"UserRole","object_id":7653040,"value":"#<UserRole:0x00007fdbf64abb98>"}},{"id":1424352,"event":"return","thread_id":9160,"parent_id":1424351,"elapsed":1.0554998880252242e-05,"elapsed_instrumentation":4.899699706584215e-05},{"id":1424353,"event":"call","thread_id":9160,"defined_class":"UserRole","method_id":"nobody?","path":"app/models/user_role.rb","lineno":119,"static":false,"parameters":[],"receiver":{"class":"UserRole","object_id":7653040,"value":"#<UserRole:0x00007fdbf64abb98>"}},{"id":1424354,"event":"return","thread_id":9160,"parent_id":1424353,"elapsed":4.9340014811605215e-06,"elapsed_instrumentation":4.9431982915848494e-05},{"id":1424355,"event":"call","thread_id":9160,"defined_class":"UserRole","method_id":"everyone","path":"app/models/user_role.rb","lineno":105,"static":true,"parameters":[],"receiver":{"class":"Class","object_id":62120,"value":"UserRole"}},{"id":1424356,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT \"user_roles\".* FROM \"user_roles\" WHERE \"user_roles\".\"id\" = $1 LIMIT $2","database_type":"postgres"}},{"id":1424357,"event":"return","thread_id":9160,"parent_id":1424356,"elapsed":0.000516833,"elapsed_instrumentation":0.0001178039819933474},{"id":1424358,"event":"return","thread_id":9160,"parent_id":1424355,"elapsed":0.0017392319859936833,"elapsed_instrumentation":0.00013300098362378776,"return_value":{"class":"UserRole","value":"#<UserRole:0x00007fdbf64ab558>","object_id":7653060}},{"id":1424359,"event":"return","thread_id":9160,"parent_id":1424350,"elapsed":0.0020576060051098466,"elapsed_instrumentation":7.864399231038988e-05,"return_value":{"class":"Integer","value":"1048572","object_id":2097145}},{"id":1424360,"event":"return","thread_id":9160,"parent_id":1424349,"elapsed":0.002163007011404261,"elapsed_instrumentation":0.00015833601355552673,"return_value":{"class":"TrueClass","value":"true","object_id":20}},{"id":1424361,"event":"call","thread_id":9160,"defined_class":"UserRole","method_id":"can?","path":"app/models/user_role.rb","lineno":131,"static":false,"parameters":[{"name":"any_of_privileges","class":"Array","object_id":7653080,"value":"[:manage_blocks]","kind":"rest","size":1}],"receiver":{"class":"UserRole","object_id":7653100,"value":"#<UserRole:0x00007fdbf64aba58>"}},{"id":1424362,"event":"call","thread_id":9160,"defined_class":"UserRole","method_id":"computed_permissions","path":"app/models/user_role.rb","lineno":139,"static":false,"parameters":[],"receiver":{"class":"UserRole","object_id":7653100,"value":"#<UserRole:0x00007fdbf64aba58>"}},{"id":1424363,"event":"call","thread_id":9160,"defined_class":"UserRole","method_id":"everyone?","path":"app/models/user_role.rb","lineno":115,"static":false,"parameters":[],"receiver":{"class":"UserRole","object_id":7653100,"value":"#<UserRole:0x00007fdbf64aba58>"}},{"id":1424364,"event":"return","thread_id":9160,"parent_id":1424363,"elapsed":1.679797424003482e-05,"elapsed_instrumentation":7.807201473042369e-05},{"id":1424365,"event":"call","thread_id":9160,"defined_class":"UserRole","method_id":"nobody?","path":"app/models/user_role.rb","lineno":119,"static":false,"parameters":[],"receiver":{"class":"UserRole","object_id":7653100,"value":"#<UserRole:0x00007fdbf64aba58>"}},{"id":1424366,"event":"return","thread_id":9160,"parent_id":1424365,"elapsed":7.591996109113097e-06,"elapsed_instrumentation":7.57100060582161e-05},{"id":1424367,"event":"call","thread_id":9160,"defined_class":"UserRole","method_id":"everyone","path":"app/models/user_role.rb","lineno":105,"static":true,"parameters":[],"receiver":{"class":"Class","object_id":62120,"value":"UserRole"}},{"id":1424368,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT \"user_roles\".* FROM \"user_roles\" WHERE \"user_roles\".\"id\" = $1 LIMIT $2","database_type":"postgres"}},{"id":1424369,"event":"return","thread_id":9160,"parent_id":1424368,"elapsed":0.000758982,"elapsed_instrumentation":0.00013581899111159146},{"id":1424370,"event":"return","thread_id":9160,"parent_id":1424367,"elapsed":0.0019429110107012093,"elapsed_instrumentation":0.00016550798318348825,"return_value":{"class":"UserRole","value":"#<UserRole:0x00007fdbf64ab2d8>","object_id":7653120}},{"id":1424371,"event":"return","thread_id":9160,"parent_id":1424362,"elapsed":0.002382495003985241,"elapsed_instrumentation":0.00011075602378696203,"return_value":{"class":"Integer","value":"1048575","object_id":2097151}},{"id":1424372,"event":"return","thread_id":9160,"parent_id":1424361,"elapsed":0.0025263889983762056,"elapsed_instrumentation":0.0006882859743200243,"return_value":{"class":"TrueClass","value":"true","object_id":20}},{"id":1424373,"event":"return","thread_id":9160,"parent_id":1424322,"elapsed":0.011345178994815797,"elapsed_instrumentation":0.00020143899018876255,"return_value":{"class":"Array","value":"[#<UserRole:0x00007fdbf64abb98>, #<UserRole:0x00007fdbf64aba58>]","object_id":7653140,"size":2}},{"id":1424374,"event":"return","thread_id":9160,"parent_id":1424321,"elapsed":0.012179941986687481,"elapsed_instrumentation":0.00027382501866668463,"return_value":{"class":"ActiveRecord::Relation","value":"#<User::ActiveRecord_Relation:0x00007fdbf66b1cd0>","object_id":7653160}},{"id":1424375,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT \"users\".\"id\", \"users\".\"email\", \"users\".\"created_at\", \"users\".\"updated_at\", \"users\".\"encrypted_password\", \"users\".\"reset_password_token\", \"users\".\"reset_password_sent_at\", \"users\".\"sign_in_count\", \"users\".\"current_sign_in_at\", \"users\".\"last_sign_in_at\", \"users\".\"admin\", \"users\".\"confirmation_token\", \"users\".\"confirmed_at\", \"users\".\"confirmation_sent_at\", \"users\".\"unconfirmed_email\", \"users\".\"locale\", \"users\".\"encrypted_otp_secret\", \"users\".\"encrypted_otp_secret_iv\", \"users\".\"encrypted_otp_secret_salt\", \"users\".\"consumed_timestep\", \"users\".\"otp_required_for_login\", \"users\".\"last_emailed_at\", \"users\".\"otp_backup_codes\", \"users\".\"account_id\", \"users\".\"disabled\", \"users\".\"moderator\", \"users\".\"invite_id\", \"users\".\"chosen_languages\", \"users\".\"created_by_application_id\", \"users\".\"approved\", \"users\".\"sign_in_token\", \"users\".\"sign_in_token_sent_at\", \"users\".\"webauthn_id\", \"users\".\"sign_up_ip\", \"users\".\"role_id\", \"users\".\"settings\", \"users\".\"time_zone\" FROM \"users\" WHERE \"users\".\"role_id\" IN ($1, $2)","database_type":"postgres"}},{"id":1424376,"event":"return","thread_id":9160,"parent_id":1424375,"elapsed":0.002226811,"elapsed_instrumentation":0.00015191800775937736}]}