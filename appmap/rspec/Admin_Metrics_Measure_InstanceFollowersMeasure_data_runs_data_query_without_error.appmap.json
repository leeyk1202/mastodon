{"version":"1.12.0","metadata":{"app":"mastodon","language":{"name":"ruby","engine":"ruby","version":"3.2.2"},"client":{"name":"appmap","url":"https://github.com/applandinc/appmap-ruby","version":"0.102.1"},"frameworks":[{"name":"rails","version":"7.1.1"},{"name":"rspec","version":"3.12.2"}],"git":{"repository":"https://github.com/sgrigson/mastodon.git","branch":"appmap-config","commit":"2c1ae2317e8741caf25b51e9b3b2c15776c54ae3","status":["M .husky/pre-commit"],"git_last_annotated_tag":"0.1.2-14608-g2c1ae2317e8741caf25b51e9b3b2c15776c54ae3","git_last_tag":"v4.2.0","git_commits_since_last_annotated_tag":0,"git_commits_since_last_tag":0},"name":"Admin::Metrics::Measure::InstanceFollowersMeasure #data runs data query without error","source_location":"spec/lib/admin/metrics/measure/instance_followers_measure_spec.rb","recorder":{"name":"rspec","type":"tests"},"test_status":"succeeded"},"classMap":[{"name":"app/lib/admin/metrics/measure","type":"package","children":[{"name":"Admin","type":"class","children":[{"name":"Metrics","type":"class","children":[{"name":"Measure","type":"class","children":[{"name":"BaseMeasure","type":"class","children":[{"name":"data","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:45","static":false},{"name":"load","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:59","static":false},{"name":"cache_key","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:21","static":false},{"name":"canonicalized_params","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:104","static":false},{"name":"perform_queries","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:68","static":false}]},{"name":"InstanceFollowersMeasure","type":"class","children":[{"name":"key","type":"function","location":"app/lib/admin/metrics/measure/instance_followers_measure.rb:10","static":false},{"name":"params","type":"function","location":"app/lib/admin/metrics/measure/instance_followers_measure.rb:60","static":false},{"name":"perform_total_query","type":"function","location":"app/lib/admin/metrics/measure/instance_followers_measure.rb:20","static":false},{"name":"perform_previous_total_query","type":"function","location":"app/lib/admin/metrics/measure/instance_followers_measure.rb:26","static":false},{"name":"sql_array","type":"function","location":"app/lib/admin/metrics/measure/instance_followers_measure.rb:30","static":false},{"name":"sql_query_string","type":"function","location":"app/lib/admin/metrics/measure/instance_followers_measure.rb:34","static":false}]},{"name":"QueryHelper","type":"class","children":[{"name":"perform_data_query","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:6","static":false},{"name":"measurement_data_rows","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:10","static":false},{"name":"sanitized_sql_string","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:14","static":false},{"name":"account_domain_sql","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:18","static":false}]}]}]}]}]},{"name":"logger","type":"package","children":[{"name":"Logger","type":"class","children":[{"name":"LogDevice","type":"class","children":[{"name":"write","type":"function","location":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb:31","static":false,"labels":["log"]}]}]}]},{"name":"ruby","type":"package","children":[{"name":"Marshal","type":"class","children":[{"name":"dump","type":"function","location":"Marshal.dump","static":true,"labels":["serialize"]}]}]}],"events":[{"id":2779520,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"data","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":45,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowersMeasure","object_id":13653040,"value":"#<Admin::Metrics::Measure::InstanceFollowersMeasure:0x00007fc931cb19a0>"}},{"id":2779521,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"load","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowersMeasure","object_id":13653040,"value":"#<Admin::Metrics::Measure::InstanceFollowersMeasure:0x00007fc931cb19a0>"}},{"id":2779522,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"cache_key","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":21,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowersMeasure","object_id":13653040,"value":"#<Admin::Metrics::Measure::InstanceFollowersMeasure:0x00007fc931cb19a0>"}},{"id":2779523,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowersMeasure","method_id":"key","path":"app/lib/admin/metrics/measure/instance_followers_measure.rb","lineno":10,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowersMeasure","object_id":13653040,"value":"#<Admin::Metrics::Measure::InstanceFollowersMeasure:0x00007fc931cb19a0>"}},{"id":2779524,"event":"return","thread_id":9160,"parent_id":2779523,"elapsed":2.963992301374674e-06,"elapsed_instrumentation":0.0001164200366474688,"return_value":{"class":"String","value":"instance_followers","object_id":13653060}},{"id":2779525,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"canonicalized_params","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":104,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowersMeasure","object_id":13653040,"value":"#<Admin::Metrics::Measure::InstanceFollowersMeasure:0x00007fc931cb19a0>"}},{"id":2779526,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowersMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_followers_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowersMeasure","object_id":13653040,"value":"#<Admin::Metrics::Measure::InstanceFollowersMeasure:0x00007fc931cb19a0>"}},{"id":2779527,"event":"return","thread_id":9160,"parent_id":2779526,"elapsed":8.354202145710588e-05,"elapsed_instrumentation":0.00010181497782468796,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":13653080}},{"id":2779528,"event":"return","thread_id":9160,"parent_id":2779525,"elapsed":0.00024068099446594715,"elapsed_instrumentation":6.861495785415173e-05,"return_value":{"class":"String","value":"domain=example.com","object_id":13653100}},{"id":2779529,"event":"return","thread_id":9160,"parent_id":2779522,"elapsed":0.00048431899631395936,"elapsed_instrumentation":6.648799171671271e-05,"return_value":{"class":"String","value":"metrics/measure/instance_followers;2023-11-04T03:17:05+00:00;2023-11-06T03:17:05+00:00;domain=exampl (...5 more characters)","object_id":13653120}},{"id":2779530,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":13653140,"value":"Cache read: metrics/measure/instance_followers;2023-11-04T03:17:05+00:00;2023-11-06T03:17:05+00:00;d (...90 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":2779531,"event":"return","thread_id":9160,"parent_id":2779530,"elapsed":0.0014757700264453888,"elapsed_instrumentation":0.00022629601880908012,"return_value":{"class":"Integer","value":"190","object_id":381}},{"id":2779532,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":13653160,"value":"Cache generate: metrics/measure/instance_followers;2023-11-04T03:17:05+00:00;2023-11-06T03:17:05+00: (...94 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":2779533,"event":"return","thread_id":9160,"parent_id":2779532,"elapsed":0.0007366780191659927,"elapsed_instrumentation":0.00023580994457006454,"return_value":{"class":"Integer","value":"194","object_id":389}},{"id":2779534,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"perform_queries","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":68,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowersMeasure","object_id":13653040,"value":"#<Admin::Metrics::Measure::InstanceFollowersMeasure:0x00007fc931cb19a0>"}},{"id":2779535,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowersMeasure","method_id":"perform_total_query","path":"app/lib/admin/metrics/measure/instance_followers_measure.rb","lineno":20,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowersMeasure","object_id":13653040,"value":"#<Admin::Metrics::Measure::InstanceFollowersMeasure:0x00007fc931cb19a0>"}},{"id":2779536,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowersMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_followers_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowersMeasure","object_id":13653040,"value":"#<Admin::Metrics::Measure::InstanceFollowersMeasure:0x00007fc931cb19a0>"}},{"id":2779537,"event":"return","thread_id":9160,"parent_id":2779536,"elapsed":5.649798549711704e-05,"elapsed_instrumentation":8.58829589560628e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":13653180}},{"id":2779538,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowersMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_followers_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowersMeasure","object_id":13653040,"value":"#<Admin::Metrics::Measure::InstanceFollowersMeasure:0x00007fc931cb19a0>"}},{"id":2779539,"event":"return","thread_id":9160,"parent_id":2779538,"elapsed":3.63900326192379e-05,"elapsed_instrumentation":8.258398156613111e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":13653200}},{"id":2779540,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT COUNT(*) FROM \"follows\" INNER JOIN \"accounts\" ON \"accounts\".\"id\" = \"follows\".\"account_id\" WHERE \"accounts\".\"domain\" = $1","database_type":"postgres"}},{"id":2779541,"event":"return","thread_id":9160,"parent_id":2779540,"elapsed":0.001032448,"elapsed_instrumentation":9.479298023506999e-05},{"id":2779542,"event":"return","thread_id":9160,"parent_id":2779535,"elapsed":0.003156923979986459,"elapsed_instrumentation":0.00014316901797428727,"return_value":{"class":"Integer","value":"2","object_id":5}},{"id":2779543,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowersMeasure","method_id":"perform_previous_total_query","path":"app/lib/admin/metrics/measure/instance_followers_measure.rb","lineno":26,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowersMeasure","object_id":13653040,"value":"#<Admin::Metrics::Measure::InstanceFollowersMeasure:0x00007fc931cb19a0>"}},{"id":2779544,"event":"return","thread_id":9160,"parent_id":2779543,"elapsed":3.0110240913927555e-06,"elapsed_instrumentation":0.00010028795804828405},{"id":2779545,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"perform_data_query","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":6,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowersMeasure","object_id":13653040,"value":"#<Admin::Metrics::Measure::InstanceFollowersMeasure:0x00007fc931cb19a0>"}},{"id":2779546,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"measurement_data_rows","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":10,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowersMeasure","object_id":13653040,"value":"#<Admin::Metrics::Measure::InstanceFollowersMeasure:0x00007fc931cb19a0>"}},{"id":2779547,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"sanitized_sql_string","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":14,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowersMeasure","object_id":13653040,"value":"#<Admin::Metrics::Measure::InstanceFollowersMeasure:0x00007fc931cb19a0>"}},{"id":2779548,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowersMeasure","method_id":"sql_array","path":"app/lib/admin/metrics/measure/instance_followers_measure.rb","lineno":30,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowersMeasure","object_id":13653040,"value":"#<Admin::Metrics::Measure::InstanceFollowersMeasure:0x00007fc931cb19a0>"}},{"id":2779549,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowersMeasure","method_id":"sql_query_string","path":"app/lib/admin/metrics/measure/instance_followers_measure.rb","lineno":34,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowersMeasure","object_id":13653040,"value":"#<Admin::Metrics::Measure::InstanceFollowersMeasure:0x00007fc931cb19a0>"}},{"id":2779550,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowersMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_followers_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowersMeasure","object_id":13653040,"value":"#<Admin::Metrics::Measure::InstanceFollowersMeasure:0x00007fc931cb19a0>"}},{"id":2779551,"event":"return","thread_id":9160,"parent_id":2779550,"elapsed":6.615201709792018e-05,"elapsed_instrumentation":9.341398254036903e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":13653220}},{"id":2779552,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"account_domain_sql","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":18,"static":false,"parameters":[{"name":"include_subdomains","class":"NilClass","object_id":4,"value":null,"kind":"req"}],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowersMeasure","object_id":13653040,"value":"#<Admin::Metrics::Measure::InstanceFollowersMeasure:0x00007fc931cb19a0>"}},{"id":2779553,"event":"return","thread_id":9160,"parent_id":2779552,"elapsed":3.823020961135626e-06,"elapsed_instrumentation":9.446300100535154e-05,"return_value":{"class":"String","value":"accounts.domain = :domain::text","object_id":3036700}},{"id":2779554,"event":"return","thread_id":9160,"parent_id":2779549,"elapsed":0.00049950199900195,"elapsed_instrumentation":7.667898898944259e-05,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH new_followers AS ( SELECT follows.id FROM follows INNER JOIN accounts ON follo (...335 more characters)","object_id":13653240}},{"id":2779555,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceFollowersMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_followers_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceFollowersMeasure","object_id":13653040,"value":"#<Admin::Metrics::Measure::InstanceFollowersMeasure:0x00007fc931cb19a0>"}},{"id":2779556,"event":"return","thread_id":9160,"parent_id":2779555,"elapsed":4.064303357154131e-05,"elapsed_instrumentation":8.397700730711222e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":13653260}},{"id":2779557,"event":"return","thread_id":9160,"parent_id":2779548,"elapsed":0.0007387480000033975,"elapsed_instrumentation":0.00015513499965891242,"return_value":{"class":"Array","value":"[SELECT axis.*, ( WITH new_followers AS ( SELECT follows.id FROM follows INNER JOIN accounts ON follo (...335 more characters), {:start_at=>2023-11-04T03:17:05+00:00, :end_at=>2023-11-06T03:17:05+00:00, :domain=>example.com}]","object_id":13653280,"size":2}},{"id":2779558,"event":"return","thread_id":9160,"parent_id":2779547,"elapsed":0.0010907039977610111,"elapsed_instrumentation":7.111200829967856e-05,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH new_followers AS ( SELECT follows.id FROM follows INNER JOIN accounts ON follo (...381 more characters)","object_id":13653300}},{"id":2779559,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT axis.*, ( WITH new_followers AS ( SELECT follows.id FROM follows INNER JOIN accounts ON follows.account_id = accounts.id WHERE date_trunc('day', follows.created_at)::date = axis.period AND accounts.domain = 'example.com'::text ) SELECT count(*) FROM new_followers ) AS value FROM ( SELECT generate_series(date_trunc('day', '2023-11-04 03:17:05.989030'::timestamp)::date, date_trunc('day', '2023-11-06 03:17:05.989210'::timestamp)::date, interval '1 day') AS period ) AS axis","database_type":"postgres"}},{"id":2779560,"event":"return","thread_id":9160,"parent_id":2779559,"elapsed":0.001656035,"elapsed_instrumentation":9.49589884839952e-05},{"id":2779561,"event":"return","thread_id":9160,"parent_id":2779546,"elapsed":0.0034750429913401604,"elapsed_instrumentation":0.00011124694719910622,"return_value":{"class":"ActiveRecord::Result","value":"#<ActiveRecord::Result:0x00007fc931d0f000>","object_id":13653320}},{"id":2779562,"event":"return","thread_id":9160,"parent_id":2779545,"elapsed":0.0036350429872982204,"elapsed_instrumentation":0.00019145297119393945,"return_value":{"class":"Array","value":"[{:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}, {:date=>2023-11-06 00:00:00 +0000, :value=>2}]","object_id":13653340,"size":3}},{"id":2779563,"event":"return","thread_id":9160,"parent_id":2779534,"elapsed":0.007305969018489122,"elapsed_instrumentation":0.0002006610156968236,"return_value":{"class":"Hash","value":"{:total=>2, :previous_total=>, :data=>[{:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}, {:date=>2023-11-06 00:00:00 +0000, :value=>2}]}","object_id":13653360,"size":3}},{"id":2779564,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":13653380,"value":"Cache write: metrics/measure/instance_followers;2023-11-04T03:17:05+00:00;2023-11-06T03:17:05+00:00; (...91 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":2779565,"event":"return","thread_id":9160,"parent_id":2779564,"elapsed":0.0006418910343199968,"elapsed_instrumentation":0.00013727793702855706,"return_value":{"class":"Integer","value":"191","object_id":383}},{"id":2779566,"event":"call","thread_id":9160,"defined_class":"Marshal","method_id":"dump","path":"Marshal.dump","static":true,"parameters":[{"name":"arg","class":"Array","object_id":13653400,"value":"[{:total=>2, :previous_total=>, :data=>[{:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}, {:date=>2023-11-06 00:00:00 +0000, :value=>2}]}]","kind":"rest","size":1}],"receiver":{"class":"Module","object_id":318180,"value":"Marshal"}},{"id":2779567,"event":"return","thread_id":9160,"parent_id":2779566,"elapsed":3.7969963159412146e-05,"elapsed_instrumentation":0.0002595289843156934,"return_value":{"class":"String","value":"\u0004\b{\b:\ntotali\u0007:\u0013previous_total0:\tdata[\b{\u0007:\tdateIu:\tTime\r__\u001e_\u0000\u0000\u0000\u0000\u0007:\u000boffseti\u0000:\tzone0:\nvalueI\"\u00060\u0006:\u0006EF{\u0007; (...67 more characters)","object_id":13653420}},{"id":2779568,"event":"return","thread_id":9160,"parent_id":2779521,"elapsed":0.012699336977675557,"elapsed_instrumentation":0.00037374900421127677,"return_value":{"class":"ActiveSupport::HashWithIndifferentAccess","value":"{total=>2, previous_total=>, data=>[{date=>2023-11-04 00:00:00 +0000, value=>0}, {date=>2023-11-05 00:00:00 +0000, value=>0}, {date=>2023-11-06 00:00:00 +0000, value=>2}]}","object_id":13653440,"size":3}},{"id":2779569,"event":"return","thread_id":9160,"parent_id":2779520,"elapsed":0.013104640995152295,"elapsed_instrumentation":0.00038575404323637486,"return_value":{"class":"Array","value":"[{date=>2023-11-04 00:00:00 +0000, value=>0}, {date=>2023-11-05 00:00:00 +0000, value=>0}, {date=>2023-11-06 00:00:00 +0000, value=>2}]","object_id":13653460,"size":3}}]}