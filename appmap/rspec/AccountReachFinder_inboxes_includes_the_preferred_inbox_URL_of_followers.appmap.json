{"version":"1.12.0","metadata":{"app":"mastodon","language":{"name":"ruby","engine":"ruby","version":"3.2.2"},"client":{"name":"appmap","url":"https://github.com/applandinc/appmap-ruby","version":"0.102.1"},"frameworks":[{"name":"rails","version":"7.1.1"},{"name":"rspec","version":"3.12.2"}],"git":{"repository":"https://github.com/sgrigson/mastodon.git","branch":"appmap-config","commit":"2c1ae2317e8741caf25b51e9b3b2c15776c54ae3","status":["M .husky/pre-commit"],"git_last_annotated_tag":"0.1.2-14608-g2c1ae2317e8741caf25b51e9b3b2c15776c54ae3","git_last_tag":"v4.2.0","git_commits_since_last_annotated_tag":0,"git_commits_since_last_tag":0},"name":"AccountReachFinder #inboxes includes the preferred inbox URL of followers","source_location":"spec/lib/account_reach_finder_spec.rb","recorder":{"name":"rspec","type":"tests"},"test_status":"succeeded"},"classMap":[{"name":"app","type":"package","children":[{"name":"lib","type":"package","children":[{"name":"AccountReachFinder","type":"class","children":[{"name":"inboxes","type":"function","location":"app/lib/account_reach_finder.rb:8","static":false}]},{"name":"DeliveryFailureTracker","type":"class","children":[{"name":"without_unavailable","type":"function","location":"app/lib/delivery_failure_tracker.rb:43","static":true}]}]},{"name":"models","type":"package","children":[{"name":"Account","type":"class","children":[{"name":"inboxes","type":"function","location":"app/models/account.rb:436","static":true},{"name":"preferred_inbox_url","type":"function","location":"app/models/account.rb:405","static":false}]}]}]},{"name":"logger","type":"package","children":[{"name":"Logger","type":"class","children":[{"name":"LogDevice","type":"class","children":[{"name":"write","type":"function","location":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb:31","static":false,"labels":["log"]}]}]}]},{"name":"ruby","type":"package","children":[{"name":"Marshal","type":"class","children":[{"name":"dump","type":"function","location":"Marshal.dump","static":true,"labels":["serialize"]},{"name":"load","type":"function","location":"<internal:marshal>:33","static":true,"labels":["deserialize.unsafe"]}]}]},{"name":"lib/mastodon","type":"package","children":[{"name":"Mastodon","type":"class","children":[{"name":"Snowflake","type":"class","children":[{"name":"id_at","type":"function","location":"lib/mastodon/snowflake.rb:99","static":true}]}]}]}],"events":[{"id":2701823,"event":"call","thread_id":9160,"defined_class":"AccountReachFinder","method_id":"inboxes","path":"app/lib/account_reach_finder.rb","lineno":8,"static":false,"parameters":[],"receiver":{"class":"AccountReachFinder","object_id":13281400,"value":"#<AccountReachFinder:0x00007fc9192b9e10>"}},{"id":2701824,"event":"call","thread_id":9160,"defined_class":"Account","method_id":"inboxes","path":"app/models/account.rb","lineno":436,"static":true,"parameters":[],"receiver":{"class":"Class","object_id":36600,"value":"Account"}},{"id":2701825,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT coalesce(nullif(accounts.shared_inbox_url, ''), accounts.inbox_url) AS preferred_inbox_url FROM \"accounts\" INNER JOIN \"follows\" ON \"accounts\".\"id\" = \"follows\".\"account_id\" WHERE \"follows\".\"target_account_id\" = $1 AND \"accounts\".\"protocol\" = $2 GROUP BY \"preferred_inbox_url\"","database_type":"postgres"}},{"id":2701826,"event":"return","thread_id":9160,"parent_id":2701825,"elapsed":0.001248872,"elapsed_instrumentation":0.00010604300769045949},{"id":2701827,"event":"call","thread_id":9160,"defined_class":"DeliveryFailureTracker","method_id":"without_unavailable","path":"app/lib/delivery_failure_tracker.rb","lineno":43,"static":true,"parameters":[{"name":"urls","class":"Array","object_id":13281420,"value":"[https://example.com/inbox-1, https://example.org/inbox-2, https://foo.bar/inbox]","kind":"req","size":3}],"receiver":{"class":"Class","object_id":52940,"value":"DeliveryFailureTracker"}},{"id":2701828,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":13281440,"value":"Cache read: unavailable_domains ({:compress=>false, :compress_threshold=>1024})\n","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":2701829,"event":"return","thread_id":9160,"parent_id":2701828,"elapsed":0.0007501099607907236,"elapsed_instrumentation":0.00012692500604316592,"return_value":{"class":"Integer","value":"80","object_id":161}},{"id":2701830,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":13281460,"value":"Cache generate: unavailable_domains ({:compress=>false, :compress_threshold=>1024})\n","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":2701831,"event":"return","thread_id":9160,"parent_id":2701830,"elapsed":0.0007411190308630466,"elapsed_instrumentation":0.0001514939940534532,"return_value":{"class":"Integer","value":"84","object_id":169}},{"id":2701832,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT \"unavailable_domains\".\"domain\" FROM \"unavailable_domains\"","database_type":"postgres"}},{"id":2701833,"event":"return","thread_id":9160,"parent_id":2701832,"elapsed":0.000653456,"elapsed_instrumentation":8.811301086097956e-05},{"id":2701834,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":13281480,"value":"Cache write: unavailable_domains ({:compress=>false, :compress_threshold=>1024})\n","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":2701835,"event":"return","thread_id":9160,"parent_id":2701834,"elapsed":0.0008631370146758854,"elapsed_instrumentation":0.0002244110219180584,"return_value":{"class":"Integer","value":"81","object_id":163}},{"id":2701836,"event":"call","thread_id":9160,"defined_class":"Marshal","method_id":"dump","path":"Marshal.dump","static":true,"parameters":[{"name":"arg","class":"Array","object_id":13281500,"value":"[{}]","kind":"rest","size":1}],"receiver":{"class":"Module","object_id":318180,"value":"Marshal"}},{"id":2701837,"event":"return","thread_id":9160,"parent_id":2701836,"elapsed":9.06200148165226e-06,"elapsed_instrumentation":0.00013698398834094405,"return_value":{"class":"String","value":"\u0004\b{\u0000","object_id":13281520}},{"id":2701838,"event":"return","thread_id":9160,"parent_id":2701827,"elapsed":0.005331819993443787,"elapsed_instrumentation":0.0001930480357259512,"return_value":{"class":"Array","value":"[https://example.com/inbox-1, https://example.org/inbox-2, https://foo.bar/inbox]","object_id":13281540,"size":3}},{"id":2701839,"event":"return","thread_id":9160,"parent_id":2701824,"elapsed":0.008283453003969043,"elapsed_instrumentation":0.00013949000276625156,"return_value":{"class":"Array","value":"[https://example.com/inbox-1, https://example.org/inbox-2, https://foo.bar/inbox]","object_id":13281540,"size":3}},{"id":2701840,"event":"call","thread_id":9160,"defined_class":"Account","method_id":"inboxes","path":"app/models/account.rb","lineno":436,"static":true,"parameters":[],"receiver":{"class":"Class","object_id":36600,"value":"Account"}},{"id":2701841,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT coalesce(nullif(accounts.shared_inbox_url, ''), accounts.inbox_url) AS preferred_inbox_url FROM \"accounts\" WHERE \"accounts\".\"id\" IN (SELECT \"reports\".\"account_id\" FROM \"reports\" WHERE \"reports\".\"target_account_id\" = $1) AND \"accounts\".\"protocol\" = $2 GROUP BY \"preferred_inbox_url\"","database_type":"postgres"}},{"id":2701842,"event":"return","thread_id":9160,"parent_id":2701841,"elapsed":0.001125963,"elapsed_instrumentation":8.69730138219893e-05},{"id":2701843,"event":"call","thread_id":9160,"defined_class":"DeliveryFailureTracker","method_id":"without_unavailable","path":"app/lib/delivery_failure_tracker.rb","lineno":43,"static":true,"parameters":[{"name":"urls","class":"Array","object_id":13281560,"value":"[]","kind":"req","size":0}],"receiver":{"class":"Class","object_id":52940,"value":"DeliveryFailureTracker"}},{"id":2701844,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":13281580,"value":"Cache read: unavailable_domains ({:compress=>false, :compress_threshold=>1024})\n","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":2701845,"event":"return","thread_id":9160,"parent_id":2701844,"elapsed":0.0008545710006728768,"elapsed_instrumentation":0.00014556496171280742,"return_value":{"class":"Integer","value":"80","object_id":161}},{"id":2701846,"event":"call","thread_id":9160,"defined_class":"Marshal","method_id":"load","path":"<internal:marshal>","lineno":33,"static":true,"parameters":[{"name":"source","class":"String","object_id":13281520,"value":"\u0004\b{\u0000","kind":"req"},{"name":"arg","class":"Array","object_id":13281600,"value":"[]","kind":"rest","size":0}],"receiver":{"class":"Module","object_id":318180,"value":"Marshal"}},{"id":2701847,"event":"return","thread_id":9160,"parent_id":2701846,"elapsed":7.566006388515234e-06,"elapsed_instrumentation":0.00013591197784990072,"return_value":{"class":"Hash","value":"{}","object_id":13281620,"size":0}},{"id":2701848,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":13281640,"value":"Cache fetch_hit: unavailable_domains ({:compress=>false, :compress_threshold=>1024})\n","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":2701849,"event":"return","thread_id":9160,"parent_id":2701848,"elapsed":0.0006775290239602327,"elapsed_instrumentation":0.00011886400170624256,"return_value":{"class":"Integer","value":"85","object_id":171}},{"id":2701850,"event":"return","thread_id":9160,"parent_id":2701843,"elapsed":0.0022609379957430065,"elapsed_instrumentation":0.0002761990763247013,"return_value":{"class":"Array","value":"[]","object_id":13281660,"size":0}},{"id":2701851,"event":"return","thread_id":9160,"parent_id":2701840,"elapsed":0.005097931018099189,"elapsed_instrumentation":0.0001245809835381806,"return_value":{"class":"Array","value":"[]","object_id":13281660,"size":0}},{"id":2701852,"event":"call","thread_id":9160,"defined_class":"Mastodon::Snowflake","method_id":"id_at","path":"lib/mastodon/snowflake.rb","lineno":99,"static":true,"parameters":[{"name":"timestamp","class":"ActiveSupport::TimeWithZone","object_id":13281680,"value":"2023-11-04 03:16:14 UTC","kind":"req"},{"name":"with_random","class":"FalseClass","object_id":0,"value":"false","kind":"key"}],"receiver":{"class":"Module","object_id":1610500,"value":"Mastodon::Snowflake"}},{"id":2701853,"event":"return","thread_id":9160,"parent_id":2701852,"elapsed":1.4095974620431662e-05,"elapsed_instrumentation":0.0001495589967817068,"return_value":{"class":"Integer","value":"111350105636864000","object_id":222700211273728001}},{"id":2701854,"event":"call","thread_id":9160,"defined_class":"Account","method_id":"inboxes","path":"app/models/account.rb","lineno":436,"static":true,"parameters":[],"receiver":{"class":"Class","object_id":36600,"value":"Account"}},{"id":2701855,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT coalesce(nullif(accounts.shared_inbox_url, ''), accounts.inbox_url) AS preferred_inbox_url FROM \"accounts\" INNER JOIN \"mentions\" ON \"mentions\".\"account_id\" = \"accounts\".\"id\" WHERE \"mentions\".\"status_id\" IN (SELECT \"statuses\".\"id\" FROM \"statuses\" WHERE \"statuses\".\"deleted_at\" IS NULL AND \"statuses\".\"account_id\" = $1 AND \"statuses\".\"id\" >= $2 ORDER BY \"statuses\".\"id\" DESC LIMIT $3) AND \"accounts\".\"protocol\" = $4 GROUP BY \"preferred_inbox_url\"","database_type":"postgres"}},{"id":2701856,"event":"return","thread_id":9160,"parent_id":2701855,"elapsed":0.0015366,"elapsed_instrumentation":9.476800914853811e-05},{"id":2701857,"event":"call","thread_id":9160,"defined_class":"DeliveryFailureTracker","method_id":"without_unavailable","path":"app/lib/delivery_failure_tracker.rb","lineno":43,"static":true,"parameters":[{"name":"urls","class":"Array","object_id":13281700,"value":"[https://example.com/inbox-1, https://example.com/inbox-3, https://example.org/inbox-4, https://foo.bar/inbox]","kind":"req","size":4}],"receiver":{"class":"Class","object_id":52940,"value":"DeliveryFailureTracker"}},{"id":2701858,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":13281720,"value":"Cache read: unavailable_domains ({:compress=>false, :compress_threshold=>1024})\n","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":2701859,"event":"return","thread_id":9160,"parent_id":2701858,"elapsed":0.0005479159881360829,"elapsed_instrumentation":0.0001273990492336452,"return_value":{"class":"Integer","value":"80","object_id":161}},{"id":2701860,"event":"call","thread_id":9160,"defined_class":"Marshal","method_id":"load","path":"<internal:marshal>","lineno":33,"static":true,"parameters":[{"name":"source","class":"String","object_id":13281520,"value":"\u0004\b{\u0000","kind":"req"},{"name":"arg","class":"Array","object_id":13281740,"value":"[]","kind":"rest","size":0}],"receiver":{"class":"Module","object_id":318180,"value":"Marshal"}},{"id":2701861,"event":"return","thread_id":9160,"parent_id":2701860,"elapsed":8.627015631645918e-06,"elapsed_instrumentation":0.00014933396596461535,"return_value":{"class":"Hash","value":"{}","object_id":13281760,"size":0}},{"id":2701862,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":13281780,"value":"Cache fetch_hit: unavailable_domains ({:compress=>false, :compress_threshold=>1024})\n","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":2701863,"event":"return","thread_id":9160,"parent_id":2701862,"elapsed":0.0004394279676489532,"elapsed_instrumentation":0.0001209560432471335,"return_value":{"class":"Integer","value":"85","object_id":171}},{"id":2701864,"event":"return","thread_id":9160,"parent_id":2701857,"elapsed":0.0024177770246751606,"elapsed_instrumentation":0.00020382297225296497,"return_value":{"class":"Array","value":"[https://example.com/inbox-1, https://example.com/inbox-3, https://example.org/inbox-4, https://foo.bar/inbox]","object_id":13281800,"size":4}},{"id":2701865,"event":"return","thread_id":9160,"parent_id":2701854,"elapsed":0.005839032004587352,"elapsed_instrumentation":0.0002282779896631837,"return_value":{"class":"Array","value":"[https://example.com/inbox-1, https://example.com/inbox-3, https://example.org/inbox-4, https://foo.bar/inbox]","object_id":13281800,"size":4}},{"id":2701866,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT \"relays\".\"inbox_url\" FROM \"relays\" WHERE \"relays\".\"state\" = $1","database_type":"postgres"}},{"id":2701867,"event":"return","thread_id":9160,"parent_id":2701866,"elapsed":0.000676668,"elapsed_instrumentation":8.399598300457001e-05},{"id":2701868,"event":"return","thread_id":9160,"parent_id":2701823,"elapsed":0.027224580000620335,"elapsed_instrumentation":0.00020285596838220954,"return_value":{"class":"Array","value":"[https://example.com/inbox-1, https://example.org/inbox-2, https://foo.bar/inbox, https://example.com/inbox-3, https://example.org/inbox-4]","object_id":13281820,"size":5}},{"id":2701869,"event":"call","thread_id":9160,"defined_class":"Account","method_id":"preferred_inbox_url","path":"app/models/account.rb","lineno":405,"static":false,"parameters":[],"receiver":{"class":"Account","object_id":13280860,"value":"#<Account:0x00007fc8e172dc18>"}},{"id":2701870,"event":"return","thread_id":9160,"parent_id":2701869,"elapsed":9.318802040070295e-05,"elapsed_instrumentation":0.00010910996934399009,"return_value":{"class":"String","value":"https://example.com/inbox-1","object_id":13281840}},{"id":2701871,"event":"call","thread_id":9160,"defined_class":"Account","method_id":"preferred_inbox_url","path":"app/models/account.rb","lineno":405,"static":false,"parameters":[],"receiver":{"class":"Account","object_id":13280940,"value":"#<Account:0x00007fc8e1723d58>"}},{"id":2701872,"event":"return","thread_id":9160,"parent_id":2701871,"elapsed":1.403602072969079e-05,"elapsed_instrumentation":8.373195305466652e-05,"return_value":{"class":"String","value":"https://example.org/inbox-2","object_id":13281860}},{"id":2701873,"event":"call","thread_id":9160,"defined_class":"Account","method_id":"preferred_inbox_url","path":"app/models/account.rb","lineno":405,"static":false,"parameters":[],"receiver":{"class":"Account","object_id":13280980,"value":"#<Account:0x00007fc8e1721418>"}},{"id":2701874,"event":"return","thread_id":9160,"parent_id":2701873,"elapsed":1.1378026101738214e-05,"elapsed_instrumentation":6.830698112025857e-05,"return_value":{"class":"String","value":"https://foo.bar/inbox","object_id":13281880}}]}