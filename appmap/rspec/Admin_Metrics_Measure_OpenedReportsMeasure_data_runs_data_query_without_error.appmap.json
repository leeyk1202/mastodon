{"version":"1.12.0","metadata":{"app":"mastodon","language":{"name":"ruby","engine":"ruby","version":"3.2.2"},"client":{"name":"appmap","url":"https://github.com/applandinc/appmap-ruby","version":"0.102.1"},"frameworks":[{"name":"rails","version":"7.1.1"},{"name":"rspec","version":"3.12.2"}],"git":{"repository":"https://github.com/sgrigson/mastodon.git","branch":"appmap-config","commit":"743782bd299fd54e12a4a5829872efc505132ab3","status":["M .husky/pre-commit","?? sql_warning.txt"],"git_last_annotated_tag":"0.1.2-14597-g743782bd299fd54e12a4a5829872efc505132ab3","git_last_tag":"v4.2.0","git_commits_since_last_annotated_tag":0,"git_commits_since_last_tag":0},"name":"Admin::Metrics::Measure::OpenedReportsMeasure #data runs data query without error","source_location":"spec/lib/admin/metrics/measure/opened_reports_measure_spec.rb","recorder":{"name":"rspec","type":"tests"},"test_status":"succeeded"},"classMap":[{"name":"app/lib/admin/metrics/measure","type":"package","children":[{"name":"Admin","type":"class","children":[{"name":"Metrics","type":"class","children":[{"name":"Measure","type":"class","children":[{"name":"BaseMeasure","type":"class","children":[{"name":"data","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:45","static":false},{"name":"load","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:59","static":false},{"name":"cache_key","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:21","static":false},{"name":"canonicalized_params","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:104","static":false},{"name":"params","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:100","static":false},{"name":"perform_queries","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:68","static":false},{"name":"time_period","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:88","static":false},{"name":"previous_time_period","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:92","static":false},{"name":"length_of_period","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:96","static":false}]},{"name":"OpenedReportsMeasure","type":"class","children":[{"name":"key","type":"function","location":"app/lib/admin/metrics/measure/opened_reports_measure.rb:6","static":false},{"name":"perform_total_query","type":"function","location":"app/lib/admin/metrics/measure/opened_reports_measure.rb:12","static":false},{"name":"perform_previous_total_query","type":"function","location":"app/lib/admin/metrics/measure/opened_reports_measure.rb:16","static":false},{"name":"sql_array","type":"function","location":"app/lib/admin/metrics/measure/opened_reports_measure.rb:20","static":false},{"name":"sql_query_string","type":"function","location":"app/lib/admin/metrics/measure/opened_reports_measure.rb:24","static":false}]},{"name":"QueryHelper","type":"class","children":[{"name":"perform_data_query","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:6","static":false},{"name":"measurement_data_rows","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:10","static":false},{"name":"sanitized_sql_string","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:14","static":false}]}]}]}]}]},{"name":"logger","type":"package","children":[{"name":"Logger","type":"class","children":[{"name":"LogDevice","type":"class","children":[{"name":"write","type":"function","location":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb:31","static":false,"labels":["log"]}]}]}]},{"name":"ruby","type":"package","children":[{"name":"Marshal","type":"class","children":[{"name":"dump","type":"function","location":"Marshal.dump","static":true,"labels":["serialize"]}]}]}],"events":[{"id":1656071,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"data","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":45,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::OpenedReportsMeasure","object_id":8876200,"value":"#<Admin::Metrics::Measure::OpenedReportsMeasure:0x00007fdc09d8ad28>"}},{"id":1656072,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"load","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::OpenedReportsMeasure","object_id":8876200,"value":"#<Admin::Metrics::Measure::OpenedReportsMeasure:0x00007fdc09d8ad28>"}},{"id":1656073,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"cache_key","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":21,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::OpenedReportsMeasure","object_id":8876200,"value":"#<Admin::Metrics::Measure::OpenedReportsMeasure:0x00007fdc09d8ad28>"}},{"id":1656074,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::OpenedReportsMeasure","method_id":"key","path":"app/lib/admin/metrics/measure/opened_reports_measure.rb","lineno":6,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::OpenedReportsMeasure","object_id":8876200,"value":"#<Admin::Metrics::Measure::OpenedReportsMeasure:0x00007fdc09d8ad28>"}},{"id":1656075,"event":"return","thread_id":9160,"parent_id":1656074,"elapsed":3.6389974411576986e-06,"elapsed_instrumentation":0.00013815800775773823,"return_value":{"class":"String","value":"opened_reports","object_id":8876220}},{"id":1656076,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"canonicalized_params","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":104,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::OpenedReportsMeasure","object_id":8876200,"value":"#<Admin::Metrics::Measure::OpenedReportsMeasure:0x00007fdc09d8ad28>"}},{"id":1656077,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":100,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::OpenedReportsMeasure","object_id":8876200,"value":"#<Admin::Metrics::Measure::OpenedReportsMeasure:0x00007fdc09d8ad28>"}},{"id":1656078,"event":"return","thread_id":9160,"parent_id":1656077,"elapsed":4.069006536155939e-06,"elapsed_instrumentation":0.00010134198237210512,"return_value":{"class":"Hash","value":"{}","object_id":8876240,"size":0}},{"id":1656079,"event":"return","thread_id":9160,"parent_id":1656076,"elapsed":0.00014144799206405878,"elapsed_instrumentation":0.00011574302334338427,"return_value":{"class":"String","value":"","object_id":8876260}},{"id":1656080,"event":"return","thread_id":9160,"parent_id":1656073,"elapsed":0.0004714190145023167,"elapsed_instrumentation":9.980201139114797e-05,"return_value":{"class":"String","value":"metrics/measure/opened_reports;2023-11-03T23:27:54+00:00;2023-11-05T23:27:54+00:00;","object_id":8876280}},{"id":1656081,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":8876300,"value":"Cache read: metrics/measure/opened_reports;2023-11-03T23:27:54+00:00;2023-11-05T23:27:54+00:00; ({:c (...68 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fdc1b4b7180>"}},{"id":1656082,"event":"return","thread_id":9160,"parent_id":1656081,"elapsed":0.0012767479929607362,"elapsed_instrumentation":0.0001649040204938501,"return_value":{"class":"Integer","value":"168","object_id":337}},{"id":1656083,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":8876320,"value":"Cache generate: metrics/measure/opened_reports;2023-11-03T23:27:54+00:00;2023-11-05T23:27:54+00:00;  (...72 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fdc1b4b7180>"}},{"id":1656084,"event":"return","thread_id":9160,"parent_id":1656083,"elapsed":0.0009168789838440716,"elapsed_instrumentation":0.00015908502973616123,"return_value":{"class":"Integer","value":"172","object_id":345}},{"id":1656085,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"perform_queries","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":68,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::OpenedReportsMeasure","object_id":8876200,"value":"#<Admin::Metrics::Measure::OpenedReportsMeasure:0x00007fdc09d8ad28>"}},{"id":1656086,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::OpenedReportsMeasure","method_id":"perform_total_query","path":"app/lib/admin/metrics/measure/opened_reports_measure.rb","lineno":12,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::OpenedReportsMeasure","object_id":8876200,"value":"#<Admin::Metrics::Measure::OpenedReportsMeasure:0x00007fdc09d8ad28>"}},{"id":1656087,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"time_period","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":88,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::OpenedReportsMeasure","object_id":8876200,"value":"#<Admin::Metrics::Measure::OpenedReportsMeasure:0x00007fdc09d8ad28>"}},{"id":1656088,"event":"return","thread_id":9160,"parent_id":1656087,"elapsed":1.5653000446036458e-05,"elapsed_instrumentation":8.893103222362697e-05,"return_value":{"class":"Range","value":"2023-11-03T23:27:54+00:00..2023-11-05T23:27:54+00:00","object_id":8876340}},{"id":1656089,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT COUNT(*) FROM \"reports\" WHERE \"reports\".\"created_at\" BETWEEN $1 AND $2","database_type":"postgres"}},{"id":1656090,"event":"return","thread_id":9160,"parent_id":1656089,"elapsed":0.000909106,"elapsed_instrumentation":0.00010096101323142648},{"id":1656091,"event":"return","thread_id":9160,"parent_id":1656086,"elapsed":0.0027678110054694116,"elapsed_instrumentation":0.00013156697968952358,"return_value":{"class":"Integer","value":"0","object_id":1}},{"id":1656092,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::OpenedReportsMeasure","method_id":"perform_previous_total_query","path":"app/lib/admin/metrics/measure/opened_reports_measure.rb","lineno":16,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::OpenedReportsMeasure","object_id":8876200,"value":"#<Admin::Metrics::Measure::OpenedReportsMeasure:0x00007fdc09d8ad28>"}},{"id":1656093,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"previous_time_period","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":92,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::OpenedReportsMeasure","object_id":8876200,"value":"#<Admin::Metrics::Measure::OpenedReportsMeasure:0x00007fdc09d8ad28>"}},{"id":1656094,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"length_of_period","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":96,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::OpenedReportsMeasure","object_id":8876200,"value":"#<Admin::Metrics::Measure::OpenedReportsMeasure:0x00007fdc09d8ad28>"}},{"id":1656095,"event":"return","thread_id":9160,"parent_id":1656094,"elapsed":1.7166981706395745e-05,"elapsed_instrumentation":6.900800508446991e-05,"return_value":{"class":"Rational","value":"86400000112339/43200000000000","object_id":8876360}},{"id":1656096,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"length_of_period","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":96,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::OpenedReportsMeasure","object_id":8876200,"value":"#<Admin::Metrics::Measure::OpenedReportsMeasure:0x00007fdc09d8ad28>"}},{"id":1656097,"event":"return","thread_id":9160,"parent_id":1656096,"elapsed":2.4840119294822216e-06,"elapsed_instrumentation":6.653298623859882e-05,"return_value":{"class":"Rational","value":"86400000112339/43200000000000","object_id":8876360}},{"id":1656098,"event":"return","thread_id":9160,"parent_id":1656093,"elapsed":0.00023883298854343593,"elapsed_instrumentation":8.314798469655216e-05,"return_value":{"class":"Range","value":"2023-11-01T23:27:54+00:00..2023-11-03T23:27:54+00:00","object_id":8876380}},{"id":1656099,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT COUNT(*) FROM \"reports\" WHERE \"reports\".\"created_at\" BETWEEN $1 AND $2","database_type":"postgres"}},{"id":1656100,"event":"return","thread_id":9160,"parent_id":1656099,"elapsed":0.000699567,"elapsed_instrumentation":8.558598347008228e-05},{"id":1656101,"event":"return","thread_id":9160,"parent_id":1656092,"elapsed":0.002147959021385759,"elapsed_instrumentation":0.0001243680017068982,"return_value":{"class":"Integer","value":"0","object_id":1}},{"id":1656102,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"perform_data_query","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":6,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::OpenedReportsMeasure","object_id":8876200,"value":"#<Admin::Metrics::Measure::OpenedReportsMeasure:0x00007fdc09d8ad28>"}},{"id":1656103,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"measurement_data_rows","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":10,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::OpenedReportsMeasure","object_id":8876200,"value":"#<Admin::Metrics::Measure::OpenedReportsMeasure:0x00007fdc09d8ad28>"}},{"id":1656104,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"sanitized_sql_string","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":14,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::OpenedReportsMeasure","object_id":8876200,"value":"#<Admin::Metrics::Measure::OpenedReportsMeasure:0x00007fdc09d8ad28>"}},{"id":1656105,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::OpenedReportsMeasure","method_id":"sql_array","path":"app/lib/admin/metrics/measure/opened_reports_measure.rb","lineno":20,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::OpenedReportsMeasure","object_id":8876200,"value":"#<Admin::Metrics::Measure::OpenedReportsMeasure:0x00007fdc09d8ad28>"}},{"id":1656106,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::OpenedReportsMeasure","method_id":"sql_query_string","path":"app/lib/admin/metrics/measure/opened_reports_measure.rb","lineno":24,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::OpenedReportsMeasure","object_id":8876200,"value":"#<Admin::Metrics::Measure::OpenedReportsMeasure:0x00007fdc09d8ad28>"}},{"id":1656107,"event":"return","thread_id":9160,"parent_id":1656106,"elapsed":5.058498936705291e-05,"elapsed_instrumentation":8.399400394409895e-05,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH new_reports AS ( SELECT reports.id FROM reports WHERE date_trunc('day', report (...239 more characters)","object_id":8876400}},{"id":1656108,"event":"return","thread_id":9160,"parent_id":1656105,"elapsed":0.0001547250139992684,"elapsed_instrumentation":0.0001465369714424014,"return_value":{"class":"Array","value":"[SELECT axis.*, ( WITH new_reports AS ( SELECT reports.id FROM reports WHERE date_trunc('day', report (...239 more characters), {:start_at=>2023-11-03T23:27:54+00:00, :end_at=>2023-11-05T23:27:54+00:00}]","object_id":8876420,"size":2}},{"id":1656109,"event":"return","thread_id":9160,"parent_id":1656104,"elapsed":0.00044198299292474985,"elapsed_instrumentation":0.00024171598488464952,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH new_reports AS ( SELECT reports.id FROM reports WHERE date_trunc('day', report (...279 more characters)","object_id":8876440}},{"id":1656110,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT axis.*, ( WITH new_reports AS ( SELECT reports.id FROM reports WHERE date_trunc('day', reports.created_at)::date = axis.period ) SELECT count(*) FROM new_reports ) AS value FROM ( SELECT generate_series(date_trunc('day', '2023-11-03 23:27:54.924298'::timestamp)::date, date_trunc('day', '2023-11-05 23:27:54.924522'::timestamp)::date, interval '1 day') AS period ) AS axis","database_type":"postgres"}},{"id":1656111,"event":"return","thread_id":9160,"parent_id":1656110,"elapsed":0.000986617,"elapsed_instrumentation":7.249999907799065e-05},{"id":1656112,"event":"return","thread_id":9160,"parent_id":1656103,"elapsed":0.0020411470031831414,"elapsed_instrumentation":0.0002304729714524001,"return_value":{"class":"ActiveRecord::Result","value":"#<ActiveRecord::Result:0x00007fdc09d87588>","object_id":8876460}},{"id":1656113,"event":"return","thread_id":9160,"parent_id":1656102,"elapsed":0.0023196859983727336,"elapsed_instrumentation":0.00020529600442387164,"return_value":{"class":"Array","value":"[{:date=>2023-11-03 00:00:00 +0000, :value=>0}, {:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}]","object_id":8876480,"size":3}},{"id":1656114,"event":"return","thread_id":9160,"parent_id":1656085,"elapsed":0.007768456998746842,"elapsed_instrumentation":0.0001987169962376356,"return_value":{"class":"Hash","value":"{:total=>0, :previous_total=>0, :data=>[{:date=>2023-11-03 00:00:00 +0000, :value=>0}, {:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}]}","object_id":8876500,"size":3}},{"id":1656115,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":8876520,"value":"Cache write: metrics/measure/opened_reports;2023-11-03T23:27:54+00:00;2023-11-05T23:27:54+00:00; ({: (...69 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fdc1b4b7180>"}},{"id":1656116,"event":"return","thread_id":9160,"parent_id":1656115,"elapsed":0.0008893269987311214,"elapsed_instrumentation":0.00013636297080665827,"return_value":{"class":"Integer","value":"169","object_id":339}},{"id":1656117,"event":"call","thread_id":9160,"defined_class":"Marshal","method_id":"dump","path":"Marshal.dump","static":true,"parameters":[{"name":"arg","class":"Array","object_id":8876540,"value":"[{:total=>0, :previous_total=>0, :data=>[{:date=>2023-11-03 00:00:00 +0000, :value=>0}, {:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}]}]","kind":"rest","size":1}],"receiver":{"class":"Module","object_id":209120,"value":"Marshal"}},{"id":1656118,"event":"return","thread_id":9160,"parent_id":1656117,"elapsed":5.2985007641837e-05,"elapsed_instrumentation":0.0002821180096361786,"return_value":{"class":"String","value":"\u0004\b{\b:\ntotali\u0000:\u0013previous_totali\u0000:\tdata[\b{\u0007:\tdateIu:\tTime\r`_\u001e_\u0000\u0000\u0000\u0000\u0007:\u000boffseti\u0000:\tzone0:\nvalueI\"\u00060\u0006:\u0006EF{\u0007 (...68 more characters)","object_id":8876560}},{"id":1656119,"event":"return","thread_id":9160,"parent_id":1656072,"elapsed":0.014033025014214218,"elapsed_instrumentation":0.0005145320028532296,"return_value":{"class":"ActiveSupport::HashWithIndifferentAccess","value":"{total=>0, previous_total=>0, data=>[{date=>2023-11-03 00:00:00 +0000, value=>0}, {date=>2023-11-04 00:00:00 +0000, value=>0}, {date=>2023-11-05 00:00:00 +0000, value=>0}]}","object_id":8876580,"size":3}},{"id":1656120,"event":"return","thread_id":9160,"parent_id":1656071,"elapsed":0.014588157995603979,"elapsed_instrumentation":0.00045060800039209425,"return_value":{"class":"Array","value":"[{date=>2023-11-03 00:00:00 +0000, value=>0}, {date=>2023-11-04 00:00:00 +0000, value=>0}, {date=>2023-11-05 00:00:00 +0000, value=>0}]","object_id":8876600,"size":3}}]}