{"version":"1.12.0","metadata":{"app":"mastodon","language":{"name":"ruby","engine":"ruby","version":"3.2.2"},"client":{"name":"appmap","url":"https://github.com/applandinc/appmap-ruby","version":"0.102.1"},"frameworks":[{"name":"rails","version":"7.1.1"},{"name":"rspec","version":"3.12.2"}],"git":{"repository":"https://github.com/sgrigson/mastodon.git","branch":"appmap-config","commit":"743782bd299fd54e12a4a5829872efc505132ab3","status":["M .husky/pre-commit","?? sql_warning.txt"],"git_last_annotated_tag":"0.1.2-14597-g743782bd299fd54e12a4a5829872efc505132ab3","git_last_tag":"v4.2.0","git_commits_since_last_annotated_tag":0,"git_commits_since_last_tag":0},"name":"Admin::Metrics::Measure::InstanceAccountsMeasure #data runs data query without error","source_location":"spec/lib/admin/metrics/measure/instance_accounts_measure_spec.rb","recorder":{"name":"rspec","type":"tests"},"test_status":"succeeded"},"classMap":[{"name":"app/lib/admin/metrics/measure","type":"package","children":[{"name":"Admin","type":"class","children":[{"name":"Metrics","type":"class","children":[{"name":"Measure","type":"class","children":[{"name":"BaseMeasure","type":"class","children":[{"name":"data","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:45","static":false},{"name":"load","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:59","static":false},{"name":"cache_key","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:21","static":false},{"name":"canonicalized_params","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:104","static":false},{"name":"perform_queries","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:68","static":false}]},{"name":"InstanceAccountsMeasure","type":"class","children":[{"name":"key","type":"function","location":"app/lib/admin/metrics/measure/instance_accounts_measure.rb:10","static":false},{"name":"params","type":"function","location":"app/lib/admin/metrics/measure/instance_accounts_measure.rb:59","static":false},{"name":"perform_total_query","type":"function","location":"app/lib/admin/metrics/measure/instance_accounts_measure.rb:20","static":false},{"name":"perform_previous_total_query","type":"function","location":"app/lib/admin/metrics/measure/instance_accounts_measure.rb:26","static":false},{"name":"sql_array","type":"function","location":"app/lib/admin/metrics/measure/instance_accounts_measure.rb:30","static":false},{"name":"sql_query_string","type":"function","location":"app/lib/admin/metrics/measure/instance_accounts_measure.rb:34","static":false}]},{"name":"QueryHelper","type":"class","children":[{"name":"perform_data_query","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:6","static":false},{"name":"measurement_data_rows","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:10","static":false},{"name":"sanitized_sql_string","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:14","static":false},{"name":"account_domain_sql","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:18","static":false}]}]}]}]}]},{"name":"logger","type":"package","children":[{"name":"Logger","type":"class","children":[{"name":"LogDevice","type":"class","children":[{"name":"write","type":"function","location":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb:31","static":false,"labels":["log"]}]}]}]},{"name":"ruby","type":"package","children":[{"name":"Marshal","type":"class","children":[{"name":"dump","type":"function","location":"Marshal.dump","static":true,"labels":["serialize"]}]}]}],"events":[{"id":1110448,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"data","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":45,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":6205600,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fdc09e9dda0>"}},{"id":1110449,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"load","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":6205600,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fdc09e9dda0>"}},{"id":1110450,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"cache_key","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":21,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":6205600,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fdc09e9dda0>"}},{"id":1110451,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"key","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":10,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":6205600,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fdc09e9dda0>"}},{"id":1110452,"event":"return","thread_id":9160,"parent_id":1110451,"elapsed":5.457026418298483e-06,"elapsed_instrumentation":0.00013336798292584717,"return_value":{"class":"String","value":"instance_accounts","object_id":6204540}},{"id":1110453,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"canonicalized_params","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":104,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":6205600,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fdc09e9dda0>"}},{"id":1110454,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":6205600,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fdc09e9dda0>"}},{"id":1110455,"event":"return","thread_id":9160,"parent_id":1110454,"elapsed":0.00012149001122452319,"elapsed_instrumentation":0.0002968540065921843,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":6205620}},{"id":1110456,"event":"return","thread_id":9160,"parent_id":1110453,"elapsed":0.0005079520051367581,"elapsed_instrumentation":0.00037176499608904123,"return_value":{"class":"String","value":"domain=example.com","object_id":6205640}},{"id":1110457,"event":"return","thread_id":9160,"parent_id":1110450,"elapsed":0.0011066030128858984,"elapsed_instrumentation":0.00010315398685634136,"return_value":{"class":"String","value":"metrics/measure/instance_accounts;2023-11-03T23:19:40+00:00;2023-11-05T23:19:40+00:00;domain=example (...4 more characters)","object_id":6205660}},{"id":1110458,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":6205680,"value":"Cache read: metrics/measure/instance_accounts;2023-11-03T23:19:40+00:00;2023-11-05T23:19:40+00:00;do (...89 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fdc1b4b7180>"}},{"id":1110459,"event":"return","thread_id":9160,"parent_id":1110458,"elapsed":0.0012704510008916259,"elapsed_instrumentation":0.00017497802036814392,"return_value":{"class":"Integer","value":"189","object_id":379}},{"id":1110460,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":6205700,"value":"Cache generate: metrics/measure/instance_accounts;2023-11-03T23:19:40+00:00;2023-11-05T23:19:40+00:0 (...93 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fdc1b4b7180>"}},{"id":1110461,"event":"return","thread_id":9160,"parent_id":1110460,"elapsed":0.001225536980200559,"elapsed_instrumentation":0.00040675001218914986,"return_value":{"class":"Integer","value":"193","object_id":387}},{"id":1110462,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"perform_queries","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":68,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":6205600,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fdc09e9dda0>"}},{"id":1110463,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"perform_total_query","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":20,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":6205600,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fdc09e9dda0>"}},{"id":1110464,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":6205600,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fdc09e9dda0>"}},{"id":1110465,"event":"return","thread_id":9160,"parent_id":1110464,"elapsed":7.506099063903093e-05,"elapsed_instrumentation":9.408302139490843e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":6205720}},{"id":1110466,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":6205600,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fdc09e9dda0>"}},{"id":1110467,"event":"return","thread_id":9160,"parent_id":1110466,"elapsed":0.00022481998894363642,"elapsed_instrumentation":0.00010984699474647641,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":6205740}},{"id":1110468,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT COUNT(*) FROM \"accounts\" WHERE \"accounts\".\"domain\" = $1","database_type":"postgres"}},{"id":1110469,"event":"return","thread_id":9160,"parent_id":1110468,"elapsed":0.000879247,"elapsed_instrumentation":0.00016450299881398678},{"id":1110470,"event":"return","thread_id":9160,"parent_id":1110463,"elapsed":0.0028080639895051718,"elapsed_instrumentation":0.00013187999138608575,"return_value":{"class":"Integer","value":"3","object_id":7}},{"id":1110471,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"perform_previous_total_query","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":26,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":6205600,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fdc09e9dda0>"}},{"id":1110472,"event":"return","thread_id":9160,"parent_id":1110471,"elapsed":5.1349925342947245e-06,"elapsed_instrumentation":0.00012430999777279794},{"id":1110473,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"perform_data_query","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":6,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":6205600,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fdc09e9dda0>"}},{"id":1110474,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"measurement_data_rows","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":10,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":6205600,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fdc09e9dda0>"}},{"id":1110475,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"sanitized_sql_string","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":14,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":6205600,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fdc09e9dda0>"}},{"id":1110476,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"sql_array","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":30,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":6205600,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fdc09e9dda0>"}},{"id":1110477,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"sql_query_string","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":34,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":6205600,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fdc09e9dda0>"}},{"id":1110478,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":6205600,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fdc09e9dda0>"}},{"id":1110479,"event":"return","thread_id":9160,"parent_id":1110478,"elapsed":8.02770082373172e-05,"elapsed_instrumentation":0.0001296929840464145,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":6205760}},{"id":1110480,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"account_domain_sql","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":18,"static":false,"parameters":[{"name":"include_subdomains","class":"NilClass","object_id":4,"value":null,"kind":"req"}],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":6205600,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fdc09e9dda0>"}},{"id":1110481,"event":"return","thread_id":9160,"parent_id":1110480,"elapsed":4.169996827840805e-06,"elapsed_instrumentation":0.00011758197797462344,"return_value":{"class":"String","value":"accounts.domain = :domain::text","object_id":4999780}},{"id":1110482,"event":"return","thread_id":9160,"parent_id":1110477,"elapsed":0.0008186339982785285,"elapsed_instrumentation":8.412203169427812e-05,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH new_accounts AS ( SELECT accounts.id FROM accounts WHERE date_trunc('day', acc (...280 more characters)","object_id":6205780}},{"id":1110483,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceAccountsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_accounts_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceAccountsMeasure","object_id":6205600,"value":"#<Admin::Metrics::Measure::InstanceAccountsMeasure:0x00007fdc09e9dda0>"}},{"id":1110484,"event":"return","thread_id":9160,"parent_id":1110483,"elapsed":5.313797737471759e-05,"elapsed_instrumentation":0.00010832602856680751,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":6205800}},{"id":1110485,"event":"return","thread_id":9160,"parent_id":1110476,"elapsed":0.0011167490156367421,"elapsed_instrumentation":0.0002147659834008664,"return_value":{"class":"Array","value":"[SELECT axis.*, ( WITH new_accounts AS ( SELECT accounts.id FROM accounts WHERE date_trunc('day', acc (...280 more characters), {:start_at=>2023-11-03T23:19:40+00:00, :end_at=>2023-11-05T23:19:40+00:00, :domain=>example.com}]","object_id":6205820,"size":2}},{"id":1110486,"event":"return","thread_id":9160,"parent_id":1110475,"elapsed":0.0015941470046527684,"elapsed_instrumentation":0.00030050097848288715,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH new_accounts AS ( SELECT accounts.id FROM accounts WHERE date_trunc('day', acc (...326 more characters)","object_id":6205840}},{"id":1110487,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT axis.*, ( WITH new_accounts AS ( SELECT accounts.id FROM accounts WHERE date_trunc('day', accounts.created_at)::date = axis.period AND accounts.domain = 'example.com'::text ) SELECT count(*) FROM new_accounts ) AS value FROM ( SELECT generate_series(date_trunc('day', '2023-11-03 23:19:40.180936'::timestamp)::date, date_trunc('day', '2023-11-05 23:19:40.181252'::timestamp)::date, interval '1 day') AS period ) AS axis","database_type":"postgres"}},{"id":1110488,"event":"return","thread_id":9160,"parent_id":1110487,"elapsed":0.001778608,"elapsed_instrumentation":0.00011964599252678454},{"id":1110489,"event":"return","thread_id":9160,"parent_id":1110474,"elapsed":0.0047251459909603,"elapsed_instrumentation":0.0001464569941163063,"return_value":{"class":"ActiveRecord::Result","value":"#<ActiveRecord::Result:0x00007fdc09e9a970>","object_id":6205860}},{"id":1110490,"event":"return","thread_id":9160,"parent_id":1110473,"elapsed":0.004932245006784797,"elapsed_instrumentation":0.0004187680024188012,"return_value":{"class":"Array","value":"[{:date=>2023-11-03 00:00:00 +0000, :value=>0}, {:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>1}]","object_id":6205880,"size":3}},{"id":1110491,"event":"return","thread_id":9160,"parent_id":1110462,"elapsed":0.008513716980814934,"elapsed_instrumentation":0.00029068702133372426,"return_value":{"class":"Hash","value":"{:total=>3, :previous_total=>, :data=>[{:date=>2023-11-03 00:00:00 +0000, :value=>0}, {:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>1}]}","object_id":6205900,"size":3}},{"id":1110492,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":6205920,"value":"Cache write: metrics/measure/instance_accounts;2023-11-03T23:19:40+00:00;2023-11-05T23:19:40+00:00;d (...90 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fdc1b4b7180>"}},{"id":1110493,"event":"return","thread_id":9160,"parent_id":1110492,"elapsed":0.001900328992633149,"elapsed_instrumentation":0.00018298201030120254,"return_value":{"class":"Integer","value":"190","object_id":381}},{"id":1110494,"event":"call","thread_id":9160,"defined_class":"Marshal","method_id":"dump","path":"Marshal.dump","static":true,"parameters":[{"name":"arg","class":"Array","object_id":6205940,"value":"[{:total=>3, :previous_total=>, :data=>[{:date=>2023-11-03 00:00:00 +0000, :value=>0}, {:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>1}]}]","kind":"rest","size":1}],"receiver":{"class":"Module","object_id":209120,"value":"Marshal"}},{"id":1110495,"event":"return","thread_id":9160,"parent_id":1110494,"elapsed":4.771302337758243e-05,"elapsed_instrumentation":0.0004042260115966201,"return_value":{"class":"String","value":"\u0004\b{\b:\ntotali\b:\u0013previous_total0:\tdata[\b{\u0007:\tdateIu:\tTime\r`_\u001e_\u0000\u0000\u0000\u0000\u0007:\u000boffseti\u0000:\tzone0:\nvalueI\"\u00060\u0006:\u0006EF{\u0007; (...67 more characters)","object_id":6205960}},{"id":1110496,"event":"return","thread_id":9160,"parent_id":1110449,"elapsed":0.016698400024324656,"elapsed_instrumentation":0.0002959340054076165,"return_value":{"class":"ActiveSupport::HashWithIndifferentAccess","value":"{total=>3, previous_total=>, data=>[{date=>2023-11-03 00:00:00 +0000, value=>0}, {date=>2023-11-04 00:00:00 +0000, value=>0}, {date=>2023-11-05 00:00:00 +0000, value=>1}]}","object_id":6205980,"size":3}},{"id":1110497,"event":"return","thread_id":9160,"parent_id":1110448,"elapsed":0.0170322910125833,"elapsed_instrumentation":0.00032908498542383313,"return_value":{"class":"Array","value":"[{date=>2023-11-03 00:00:00 +0000, value=>0}, {date=>2023-11-04 00:00:00 +0000, value=>0}, {date=>2023-11-05 00:00:00 +0000, value=>1}]","object_id":6206000,"size":3}}]}