{"version":"1.12.0","metadata":{"app":"mastodon","language":{"name":"ruby","engine":"ruby","version":"3.2.2"},"client":{"name":"appmap","url":"https://github.com/applandinc/appmap-ruby","version":"0.102.1"},"frameworks":[{"name":"rails","version":"7.1.1"},{"name":"rspec","version":"3.12.2"}],"git":{"repository":"https://github.com/sgrigson/mastodon.git","branch":"appmap-config","commit":"2c1ae2317e8741caf25b51e9b3b2c15776c54ae3","status":["M .husky/pre-commit"],"git_last_annotated_tag":"0.1.2-14608-g2c1ae2317e8741caf25b51e9b3b2c15776c54ae3","git_last_tag":"v4.2.0","git_commits_since_last_annotated_tag":0,"git_commits_since_last_tag":0},"name":"Admin::Metrics::Measure::NewUsersMeasure #data runs data query without error","source_location":"spec/lib/admin/metrics/measure/new_users_measure_spec.rb","recorder":{"name":"rspec","type":"tests"},"test_status":"succeeded"},"classMap":[{"name":"app/lib/admin/metrics/measure","type":"package","children":[{"name":"Admin","type":"class","children":[{"name":"Metrics","type":"class","children":[{"name":"Measure","type":"class","children":[{"name":"BaseMeasure","type":"class","children":[{"name":"data","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:45","static":false},{"name":"load","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:59","static":false},{"name":"cache_key","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:21","static":false},{"name":"canonicalized_params","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:104","static":false},{"name":"params","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:100","static":false},{"name":"perform_queries","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:68","static":false},{"name":"time_period","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:88","static":false},{"name":"previous_time_period","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:92","static":false},{"name":"length_of_period","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:96","static":false}]},{"name":"NewUsersMeasure","type":"class","children":[{"name":"key","type":"function","location":"app/lib/admin/metrics/measure/new_users_measure.rb:6","static":false},{"name":"perform_total_query","type":"function","location":"app/lib/admin/metrics/measure/new_users_measure.rb:12","static":false},{"name":"perform_previous_total_query","type":"function","location":"app/lib/admin/metrics/measure/new_users_measure.rb:16","static":false},{"name":"sql_array","type":"function","location":"app/lib/admin/metrics/measure/new_users_measure.rb:20","static":false},{"name":"sql_query_string","type":"function","location":"app/lib/admin/metrics/measure/new_users_measure.rb:24","static":false}]},{"name":"QueryHelper","type":"class","children":[{"name":"perform_data_query","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:6","static":false},{"name":"measurement_data_rows","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:10","static":false},{"name":"sanitized_sql_string","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:14","static":false}]}]}]}]}]},{"name":"logger","type":"package","children":[{"name":"Logger","type":"class","children":[{"name":"LogDevice","type":"class","children":[{"name":"write","type":"function","location":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb:31","static":false,"labels":["log"]}]}]}]},{"name":"ruby","type":"package","children":[{"name":"Marshal","type":"class","children":[{"name":"dump","type":"function","location":"Marshal.dump","static":true,"labels":["serialize"]}]}]}],"events":[{"id":1396841,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"data","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":45,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::NewUsersMeasure","object_id":7980540,"value":"#<Admin::Metrics::Measure::NewUsersMeasure:0x00007fc934e9f7a0>"}},{"id":1396842,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"load","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::NewUsersMeasure","object_id":7980540,"value":"#<Admin::Metrics::Measure::NewUsersMeasure:0x00007fc934e9f7a0>"}},{"id":1396843,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"cache_key","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":21,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::NewUsersMeasure","object_id":7980540,"value":"#<Admin::Metrics::Measure::NewUsersMeasure:0x00007fc934e9f7a0>"}},{"id":1396844,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::NewUsersMeasure","method_id":"key","path":"app/lib/admin/metrics/measure/new_users_measure.rb","lineno":6,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::NewUsersMeasure","object_id":7980540,"value":"#<Admin::Metrics::Measure::NewUsersMeasure:0x00007fc934e9f7a0>"}},{"id":1396845,"event":"return","thread_id":9160,"parent_id":1396844,"elapsed":2.6780180633068085e-06,"elapsed_instrumentation":0.00011109106708317995,"return_value":{"class":"String","value":"new_users","object_id":7980560}},{"id":1396846,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"canonicalized_params","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":104,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::NewUsersMeasure","object_id":7980540,"value":"#<Admin::Metrics::Measure::NewUsersMeasure:0x00007fc934e9f7a0>"}},{"id":1396847,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":100,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::NewUsersMeasure","object_id":7980540,"value":"#<Admin::Metrics::Measure::NewUsersMeasure:0x00007fc934e9f7a0>"}},{"id":1396848,"event":"return","thread_id":9160,"parent_id":1396847,"elapsed":7.199897663667798e-05,"elapsed_instrumentation":0.00011849502334371209,"return_value":{"class":"Hash","value":"{}","object_id":7980580,"size":0}},{"id":1396849,"event":"return","thread_id":9160,"parent_id":1396846,"elapsed":0.00022299500415101647,"elapsed_instrumentation":0.00028192903846502304,"return_value":{"class":"String","value":"","object_id":7980600}},{"id":1396850,"event":"return","thread_id":9160,"parent_id":1396843,"elapsed":0.0006777610396966338,"elapsed_instrumentation":5.830696318298578e-05,"return_value":{"class":"String","value":"metrics/measure/new_users;2023-11-04T03:04:41+00:00;2023-11-06T03:04:41+00:00;","object_id":7980620}},{"id":1396851,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":7980640,"value":"Cache read: metrics/measure/new_users;2023-11-04T03:04:41+00:00;2023-11-06T03:04:41+00:00; ({:compre (...63 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":1396852,"event":"return","thread_id":9160,"parent_id":1396851,"elapsed":0.0008334430167451501,"elapsed_instrumentation":0.00011775799794122577,"return_value":{"class":"Integer","value":"163","object_id":327}},{"id":1396853,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":7980660,"value":"Cache generate: metrics/measure/new_users;2023-11-04T03:04:41+00:00;2023-11-06T03:04:41+00:00; ({:co (...67 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":1396854,"event":"return","thread_id":9160,"parent_id":1396853,"elapsed":0.0008217869908548892,"elapsed_instrumentation":0.0001335710403509438,"return_value":{"class":"Integer","value":"167","object_id":335}},{"id":1396855,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"perform_queries","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":68,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::NewUsersMeasure","object_id":7980540,"value":"#<Admin::Metrics::Measure::NewUsersMeasure:0x00007fc934e9f7a0>"}},{"id":1396856,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::NewUsersMeasure","method_id":"perform_total_query","path":"app/lib/admin/metrics/measure/new_users_measure.rb","lineno":12,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::NewUsersMeasure","object_id":7980540,"value":"#<Admin::Metrics::Measure::NewUsersMeasure:0x00007fc934e9f7a0>"}},{"id":1396857,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"time_period","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":88,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::NewUsersMeasure","object_id":7980540,"value":"#<Admin::Metrics::Measure::NewUsersMeasure:0x00007fc934e9f7a0>"}},{"id":1396858,"event":"return","thread_id":9160,"parent_id":1396857,"elapsed":1.6093021258711815e-05,"elapsed_instrumentation":0.0003389529883861542,"return_value":{"class":"Range","value":"2023-11-04T03:04:41+00:00..2023-11-06T03:04:41+00:00","object_id":7980680}},{"id":1396859,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT COUNT(*) FROM \"users\" WHERE \"users\".\"created_at\" BETWEEN $1 AND $2","database_type":"postgres"}},{"id":1396860,"event":"return","thread_id":9160,"parent_id":1396859,"elapsed":0.000935425,"elapsed_instrumentation":9.482598397880793e-05},{"id":1396861,"event":"return","thread_id":9160,"parent_id":1396856,"elapsed":0.0027011630008928478,"elapsed_instrumentation":0.00011503300629556179,"return_value":{"class":"Integer","value":"0","object_id":1}},{"id":1396862,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::NewUsersMeasure","method_id":"perform_previous_total_query","path":"app/lib/admin/metrics/measure/new_users_measure.rb","lineno":16,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::NewUsersMeasure","object_id":7980540,"value":"#<Admin::Metrics::Measure::NewUsersMeasure:0x00007fc934e9f7a0>"}},{"id":1396863,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"previous_time_period","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":92,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::NewUsersMeasure","object_id":7980540,"value":"#<Admin::Metrics::Measure::NewUsersMeasure:0x00007fc934e9f7a0>"}},{"id":1396864,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"length_of_period","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":96,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::NewUsersMeasure","object_id":7980540,"value":"#<Admin::Metrics::Measure::NewUsersMeasure:0x00007fc934e9f7a0>"}},{"id":1396865,"event":"return","thread_id":9160,"parent_id":1396864,"elapsed":0.00015978101873770356,"elapsed_instrumentation":9.106297511607409e-05,"return_value":{"class":"Rational","value":"57600000070111/28800000000000","object_id":7980700}},{"id":1396866,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"length_of_period","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":96,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::NewUsersMeasure","object_id":7980540,"value":"#<Admin::Metrics::Measure::NewUsersMeasure:0x00007fc934e9f7a0>"}},{"id":1396867,"event":"return","thread_id":9160,"parent_id":1396866,"elapsed":2.961023710668087e-06,"elapsed_instrumentation":8.400593651458621e-05,"return_value":{"class":"Rational","value":"57600000070111/28800000000000","object_id":7980700}},{"id":1396868,"event":"return","thread_id":9160,"parent_id":1396863,"elapsed":0.0004310820368118584,"elapsed_instrumentation":9.209994459524751e-05,"return_value":{"class":"Range","value":"2023-11-02T03:04:41+00:00..2023-11-04T03:04:41+00:00","object_id":7980720}},{"id":1396869,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT COUNT(*) FROM \"users\" WHERE \"users\".\"created_at\" BETWEEN $1 AND $2","database_type":"postgres"}},{"id":1396870,"event":"return","thread_id":9160,"parent_id":1396869,"elapsed":0.000555057,"elapsed_instrumentation":7.913302397355437e-05},{"id":1396871,"event":"return","thread_id":9160,"parent_id":1396862,"elapsed":0.0020879220101051033,"elapsed_instrumentation":0.0001122669200412929,"return_value":{"class":"Integer","value":"0","object_id":1}},{"id":1396872,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"perform_data_query","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":6,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::NewUsersMeasure","object_id":7980540,"value":"#<Admin::Metrics::Measure::NewUsersMeasure:0x00007fc934e9f7a0>"}},{"id":1396873,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"measurement_data_rows","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":10,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::NewUsersMeasure","object_id":7980540,"value":"#<Admin::Metrics::Measure::NewUsersMeasure:0x00007fc934e9f7a0>"}},{"id":1396874,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"sanitized_sql_string","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":14,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::NewUsersMeasure","object_id":7980540,"value":"#<Admin::Metrics::Measure::NewUsersMeasure:0x00007fc934e9f7a0>"}},{"id":1396875,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::NewUsersMeasure","method_id":"sql_array","path":"app/lib/admin/metrics/measure/new_users_measure.rb","lineno":20,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::NewUsersMeasure","object_id":7980540,"value":"#<Admin::Metrics::Measure::NewUsersMeasure:0x00007fc934e9f7a0>"}},{"id":1396876,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::NewUsersMeasure","method_id":"sql_query_string","path":"app/lib/admin/metrics/measure/new_users_measure.rb","lineno":24,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::NewUsersMeasure","object_id":7980540,"value":"#<Admin::Metrics::Measure::NewUsersMeasure:0x00007fc934e9f7a0>"}},{"id":1396877,"event":"return","thread_id":9160,"parent_id":1396876,"elapsed":0.00010833499254658818,"elapsed_instrumentation":7.712800288572907e-05,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH new_users AS ( SELECT users.id FROM users WHERE date_trunc('day', users.create (...229 more characters)","object_id":7980740}},{"id":1396878,"event":"return","thread_id":9160,"parent_id":1396875,"elapsed":0.00020276999566704035,"elapsed_instrumentation":0.00012967706425115466,"return_value":{"class":"Array","value":"[SELECT axis.*, ( WITH new_users AS ( SELECT users.id FROM users WHERE date_trunc('day', users.create (...229 more characters), {:start_at=>2023-11-04T03:04:41+00:00, :end_at=>2023-11-06T03:04:41+00:00}]","object_id":7980760,"size":2}},{"id":1396879,"event":"return","thread_id":9160,"parent_id":1396874,"elapsed":0.0004495779867284,"elapsed_instrumentation":6.4157007727772e-05,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH new_users AS ( SELECT users.id FROM users WHERE date_trunc('day', users.create (...269 more characters)","object_id":7980780}},{"id":1396880,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT axis.*, ( WITH new_users AS ( SELECT users.id FROM users WHERE date_trunc('day', users.created_at)::date = axis.period ) SELECT count(*) FROM new_users ) AS value FROM ( SELECT generate_series(date_trunc('day', '2023-11-04 03:04:41.254407'::timestamp)::date, date_trunc('day', '2023-11-06 03:04:41.254617'::timestamp)::date, interval '1 day') AS period ) AS axis","database_type":"postgres"}},{"id":1396881,"event":"return","thread_id":9160,"parent_id":1396880,"elapsed":0.000850706,"elapsed_instrumentation":7.474300218746066e-05},{"id":1396882,"event":"return","thread_id":9160,"parent_id":1396873,"elapsed":0.0017219950095750391,"elapsed_instrumentation":0.00011134298983961344,"return_value":{"class":"ActiveRecord::Result","value":"#<ActiveRecord::Result:0x00007fc934e9b1a0>","object_id":7980800}},{"id":1396883,"event":"return","thread_id":9160,"parent_id":1396872,"elapsed":0.0019951610011048615,"elapsed_instrumentation":0.00035274302354082465,"return_value":{"class":"Array","value":"[{:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}, {:date=>2023-11-06 00:00:00 +0000, :value=>0}]","object_id":7980820,"size":3}},{"id":1396884,"event":"return","thread_id":9160,"parent_id":1396855,"elapsed":0.007433839957229793,"elapsed_instrumentation":0.00025299302069470286,"return_value":{"class":"Hash","value":"{:total=>0, :previous_total=>0, :data=>[{:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}, {:date=>2023-11-06 00:00:00 +0000, :value=>0}]}","object_id":7980840,"size":3}},{"id":1396885,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":7980860,"value":"Cache write: metrics/measure/new_users;2023-11-04T03:04:41+00:00;2023-11-06T03:04:41+00:00; ({:compr (...64 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":1396886,"event":"return","thread_id":9160,"parent_id":1396885,"elapsed":0.0006919860024936497,"elapsed_instrumentation":0.0001674680388532579,"return_value":{"class":"Integer","value":"164","object_id":329}},{"id":1396887,"event":"call","thread_id":9160,"defined_class":"Marshal","method_id":"dump","path":"Marshal.dump","static":true,"parameters":[{"name":"arg","class":"Array","object_id":7980880,"value":"[{:total=>0, :previous_total=>0, :data=>[{:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}, {:date=>2023-11-06 00:00:00 +0000, :value=>0}]}]","kind":"rest","size":1}],"receiver":{"class":"Module","object_id":318180,"value":"Marshal"}},{"id":1396888,"event":"return","thread_id":9160,"parent_id":1396887,"elapsed":0.0001244820305146277,"elapsed_instrumentation":0.0006914400146342814,"return_value":{"class":"String","value":"\u0004\b{\b:\ntotali\u0000:\u0013previous_totali\u0000:\tdata[\b{\u0007:\tdateIu:\tTime\r__\u001e_\u0000\u0000\u0000\u0000\u0007:\u000boffseti\u0000:\tzone0:\nvalueI\"\u00060\u0006:\u0006EF{\u0007 (...68 more characters)","object_id":7980900}},{"id":1396889,"event":"return","thread_id":9160,"parent_id":1396842,"elapsed":0.01289711898425594,"elapsed_instrumentation":0.00035342801129445434,"return_value":{"class":"ActiveSupport::HashWithIndifferentAccess","value":"{total=>0, previous_total=>0, data=>[{date=>2023-11-04 00:00:00 +0000, value=>0}, {date=>2023-11-05 00:00:00 +0000, value=>0}, {date=>2023-11-06 00:00:00 +0000, value=>0}]}","object_id":7980920,"size":3}},{"id":1396890,"event":"return","thread_id":9160,"parent_id":1396841,"elapsed":0.013284174026921391,"elapsed_instrumentation":0.00045859895180910826,"return_value":{"class":"Array","value":"[{date=>2023-11-04 00:00:00 +0000, value=>0}, {date=>2023-11-05 00:00:00 +0000, value=>0}, {date=>2023-11-06 00:00:00 +0000, value=>0}]","object_id":7980940,"size":3}}]}