{"version":"1.12.0","metadata":{"app":"mastodon","language":{"name":"ruby","engine":"ruby","version":"3.2.2"},"client":{"name":"appmap","url":"https://github.com/applandinc/appmap-ruby","version":"0.102.1"},"frameworks":[{"name":"rails","version":"7.1.1"},{"name":"rspec","version":"3.12.2"}],"git":{"repository":"https://github.com/sgrigson/mastodon.git","branch":"appmap-config","commit":"2c1ae2317e8741caf25b51e9b3b2c15776c54ae3","status":["M .husky/pre-commit"],"git_last_annotated_tag":"0.1.2-14608-g2c1ae2317e8741caf25b51e9b3b2c15776c54ae3","git_last_tag":"v4.2.0","git_commits_since_last_annotated_tag":0,"git_commits_since_last_tag":0},"name":"Admin::Metrics::Measure::InstanceReportsMeasure #data runs data query without error","source_location":"spec/lib/admin/metrics/measure/instance_reports_measure_spec.rb","recorder":{"name":"rspec","type":"tests"},"test_status":"succeeded"},"classMap":[{"name":"app/lib/admin/metrics/measure","type":"package","children":[{"name":"Admin","type":"class","children":[{"name":"Metrics","type":"class","children":[{"name":"Measure","type":"class","children":[{"name":"BaseMeasure","type":"class","children":[{"name":"data","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:45","static":false},{"name":"load","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:59","static":false},{"name":"cache_key","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:21","static":false},{"name":"canonicalized_params","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:104","static":false},{"name":"perform_queries","type":"function","location":"app/lib/admin/metrics/measure/base_measure.rb:68","static":false}]},{"name":"InstanceReportsMeasure","type":"class","children":[{"name":"key","type":"function","location":"app/lib/admin/metrics/measure/instance_reports_measure.rb:10","static":false},{"name":"params","type":"function","location":"app/lib/admin/metrics/measure/instance_reports_measure.rb:60","static":false},{"name":"perform_total_query","type":"function","location":"app/lib/admin/metrics/measure/instance_reports_measure.rb:20","static":false},{"name":"perform_previous_total_query","type":"function","location":"app/lib/admin/metrics/measure/instance_reports_measure.rb:26","static":false},{"name":"sql_array","type":"function","location":"app/lib/admin/metrics/measure/instance_reports_measure.rb:30","static":false},{"name":"sql_query_string","type":"function","location":"app/lib/admin/metrics/measure/instance_reports_measure.rb:34","static":false}]},{"name":"QueryHelper","type":"class","children":[{"name":"perform_data_query","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:6","static":false},{"name":"measurement_data_rows","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:10","static":false},{"name":"sanitized_sql_string","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:14","static":false},{"name":"account_domain_sql","type":"function","location":"app/lib/admin/metrics/measure/query_helper.rb:18","static":false}]}]}]}]}]},{"name":"logger","type":"package","children":[{"name":"Logger","type":"class","children":[{"name":"LogDevice","type":"class","children":[{"name":"write","type":"function","location":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb:31","static":false,"labels":["log"]}]}]}]},{"name":"ruby","type":"package","children":[{"name":"Marshal","type":"class","children":[{"name":"dump","type":"function","location":"Marshal.dump","static":true,"labels":["serialize"]}]}]}],"events":[{"id":430298,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"data","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":45,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceReportsMeasure","object_id":3037340,"value":"#<Admin::Metrics::Measure::InstanceReportsMeasure:0x00007fc930c97c68>"}},{"id":430299,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"load","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":59,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceReportsMeasure","object_id":3037340,"value":"#<Admin::Metrics::Measure::InstanceReportsMeasure:0x00007fc930c97c68>"}},{"id":430300,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"cache_key","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":21,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceReportsMeasure","object_id":3037340,"value":"#<Admin::Metrics::Measure::InstanceReportsMeasure:0x00007fc930c97c68>"}},{"id":430301,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceReportsMeasure","method_id":"key","path":"app/lib/admin/metrics/measure/instance_reports_measure.rb","lineno":10,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceReportsMeasure","object_id":3037340,"value":"#<Admin::Metrics::Measure::InstanceReportsMeasure:0x00007fc930c97c68>"}},{"id":430302,"event":"return","thread_id":9160,"parent_id":430301,"elapsed":3.1479867175221443e-06,"elapsed_instrumentation":6.703200051560998e-05,"return_value":{"class":"String","value":"instance_reports","object_id":3035660}},{"id":430303,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"canonicalized_params","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":104,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceReportsMeasure","object_id":3037340,"value":"#<Admin::Metrics::Measure::InstanceReportsMeasure:0x00007fc930c97c68>"}},{"id":430304,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceReportsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_reports_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceReportsMeasure","object_id":3037340,"value":"#<Admin::Metrics::Measure::InstanceReportsMeasure:0x00007fc930c97c68>"}},{"id":430305,"event":"return","thread_id":9160,"parent_id":430304,"elapsed":6.413599476218224e-05,"elapsed_instrumentation":7.238303078338504e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":3037360}},{"id":430306,"event":"return","thread_id":9160,"parent_id":430303,"elapsed":0.00020221498562023044,"elapsed_instrumentation":7.204897701740265e-05,"return_value":{"class":"String","value":"domain=example.com","object_id":3037380}},{"id":430307,"event":"return","thread_id":9160,"parent_id":430300,"elapsed":0.00038973899791017175,"elapsed_instrumentation":5.793798482045531e-05,"return_value":{"class":"String","value":"metrics/measure/instance_reports;2023-11-04T02:53:41+00:00;2023-11-06T02:53:41+00:00;domain=example. (...3 more characters)","object_id":3037400}},{"id":430308,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":3037420,"value":"Cache read: metrics/measure/instance_reports;2023-11-04T02:53:41+00:00;2023-11-06T02:53:41+00:00;dom (...88 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":430309,"event":"return","thread_id":9160,"parent_id":430308,"elapsed":0.0006233620224520564,"elapsed_instrumentation":0.00012133800191804767,"return_value":{"class":"Integer","value":"188","object_id":377}},{"id":430310,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":3037440,"value":"Cache generate: metrics/measure/instance_reports;2023-11-04T02:53:41+00:00;2023-11-06T02:53:41+00:00 (...92 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":430311,"event":"return","thread_id":9160,"parent_id":430310,"elapsed":0.000908354006242007,"elapsed_instrumentation":0.00014547398313879967,"return_value":{"class":"Integer","value":"192","object_id":385}},{"id":430312,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::BaseMeasure","method_id":"perform_queries","path":"app/lib/admin/metrics/measure/base_measure.rb","lineno":68,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceReportsMeasure","object_id":3037340,"value":"#<Admin::Metrics::Measure::InstanceReportsMeasure:0x00007fc930c97c68>"}},{"id":430313,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceReportsMeasure","method_id":"perform_total_query","path":"app/lib/admin/metrics/measure/instance_reports_measure.rb","lineno":20,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceReportsMeasure","object_id":3037340,"value":"#<Admin::Metrics::Measure::InstanceReportsMeasure:0x00007fc930c97c68>"}},{"id":430314,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceReportsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_reports_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceReportsMeasure","object_id":3037340,"value":"#<Admin::Metrics::Measure::InstanceReportsMeasure:0x00007fc930c97c68>"}},{"id":430315,"event":"return","thread_id":9160,"parent_id":430314,"elapsed":6.257201312109828e-05,"elapsed_instrumentation":8.074496872723103e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":3037460}},{"id":430316,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceReportsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_reports_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceReportsMeasure","object_id":3037340,"value":"#<Admin::Metrics::Measure::InstanceReportsMeasure:0x00007fc930c97c68>"}},{"id":430317,"event":"return","thread_id":9160,"parent_id":430316,"elapsed":3.26730078086257e-05,"elapsed_instrumentation":7.549597648903728e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":3037480}},{"id":430318,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT COUNT(*) FROM \"reports\" WHERE \"reports\".\"target_account_id\" IN (SELECT \"accounts\".\"id\" FROM \"accounts\" WHERE \"accounts\".\"domain\" = $1)","database_type":"postgres"}},{"id":430319,"event":"return","thread_id":9160,"parent_id":430318,"elapsed":0.001159114,"elapsed_instrumentation":9.560899343341589e-05},{"id":430320,"event":"return","thread_id":9160,"parent_id":430313,"elapsed":0.002975812996737659,"elapsed_instrumentation":0.00010579603258520365,"return_value":{"class":"Integer","value":"2","object_id":5}},{"id":430321,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceReportsMeasure","method_id":"perform_previous_total_query","path":"app/lib/admin/metrics/measure/instance_reports_measure.rb","lineno":26,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceReportsMeasure","object_id":3037340,"value":"#<Admin::Metrics::Measure::InstanceReportsMeasure:0x00007fc930c97c68>"}},{"id":430322,"event":"return","thread_id":9160,"parent_id":430321,"elapsed":2.935994416475296e-06,"elapsed_instrumentation":7.956899935379624e-05},{"id":430323,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"perform_data_query","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":6,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceReportsMeasure","object_id":3037340,"value":"#<Admin::Metrics::Measure::InstanceReportsMeasure:0x00007fc930c97c68>"}},{"id":430324,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"measurement_data_rows","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":10,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceReportsMeasure","object_id":3037340,"value":"#<Admin::Metrics::Measure::InstanceReportsMeasure:0x00007fc930c97c68>"}},{"id":430325,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"sanitized_sql_string","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":14,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceReportsMeasure","object_id":3037340,"value":"#<Admin::Metrics::Measure::InstanceReportsMeasure:0x00007fc930c97c68>"}},{"id":430326,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceReportsMeasure","method_id":"sql_array","path":"app/lib/admin/metrics/measure/instance_reports_measure.rb","lineno":30,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceReportsMeasure","object_id":3037340,"value":"#<Admin::Metrics::Measure::InstanceReportsMeasure:0x00007fc930c97c68>"}},{"id":430327,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceReportsMeasure","method_id":"sql_query_string","path":"app/lib/admin/metrics/measure/instance_reports_measure.rb","lineno":34,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceReportsMeasure","object_id":3037340,"value":"#<Admin::Metrics::Measure::InstanceReportsMeasure:0x00007fc930c97c68>"}},{"id":430328,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceReportsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_reports_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceReportsMeasure","object_id":3037340,"value":"#<Admin::Metrics::Measure::InstanceReportsMeasure:0x00007fc930c97c68>"}},{"id":430329,"event":"return","thread_id":9160,"parent_id":430328,"elapsed":5.3499010391533375e-05,"elapsed_instrumentation":7.429200923070312e-05,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":3037500}},{"id":430330,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::QueryHelper","method_id":"account_domain_sql","path":"app/lib/admin/metrics/measure/query_helper.rb","lineno":18,"static":false,"parameters":[{"name":"include_subdomains","class":"NilClass","object_id":4,"value":null,"kind":"req"}],"receiver":{"class":"Admin::Metrics::Measure::InstanceReportsMeasure","object_id":3037340,"value":"#<Admin::Metrics::Measure::InstanceReportsMeasure:0x00007fc930c97c68>"}},{"id":430331,"event":"return","thread_id":9160,"parent_id":430330,"elapsed":3.2489770092070103e-06,"elapsed_instrumentation":8.028000593185425e-05,"return_value":{"class":"String","value":"accounts.domain = :domain::text","object_id":3036700}},{"id":430332,"event":"return","thread_id":9160,"parent_id":430327,"elapsed":0.0003304959973320365,"elapsed_instrumentation":5.6481047067791224e-05,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH new_reports AS ( SELECT reports.id FROM reports INNER JOIN accounts ON account (...338 more characters)","object_id":3037520}},{"id":430333,"event":"call","thread_id":9160,"defined_class":"Admin::Metrics::Measure::InstanceReportsMeasure","method_id":"params","path":"app/lib/admin/metrics/measure/instance_reports_measure.rb","lineno":60,"static":false,"parameters":[],"receiver":{"class":"Admin::Metrics::Measure::InstanceReportsMeasure","object_id":3037340,"value":"#<Admin::Metrics::Measure::InstanceReportsMeasure:0x00007fc930c97c68>"}},{"id":430334,"event":"return","thread_id":9160,"parent_id":430333,"elapsed":4.762702155858278e-05,"elapsed_instrumentation":0.00024425797164440155,"return_value":{"class":"ActionController::Parameters","value":"{\"domain\"=>\"example.com\"}","object_id":3037540}},{"id":430335,"event":"return","thread_id":9160,"parent_id":430326,"elapsed":0.0007150790188461542,"elapsed_instrumentation":0.00012714497279375792,"return_value":{"class":"Array","value":"[SELECT axis.*, ( WITH new_reports AS ( SELECT reports.id FROM reports INNER JOIN accounts ON account (...338 more characters), {:start_at=>2023-11-04T02:53:41+00:00, :end_at=>2023-11-06T02:53:41+00:00, :domain=>example.com}]","object_id":3037560,"size":2}},{"id":430336,"event":"return","thread_id":9160,"parent_id":430325,"elapsed":0.0010270390193909407,"elapsed_instrumentation":6.482395110651851e-05,"return_value":{"class":"String","value":"SELECT axis.*, ( WITH new_reports AS ( SELECT reports.id FROM reports INNER JOIN accounts ON account (...384 more characters)","object_id":3037580}},{"id":430337,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT axis.*, ( WITH new_reports AS ( SELECT reports.id FROM reports INNER JOIN accounts ON accounts.id = reports.target_account_id WHERE date_trunc('day', reports.created_at)::date = axis.period AND accounts.domain = 'example.com'::text ) SELECT count(*) FROM new_reports ) AS value FROM ( SELECT generate_series(date_trunc('day', '2023-11-04 02:53:41.468759'::timestamp)::date, date_trunc('day', '2023-11-06 02:53:41.468901'::timestamp)::date, interval '1 day') AS period ) AS axis","database_type":"postgres"}},{"id":430338,"event":"return","thread_id":9160,"parent_id":430337,"elapsed":0.001385359,"elapsed_instrumentation":7.975101470947266e-05},{"id":430339,"event":"return","thread_id":9160,"parent_id":430324,"elapsed":0.0028756950050592422,"elapsed_instrumentation":8.470099419355392e-05,"return_value":{"class":"ActiveRecord::Result","value":"#<ActiveRecord::Result:0x00007fc930c95918>","object_id":3037600}},{"id":430340,"event":"return","thread_id":9160,"parent_id":430323,"elapsed":0.003002533980179578,"elapsed_instrumentation":0.00017037097131833434,"return_value":{"class":"Array","value":"[{:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}, {:date=>2023-11-06 00:00:00 +0000, :value=>2}]","object_id":3037620,"size":3}},{"id":430341,"event":"return","thread_id":9160,"parent_id":430312,"elapsed":0.006396927987225354,"elapsed_instrumentation":0.00035305600613355637,"return_value":{"class":"Hash","value":"{:total=>2, :previous_total=>, :data=>[{:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}, {:date=>2023-11-06 00:00:00 +0000, :value=>2}]}","object_id":3037640,"size":3}},{"id":430342,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":3037660,"value":"Cache write: metrics/measure/instance_reports;2023-11-04T02:53:41+00:00;2023-11-06T02:53:41+00:00;do (...89 more characters)","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":430343,"event":"return","thread_id":9160,"parent_id":430342,"elapsed":0.0005521319690160453,"elapsed_instrumentation":0.00012713298201560974,"return_value":{"class":"Integer","value":"189","object_id":379}},{"id":430344,"event":"call","thread_id":9160,"defined_class":"Marshal","method_id":"dump","path":"Marshal.dump","static":true,"parameters":[{"name":"arg","class":"Array","object_id":3037680,"value":"[{:total=>2, :previous_total=>, :data=>[{:date=>2023-11-04 00:00:00 +0000, :value=>0}, {:date=>2023-11-05 00:00:00 +0000, :value=>0}, {:date=>2023-11-06 00:00:00 +0000, :value=>2}]}]","kind":"rest","size":1}],"receiver":{"class":"Module","object_id":318180,"value":"Marshal"}},{"id":430345,"event":"return","thread_id":9160,"parent_id":430344,"elapsed":3.729498712345958e-05,"elapsed_instrumentation":0.00025573198217898607,"return_value":{"class":"String","value":"\u0004\b{\b:\ntotali\u0007:\u0013previous_total0:\tdata[\b{\u0007:\tdateIu:\tTime\r__\u001e_\u0000\u0000\u0000\u0000\u0007:\u000boffseti\u0000:\tzone0:\nvalueI\"\u00060\u0006:\u0006EF{\u0007; (...67 more characters)","object_id":3037700}},{"id":430346,"event":"return","thread_id":9160,"parent_id":430299,"elapsed":0.010628468007780612,"elapsed_instrumentation":0.00027765100821852684,"return_value":{"class":"ActiveSupport::HashWithIndifferentAccess","value":"{total=>2, previous_total=>, data=>[{date=>2023-11-04 00:00:00 +0000, value=>0}, {date=>2023-11-05 00:00:00 +0000, value=>0}, {date=>2023-11-06 00:00:00 +0000, value=>2}]}","object_id":3037720,"size":3}},{"id":430347,"event":"return","thread_id":9160,"parent_id":430298,"elapsed":0.01092987396987155,"elapsed_instrumentation":0.00021879503037780523,"return_value":{"class":"Array","value":"[{date=>2023-11-04 00:00:00 +0000, value=>0}, {date=>2023-11-05 00:00:00 +0000, value=>0}, {date=>2023-11-06 00:00:00 +0000, value=>2}]","object_id":3037740,"size":3}}]}