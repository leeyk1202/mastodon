{"version":"1.12.0","metadata":{"app":"mastodon","language":{"name":"ruby","engine":"ruby","version":"3.2.2"},"client":{"name":"appmap","url":"https://github.com/applandinc/appmap-ruby","version":"0.102.1"},"frameworks":[{"name":"rails","version":"7.1.1"},{"name":"rspec","version":"3.12.2"}],"git":{"repository":"https://github.com/sgrigson/mastodon.git","branch":"appmap-config","commit":"2c1ae2317e8741caf25b51e9b3b2c15776c54ae3","status":["M .husky/pre-commit"],"git_last_annotated_tag":"0.1.2-14608-g2c1ae2317e8741caf25b51e9b3b2c15776c54ae3","git_last_tag":"v4.2.0","git_commits_since_last_annotated_tag":0,"git_commits_since_last_tag":0},"name":"AccountReachFinder #inboxes does not include the inbox of unrelated users","source_location":"spec/lib/account_reach_finder_spec.rb","recorder":{"name":"rspec","type":"tests"},"test_status":"succeeded"},"classMap":[{"name":"app","type":"package","children":[{"name":"lib","type":"package","children":[{"name":"AccountReachFinder","type":"class","children":[{"name":"inboxes","type":"function","location":"app/lib/account_reach_finder.rb:8","static":false}]},{"name":"DeliveryFailureTracker","type":"class","children":[{"name":"without_unavailable","type":"function","location":"app/lib/delivery_failure_tracker.rb:43","static":true}]}]},{"name":"models","type":"package","children":[{"name":"Account","type":"class","children":[{"name":"inboxes","type":"function","location":"app/models/account.rb:436","static":true},{"name":"preferred_inbox_url","type":"function","location":"app/models/account.rb:405","static":false}]}]}]},{"name":"logger","type":"package","children":[{"name":"Logger","type":"class","children":[{"name":"LogDevice","type":"class","children":[{"name":"write","type":"function","location":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb:31","static":false,"labels":["log"]}]}]}]},{"name":"ruby","type":"package","children":[{"name":"Marshal","type":"class","children":[{"name":"dump","type":"function","location":"Marshal.dump","static":true,"labels":["serialize"]},{"name":"load","type":"function","location":"<internal:marshal>:33","static":true,"labels":["deserialize.unsafe"]}]}]},{"name":"lib/mastodon","type":"package","children":[{"name":"Mastodon","type":"class","children":[{"name":"Snowflake","type":"class","children":[{"name":"id_at","type":"function","location":"lib/mastodon/snowflake.rb:99","static":true}]}]}]}],"events":[{"id":2701775,"event":"call","thread_id":9160,"defined_class":"AccountReachFinder","method_id":"inboxes","path":"app/lib/account_reach_finder.rb","lineno":8,"static":false,"parameters":[],"receiver":{"class":"AccountReachFinder","object_id":13280400,"value":"#<AccountReachFinder:0x00007fc932236380>"}},{"id":2701776,"event":"call","thread_id":9160,"defined_class":"Account","method_id":"inboxes","path":"app/models/account.rb","lineno":436,"static":true,"parameters":[],"receiver":{"class":"Class","object_id":36600,"value":"Account"}},{"id":2701777,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT coalesce(nullif(accounts.shared_inbox_url, ''), accounts.inbox_url) AS preferred_inbox_url FROM \"accounts\" INNER JOIN \"follows\" ON \"accounts\".\"id\" = \"follows\".\"account_id\" WHERE \"follows\".\"target_account_id\" = $1 AND \"accounts\".\"protocol\" = $2 GROUP BY \"preferred_inbox_url\"","database_type":"postgres"}},{"id":2701778,"event":"return","thread_id":9160,"parent_id":2701777,"elapsed":0.001725852,"elapsed_instrumentation":0.00017213402315974236},{"id":2701779,"event":"call","thread_id":9160,"defined_class":"DeliveryFailureTracker","method_id":"without_unavailable","path":"app/lib/delivery_failure_tracker.rb","lineno":43,"static":true,"parameters":[{"name":"urls","class":"Array","object_id":13280420,"value":"[https://example.com/inbox-1, https://example.org/inbox-2, https://foo.bar/inbox]","kind":"req","size":3}],"receiver":{"class":"Class","object_id":52940,"value":"DeliveryFailureTracker"}},{"id":2701780,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":13280440,"value":"Cache read: unavailable_domains ({:compress=>false, :compress_threshold=>1024})\n","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":2701781,"event":"return","thread_id":9160,"parent_id":2701780,"elapsed":0.0007970099686644971,"elapsed_instrumentation":0.00015450501814484596,"return_value":{"class":"Integer","value":"80","object_id":161}},{"id":2701782,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":13280460,"value":"Cache generate: unavailable_domains ({:compress=>false, :compress_threshold=>1024})\n","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":2701783,"event":"return","thread_id":9160,"parent_id":2701782,"elapsed":0.0007190090254880488,"elapsed_instrumentation":0.0001537379575893283,"return_value":{"class":"Integer","value":"84","object_id":169}},{"id":2701784,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT \"unavailable_domains\".\"domain\" FROM \"unavailable_domains\"","database_type":"postgres"}},{"id":2701785,"event":"return","thread_id":9160,"parent_id":2701784,"elapsed":0.000762134,"elapsed_instrumentation":0.00014947098679840565},{"id":2701786,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":13280480,"value":"Cache write: unavailable_domains ({:compress=>false, :compress_threshold=>1024})\n","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":2701787,"event":"return","thread_id":9160,"parent_id":2701786,"elapsed":0.0007290689973160625,"elapsed_instrumentation":0.0004394240095280111,"return_value":{"class":"Integer","value":"81","object_id":163}},{"id":2701788,"event":"call","thread_id":9160,"defined_class":"Marshal","method_id":"dump","path":"Marshal.dump","static":true,"parameters":[{"name":"arg","class":"Array","object_id":13280500,"value":"[{}]","kind":"rest","size":1}],"receiver":{"class":"Module","object_id":318180,"value":"Marshal"}},{"id":2701789,"event":"return","thread_id":9160,"parent_id":2701788,"elapsed":1.1558993719518185e-05,"elapsed_instrumentation":0.00017504103016108274,"return_value":{"class":"String","value":"\u0004\b{\u0000","object_id":13280520}},{"id":2701790,"event":"return","thread_id":9160,"parent_id":2701779,"elapsed":0.007079251983668655,"elapsed_instrumentation":0.0002974460367113352,"return_value":{"class":"Array","value":"[https://example.com/inbox-1, https://example.org/inbox-2, https://foo.bar/inbox]","object_id":13280540,"size":3}},{"id":2701791,"event":"return","thread_id":9160,"parent_id":2701776,"elapsed":0.011691952997352928,"elapsed_instrumentation":0.00020391202997416258,"return_value":{"class":"Array","value":"[https://example.com/inbox-1, https://example.org/inbox-2, https://foo.bar/inbox]","object_id":13280540,"size":3}},{"id":2701792,"event":"call","thread_id":9160,"defined_class":"Account","method_id":"inboxes","path":"app/models/account.rb","lineno":436,"static":true,"parameters":[],"receiver":{"class":"Class","object_id":36600,"value":"Account"}},{"id":2701793,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT coalesce(nullif(accounts.shared_inbox_url, ''), accounts.inbox_url) AS preferred_inbox_url FROM \"accounts\" WHERE \"accounts\".\"id\" IN (SELECT \"reports\".\"account_id\" FROM \"reports\" WHERE \"reports\".\"target_account_id\" = $1) AND \"accounts\".\"protocol\" = $2 GROUP BY \"preferred_inbox_url\"","database_type":"postgres"}},{"id":2701794,"event":"return","thread_id":9160,"parent_id":2701793,"elapsed":0.001509703,"elapsed_instrumentation":0.00023738003801554441},{"id":2701795,"event":"call","thread_id":9160,"defined_class":"DeliveryFailureTracker","method_id":"without_unavailable","path":"app/lib/delivery_failure_tracker.rb","lineno":43,"static":true,"parameters":[{"name":"urls","class":"Array","object_id":13280560,"value":"[]","kind":"req","size":0}],"receiver":{"class":"Class","object_id":52940,"value":"DeliveryFailureTracker"}},{"id":2701796,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":13280580,"value":"Cache read: unavailable_domains ({:compress=>false, :compress_threshold=>1024})\n","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":2701797,"event":"return","thread_id":9160,"parent_id":2701796,"elapsed":0.0007589189917780459,"elapsed_instrumentation":0.00014638405991718173,"return_value":{"class":"Integer","value":"80","object_id":161}},{"id":2701798,"event":"call","thread_id":9160,"defined_class":"Marshal","method_id":"load","path":"<internal:marshal>","lineno":33,"static":true,"parameters":[{"name":"source","class":"String","object_id":13280520,"value":"\u0004\b{\u0000","kind":"req"},{"name":"arg","class":"Array","object_id":13280600,"value":"[]","kind":"rest","size":0}],"receiver":{"class":"Module","object_id":318180,"value":"Marshal"}},{"id":2701799,"event":"return","thread_id":9160,"parent_id":2701798,"elapsed":8.76403646543622e-06,"elapsed_instrumentation":0.00022086896933615208,"return_value":{"class":"Hash","value":"{}","object_id":13280620,"size":0}},{"id":2701800,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":13280640,"value":"Cache fetch_hit: unavailable_domains ({:compress=>false, :compress_threshold=>1024})\n","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":2701801,"event":"return","thread_id":9160,"parent_id":2701800,"elapsed":0.0006606969982385635,"elapsed_instrumentation":0.00013000797480344772,"return_value":{"class":"Integer","value":"85","object_id":171}},{"id":2701802,"event":"return","thread_id":9160,"parent_id":2701795,"elapsed":0.002533678023610264,"elapsed_instrumentation":0.00020194001263007522,"return_value":{"class":"Array","value":"[]","object_id":13280660,"size":0}},{"id":2701803,"event":"return","thread_id":9160,"parent_id":2701792,"elapsed":0.006017590989358723,"elapsed_instrumentation":0.00015245506074279547,"return_value":{"class":"Array","value":"[]","object_id":13280660,"size":0}},{"id":2701804,"event":"call","thread_id":9160,"defined_class":"Mastodon::Snowflake","method_id":"id_at","path":"lib/mastodon/snowflake.rb","lineno":99,"static":true,"parameters":[{"name":"timestamp","class":"ActiveSupport::TimeWithZone","object_id":13280680,"value":"2023-11-04 03:16:13 UTC","kind":"req"},{"name":"with_random","class":"FalseClass","object_id":0,"value":"false","kind":"key"}],"receiver":{"class":"Module","object_id":1610500,"value":"Mastodon::Snowflake"}},{"id":2701805,"event":"return","thread_id":9160,"parent_id":2701804,"elapsed":1.609395258128643e-05,"elapsed_instrumentation":0.00015971303218975663,"return_value":{"class":"Integer","value":"111350105571328000","object_id":222700211142656001}},{"id":2701806,"event":"call","thread_id":9160,"defined_class":"Account","method_id":"inboxes","path":"app/models/account.rb","lineno":436,"static":true,"parameters":[],"receiver":{"class":"Class","object_id":36600,"value":"Account"}},{"id":2701807,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT coalesce(nullif(accounts.shared_inbox_url, ''), accounts.inbox_url) AS preferred_inbox_url FROM \"accounts\" INNER JOIN \"mentions\" ON \"mentions\".\"account_id\" = \"accounts\".\"id\" WHERE \"mentions\".\"status_id\" IN (SELECT \"statuses\".\"id\" FROM \"statuses\" WHERE \"statuses\".\"deleted_at\" IS NULL AND \"statuses\".\"account_id\" = $1 AND \"statuses\".\"id\" >= $2 ORDER BY \"statuses\".\"id\" DESC LIMIT $3) AND \"accounts\".\"protocol\" = $4 GROUP BY \"preferred_inbox_url\"","database_type":"postgres"}},{"id":2701808,"event":"return","thread_id":9160,"parent_id":2701807,"elapsed":0.001773372,"elapsed_instrumentation":0.0001735920086503029},{"id":2701809,"event":"call","thread_id":9160,"defined_class":"DeliveryFailureTracker","method_id":"without_unavailable","path":"app/lib/delivery_failure_tracker.rb","lineno":43,"static":true,"parameters":[{"name":"urls","class":"Array","object_id":13280700,"value":"[https://example.com/inbox-1, https://example.com/inbox-3, https://example.org/inbox-4, https://foo.bar/inbox]","kind":"req","size":4}],"receiver":{"class":"Class","object_id":52940,"value":"DeliveryFailureTracker"}},{"id":2701810,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":13280720,"value":"Cache read: unavailable_domains ({:compress=>false, :compress_threshold=>1024})\n","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":2701811,"event":"return","thread_id":9160,"parent_id":2701810,"elapsed":0.0009614060400053859,"elapsed_instrumentation":0.00015491992235183716,"return_value":{"class":"Integer","value":"80","object_id":161}},{"id":2701812,"event":"call","thread_id":9160,"defined_class":"Marshal","method_id":"load","path":"<internal:marshal>","lineno":33,"static":true,"parameters":[{"name":"source","class":"String","object_id":13280520,"value":"\u0004\b{\u0000","kind":"req"},{"name":"arg","class":"Array","object_id":13280740,"value":"[]","kind":"rest","size":0}],"receiver":{"class":"Module","object_id":318180,"value":"Marshal"}},{"id":2701813,"event":"return","thread_id":9160,"parent_id":2701812,"elapsed":1.0871968697756529e-05,"elapsed_instrumentation":0.0001838350435718894,"return_value":{"class":"Hash","value":"{}","object_id":13280760,"size":0}},{"id":2701814,"event":"call","thread_id":9160,"defined_class":"Logger::LogDevice","method_id":"write","path":"/usr/local/lib/ruby/3.2.0/logger/log_device.rb","lineno":31,"static":false,"parameters":[{"name":"message","class":"String","object_id":13280780,"value":"Cache fetch_hit: unavailable_domains ({:compress=>false, :compress_threshold=>1024})\n","kind":"req"}],"receiver":{"class":"Logger::LogDevice","object_id":19780,"value":"#<Logger::LogDevice:0x00007fc942103e80>"}},{"id":2701815,"event":"return","thread_id":9160,"parent_id":2701814,"elapsed":0.0009375840309076011,"elapsed_instrumentation":0.00019668199820443988,"return_value":{"class":"Integer","value":"85","object_id":171}},{"id":2701816,"event":"return","thread_id":9160,"parent_id":2701809,"elapsed":0.0041755459969863296,"elapsed_instrumentation":0.00024193600984290242,"return_value":{"class":"Array","value":"[https://example.com/inbox-1, https://example.com/inbox-3, https://example.org/inbox-4, https://foo.bar/inbox]","object_id":13280800,"size":4}},{"id":2701817,"event":"return","thread_id":9160,"parent_id":2701806,"elapsed":0.008252533967606723,"elapsed_instrumentation":0.0001633079955354333,"return_value":{"class":"Array","value":"[https://example.com/inbox-1, https://example.com/inbox-3, https://example.org/inbox-4, https://foo.bar/inbox]","object_id":13280800,"size":4}},{"id":2701818,"event":"call","thread_id":9160,"sql_query":{"sql":"SELECT \"relays\".\"inbox_url\" FROM \"relays\" WHERE \"relays\".\"state\" = $1","database_type":"postgres"}},{"id":2701819,"event":"return","thread_id":9160,"parent_id":2701818,"elapsed":0.000850522,"elapsed_instrumentation":9.896996198222041e-05},{"id":2701820,"event":"return","thread_id":9160,"parent_id":2701775,"elapsed":0.03595536103239283,"elapsed_instrumentation":0.0001872559660114348,"return_value":{"class":"Array","value":"[https://example.com/inbox-1, https://example.org/inbox-2, https://foo.bar/inbox, https://example.com/inbox-3, https://example.org/inbox-4]","object_id":13280820,"size":5}},{"id":2701821,"event":"call","thread_id":9160,"defined_class":"Account","method_id":"preferred_inbox_url","path":"app/models/account.rb","lineno":405,"static":false,"parameters":[],"receiver":{"class":"Account","object_id":13280360,"value":"#<Account:0x00007fc8e17158c0>"}},{"id":2701822,"event":"return","thread_id":9160,"parent_id":2701821,"elapsed":5.2054994739592075e-05,"elapsed_instrumentation":0.00023352698190137744,"return_value":{"class":"String","value":"https://example.com/unrelated-inbox","object_id":13280840}}]}